<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Glidein Factory Configuration</title>
</head>

<body lang="en-US" dir="ltr">
<h1>Glidein Factory Configuration</h1>

<h2>Description</h2>

<p>To configure the Glidein Factory you need to create a directory with a set
of files. This is done by the command line tools described below. A set of
configuration example is provided, too.</p>

<h2>Index</h2>
<ul>
  <li><a href="#name">Command line tools</a> </li>
  <li><a href="#args">The configuration file</a> 
    <ul>
      <li><a href="#args_global">Suggested global arguments</a> </li>
      <li><a href="#args_entry">Suggested entry point arguments</a> </li>
    </ul>
  </li>
  <li><a href="#advanced">Advanced topics</a> 
    <ul>
      <li><a href="#glexec">Integration with gLExec</a> 
        <ul>
          <li><a href="glexec_troubleshooting">Troubleshooting</a> </li>
        </ul>
      </li>
      <li><a href="#private_net">Private networks and firewalls</a> ( <a
        href="#gcb">GCB</a> , <a href="#ccb">CCB</a> ) </li>
      <li><a href="#security">Security handles</a> </li>
      <li><a href="#tcp">Using TCP to send updates to the Collector</a> </li>
      <li><a href="#multicol">Multiple collectors</a> </li>
      <li><a href="#start_rank">Setting the glidein start and rank
        condition</a> </li>
      <li><a href="#time_limit">Limiting time spent on a Grid resource</a>
      </li>
      <li><a href="#multi-monitor">Old-style pseudo interactive
        monitoring</a> </li>
      <li><a href="#custom_code">Adding custom code/files to the glideins</a>
      </li>
    </ul>
  </li>
  <li><a href="#ref">Reference</a> </li>
</ul>

<h2><a name="name"></a>Command line tools</h2>
<dl>
  <dt>To create a new directory, use the command: </dt>
    <dd><font face="monospace">create_glidein</font></dd>
  <dt><br>
  To update an existing directory, use: </dt>
    <dd><font face="monospace">reconfig_glidein</font></dd>
  <dt><br>
  Both are located in: </dt>
    <dd><font face="monospace">glideinWMS/creation</font></dd>
  <dt style="margin-bottom: 0.2in"><br>
  They will create all the needed directories and files needed by a <a
  href="index.html#glidein_daemons">Glidein Factory Daemon</a>.<br>
  <br>
  Both commands has only one argument, and it is the configuration file to
  load: </dt>
    <dd style="margin-bottom: 0.2in"><font face="monospace">./create_glidein
      &lt;xml file&gt;<br>
      ./reconfig_glidein &lt;xml file&gt;</font></dd>
</dl>

<h2><a name="args"></a>The configuration file</h2>

<p>The configuration file is a XML document.<br>
<br>
It is composed of two parts:</p>
<ul>
  <li><p style="margin-bottom: 0in"><a href="#args_global">The global
    arguments</a> </p>
  </li>
  <li><p><a href="#args_entry">Entry point arguments</a> </p>
  </li>
</ul>
<dl>
  <dt style="margin-bottom: 0.2in">The global arguments are common to all the
  entry points, but each entry point may have its own specific settings. <br>
  At least one entry point must be specified in the configuration file.<br>
  <br>
  For some complete examples, look into</dt>
    <dd style="margin-bottom: 0.2in"><font
      face="monospace">glideinWMS/creation/config_examples/</font></dd>
</dl>

<h3><a name="args_global"></a>Suggested global arguments</h3>

<p>You definitely <b>need to set</b> the following arguments:</p>
<ul>
  <li><p><font face="monospace">&lt;</font><font face="monospace"><b>glidein
    glidein_name</b></font><font face="monospace">="</font><font
    face="monospace"><i>your name</i></font><font
    face="monospace">"&gt;</font><br>
    The name of the configuration. It will be used to advertise the entry
    points, will be defined as Condor glidein attribute <font
    face="monospace">GLIDEIN_Name</font>, and is used also to create the
    directory names.<br>
    <br>
    Choose a short name that describes the set of Grid resources it
    represents and append a version number (like <font
    face="monospace">"fnalcms_1"</font>). Starting with v2.0 of glideinWMS,
    you can use the <a href="index.html#reconfig_entry">factory reconfig tool
    </a> to make changes to the factory configuration. You will only need new
    configuration for the factories during major upgrade. For more details 
    refer the <a href="index.html#management">Glidein Factory management
    section</a></p>
  </li>
</ul>

<p>You <b>most probably want to set</b> the following arguments, too:</p>
<ul>
  <li><p style="margin-bottom: 0in"><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>submit
    base_dir</b></font><font face="monospace">="</font><font
    face="monospace"><i>directory</i></font><font
    face="monospace">"/&gt;</font><br>
    Where to create the glidein submit directory. The default is the user
    home directory. </p>
  </li>
  <li><p style="margin-bottom: 0in"><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>stage
    base_dir</b></font><font face="monospace">="</font><font
    face="monospace"><i>web dir</i></font><font face="monospace">"
    </font><font face="monospace"><b>web_base_dir</b></font><font
    face="monospace">="</font><font face="monospace"><i>URL</i></font><font
    face="monospace">"/&gt;</font><br>
    These two define where the Web server directories are located.<br>
    The defaults are reasonable, but you may have different needs. </p>
  </li>
  <li><p style="margin-bottom: 0in"><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>monitor
    base_dir</b></font><font face="monospace">="</font><font
    face="monospace"><i>web dir</i></font><font face="monospace">"
    <strong>javascriptRRD_dir</strong><font face="monospace">="</font><font
    face="monospace"><i><em>web dir</em></i></font>"
    <strong>flot_dir</strong><font face="monospace">="</font><font
    face="monospace"><i><em>web dir</em></i></font>"
    <strong>jquery_dir</strong><font face="monospace">="</font><font
    face="monospace"><i><em>web dir</em></i></font>" &gt;</font><br>
    The <strong>base_dir</strong> defines where the monitoring web are is.<br>
    The other entries point to where javascriptRRD, Flot and JQuery libraries
    are.</p>
  </li>
  <li><p style="margin-bottom: 0in">&lt;<font face="monospace"><b>glidein
    factory_name</b></font><font face="monospace">="</font><font
    face="monospace"><i>your name</i></font><font
    face="monospace">"&gt;</font><br>
    Changing this value from the name of the machine allows you to move the
    factory without disrupting the system. </p>
  </li>
  <li><p style="margin-bottom: 0in"><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein&gt;&lt;security allow_proxy</b></font><font
    face="monospace">="</font><font
    face="monospace"><em><i>frontend[,factory</i></em></font><font
    face="monospace"><em>]</em>"</font> <strong>pub_key<font
    face="monospace">="</font><font
    face="monospace"><i>RSA</i></font>"</strong>/&gt;<br>
    Enable the proxy passing between <a
    href="../frontend/index.html">frontend</a> and factory. Define if the
    frontend needs to pass a proxy (<em>"frontend"</em>), if it must use the
    factory one (<em>"factory"</em>), or if both methods are supported
    (<em>"frontend,factory"</em>).</p>
  </li>
</ul>

<p>Some other arguments you <b>might want to set</b>, are:</p>
<ul>
  <li><p style="margin-bottom: 0in"><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein schedd_name</b></font><font
    face="monospace">="</font><font face="monospace"><i>schedd name[,schedd
    name]*</i></font><font face="monospace">"&gt;</font><br>
    If you want to use multiple Condor schedds or you don't like the default
    name, you definitely need to set this. If you specify more than a single
    schedd, the various entries will be equally spread among all the listed
    schedds.<br>
    <br>
    Possible values include (but are not limited to) <font
    face="monospace">"myschedd@mymachine.mydomain"</font> and <font
    face="monospace">"myschedd_g1@mymachine.mydomain,myschedd_g2@mymachine.mydomain,myschedd_g3@mymachine.mydomain"</font>. 
    </p>
  </li>
  <li><p style="margin-bottom: 0in"><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein loop_delay</b></font><font
    face="monospace">="</font><font
    face="monospace"><i>seconds</i></font><font face="monospace">"</font>
    <font face="monospace"><b>advertise_delay</b></font><font
    face="monospace">="</font><font face="monospace"><i>nr</i></font><font
    face="monospace">" &gt;</font><br>
    Defines how active the glidein factory should be.<br>
    <br>
    The glidein factory works in polling mode.<br>
    <font face="monospace"><b>loop_delay</b></font> defines how much time
    should pass between each polling loop, with the collector being updated
    every <font face="monospace"><b>advertise_delay</b></font> loops. </p>
  </li>
  <li><p><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font
    face="monospace"><b>attrs</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>attr
    name="</b></font><font face="monospace"><i>attr name</i></font><font
    face="monospace"><b>"</b></font> <font
    face="monospace"><b>value</b></font><font face="monospace">="</font><font
    face="monospace"><i>value</i></font><font face="monospace">" </font><font
    face="monospace"><b>const="True"</b></font> <font
    face="monospace"><b>parameter="True" publish="True"
    glidein_publish="True" comment="</b></font><font
    face="monospace"><i><span
    style="font-weight: normal">comment</span></i></font><font
    face="monospace"><b>"</b></font><font face="monospace">/&gt;</font><br>
    Attributes you want to publish.<br>
    <br>
    These are used by the <a href="../frontend/index.html#match_expr">VO
    frontend matchmaking</a> and job matchmaking.<br>
    <br>
    Example attributes are:</p>
    <pre>&lt;attrs&gt;
 &lt;attr name="VOpilot" value="CMS" publish="True" parameter="True" const="True" glidein_publish="True" comment=”Just a test attribute”/&gt;
 &lt;attr name="CondorVersion" value="v6.9.1" publish="True" parameter="True" const="True" glidein_publish="True"/&gt;
&lt;/attrs&gt;</pre>
  </li>
  <li><p><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font
    face="monospace"><b>attrs</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>attr
    name="</b></font><font face="monospace"><i>attr name</i></font><font
    face="monospace"><b>"</b></font> <font
    face="monospace"><b>value</b></font><font face="monospace">="</font><font
    face="monospace"><i>value</i></font><font
    face="monospace">" </font><font
    face="monospace"><b>const="False"</b></font> <font
    face="monospace"><b>parameter="True" job_publish="True"
    comment="</b></font><font face="monospace"><i><span
    style="font-weight: normal">comment</span></i></font><font
    face="monospace"><b>"</b></font><font face="monospace">/&gt;</font><br>
    Attributes you want to push to the user jobs.<br>
    <br>
    A list of all the attributes can be found on the <a
    href="configuration_variables.html">dedicated configuration variables
    page</a>. </p>
  </li>
</ul>

<p><br>
The other arguments are for advanced admins only, and are explained in a <a
href="#advanced">dedicated section</a>.</p>

<h3><a name="args_entry"></a>Suggested entry point arguments</h3>

<p>Each entry point will have its own root tag:</p>
<ul>
  <li><p><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font
    face="monospace"><b>entries</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>entry
    name</b></font><font face="monospace">="</font><font
    face="monospace"><i>entry name</i></font><font
    face="monospace">"&gt;</font><br>
    Specify an easy to remember name.</p>
  </li>
</ul>

<p><br>
For each entry point, you definitely <b>need to set</b> the following
arguments:</p>
<ul>
  <li><p><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font
    face="monospace"><b>entries</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>entry
    name</b></font><font face="monospace">="</font><font
    face="monospace"><i>entry name</i></font><font face="monospace">"
    </font><font face="monospace"><b>gatekeeper</b></font><font
    face="monospace">="</font><font
    face="monospace"><i>gatekeeper</i></font><font
    face="monospace">"&gt;</font><br>
    The identifier of your Grid resource (like <font
    face="monospace">"cmsitbsrv01.fnal.gov/jobmanager-condor"</font>).<br>
    <br>
    <font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font
    face="monospace"><b>entries</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>entry
    name</b></font><font face="monospace">="</font><font
    face="monospace"><i>entry name</i></font><font face="monospace">"
    </font><font face="monospace"><b>rsl</b></font><font
    face="monospace">="</font><font face="monospace"><i>rsl</i></font><font
    face="monospace">"&gt; </font>may also be needed <br>
    (like '<font face="monospace">(condorsubmit=(universe
    vanilla)(requirements \"(ISMINOSAFS=?=True)\"))</font>'). <br>
    Please check the Grid site documentation and/or ask the Grid site
    administrator.<br>
    <br>
    The current implementation has been tested with Globus v2 Gatekeepers
    only, but if you want to test it with different Condor Grid types, please
    use <font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font
    face="monospace"><b>entries</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>entry
    name</b></font><font face="monospace">="</font><font
    face="monospace"><i>entry name</i></font><font face="monospace">"
    </font><font face="monospace"><b>gridtype</b></font><font
    face="monospace">="</font><font face="monospace"><i>grid
    type</i></font><font face="monospace">"&gt;</font> (<font
    face="monospace">"gt2"</font> is the default). </p>
  </li>
</ul>

<p>You <b>most probably want to set</b> the following arguments, too:</p>
<ul>
  <li><p style="margin-bottom: 0in"><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font
    face="monospace"><b>entries</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>entry
    name</b></font><font face="monospace">="</font><font
    face="monospace"><i>entry name</i></font><font
    face="monospace">"&gt;&lt;</font><font
    face="monospace"><b>attrs</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>attr
    name="GLIDEIN_Site"</b></font> <font
    face="monospace"><b>value</b></font><font face="monospace">="</font><font
    face="monospace"><i>value</i></font><font face="monospace">" </font><font
    face="monospace"><b>const="True"</b></font> <font
    face="monospace"><b>parameter="True" publish="True"</b></font><font
    face="monospace">/&gt;</font><br>
    This defines the glidein attribute <font
    face="monospace">GLIDEIN_Site</font>, both for use of the Frontend and
    for the use of the job negotiation.<br>
    <br>
    Logically defining a site is useful, so that you can change entry points
    but the user jobs do still known where they are running. If not
    specified, it defaults to the entry point name in the startd ClassAd. </p>
  </li>
  <li><p style="margin-bottom: 0in"><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font
    face="monospace"><b>entries</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>entry
    name</b></font><font face="monospace">="</font><font
    face="monospace"><i>entry name</i></font><font face="monospace">"
    </font><font face="monospace"><b>work_dir</b></font><font
    face="monospace">="</font><font face="monospace"><i>WN
    dir</i></font><font face="monospace">"&gt;</font><br>
    This argument defines where the glidein should run once on the worker
    node.<br>
    <br>
    Most OSG sites are known to crash if you use your starting directory to
    run. For those sites, it is good practice to specify <font
    face="monospace">"Condor"</font> if they are running Condor as the
    underlying batch system, and <font face="monospace">"OSG"</font> else.<br>
    <br>
    On EGEE sites, "." is usaully fine. </p>
  </li>
  <li><p><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font
    face="monospace"><b>entries</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>entry
    name</b></font><font face="monospace">="</font><font
    face="monospace"><i>entry name</i></font><font face="monospace">"
    </font><font face="monospace"><b>proxy_url</b></font><font
    face="monospace">="</font><font face="monospace"><i>Proxy
    URL</i></font><font face="monospace">"&gt;</font><br>
    If you have a Web cache you can use, you set it here (like <font
    face="monospace">"cmsitbsquid002.fnal.gov:3128"</font>).<br>
    On OSG resources, you can set it to <font face="monospace">"OSG"</font>,
    and the default OSG squid will be used.<br>
    <br>
    If you cannot use any Web cache server, you can skip this argument (the
    default is not to use caching). <br>
    <br>
    If defined, the user jobs will be able to use it as <font
    face="monospace">"GLIDEIN_Proxy_URL" </font>environment variable.</p>
  </li>
</ul>

<p>Some other arguments you <b>might want to set</b>, are:</p>
<ul>
  <li><p><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font
    face="monospace"><b>entries</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>entry
    name</b></font><font face="monospace">="</font><font
    face="monospace"><i>entry name</i></font><font
    face="monospace">"&gt;&lt;</font><font
    face="monospace"><b>attrs</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>attr
    name="</b></font><font face="monospace"><i>attr name</i></font><font
    face="monospace"><b>"</b></font> <font
    face="monospace"><b>value</b></font><font face="monospace">="</font><font
    face="monospace"><i>value</i></font><font face="monospace">" </font><font
    face="monospace"><b>const="True"</b></font> <font
    face="monospace"><b>parameter="True" publish="True"
    glidein_publish="True" comment="</b></font><font
    face="monospace"><i><span
    style="font-weight: normal">comment</span></i></font><font
    face="monospace"><b>"</b></font><font face="monospace">/&gt;</font><br>
    Attributes you want to publish.<br>
    <br>
    These are used by the <a href="../frontend/index.html#match_expr">VO
    frontend matchmaking</a> and job matchmaking.<br>
    <br>
    Example attributes are:</p>
    <pre>&lt;glidein&gt;
 &lt;entries&gt;
 &lt;entry name="myentry"&gt;
 &lt;attrs&gt;
 &lt;attr name="HasMySoftware" value="True" publish="True" parameter="True" const="True" glidein_publish="True" comment=”My users cannot live without”/&gt;
 &lt;attr name="OS" value="Linux" publish="True" parameter="True" const="True" glidein_publish="True"/&gt;
 &lt;/attrs&gt;</pre>
  </li>
  <li><p><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font
    face="monospace"><b>entries</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>entry
    name</b></font><font face="monospace">="</font><font
    face="monospace"><i>entry name</i></font><font face="monospace">"
    </font><font face="monospace"><b>schedd_name</b></font><font
    face="monospace">="</font><font face="monospace"><i>schedd
    name</i></font><font face="monospace">"&gt;</font><br>
    If you have an entry that needs a dedicated schedd, you can set it here
    (to something like <font
    face="monospace">"myveryspecialschedd@mymachine.mydomain")</font>  </p>
  </li>
  <li><p><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font
    face="monospace"><b>entries</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>entry
    name</b></font><font face="monospace">="</font><font
    face="monospace"><i>entry name</i></font><font face="monospace">"
    </font><font face="monospace"><b>enabled</b></font><font
    face="monospace">="</font><font
    face="monospace"><i>True/False</i></font><font
    face="monospace">"&gt;</font><br>
    You can define an entry point even if you do not plan to use it right
    away.<br>
    The entry point directory will be created independently of the <font
    face="monospace"><b>enabled</b></font> flag, but will only be used by the
    glidein factory if it is set to <font
    face="monospace"><b>True</b></font>. (Defaults to <font
    face="monospace"><b>True</b></font>). </p>
  </li>
  <li><p style="margin-bottom: 0in"><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font
    face="monospace">&gt;&lt;</font><font
    face="monospace"><b>entries</b></font><font
    face="monospace">&gt;&lt;</font><font face="monospace"><b>entry
    name</b></font><font face="monospace">="</font><font
    face="monospace"><i>entry name</i></font><font face="monospace">"
    </font><font face="monospace"><b>verbosity</b></font><font
    face="monospace">="</font><font
    face="monospace"><i>std/fast/nodebug</i></font><font
    face="monospace">"&gt;</font><br>
    Specify the verbosity level and termination time in case of validation
    errors: </p>
    <ul>
      <li><p style="margin-bottom: 0in">std (default) – reasonable
        verbosity (including the condor log files) and 20min sleep in case of
        error (to reduce the damage resulting from broken nodes) </p>
      </li>
      <li><p style="margin-bottom: 0in">fast – same verbosity as std, but
        will only wait 2 mins before terminating in case of error (good for
        debugging) </p>
      </li>
      <li><p>nodebug – very low verbosity, if you want to save on disk
        space </p>
      </li>
    </ul>
  </li>
</ul>

<p>The other arguments are for advanced admins only, and are explained
below.</p>

<h2><a name="advanced"></a>Advanced topics</h2>

<p>While the above is enough for setting up a personal glidein pool on the
local area network, you will need to do more fine tuning when deploying a
larger one. In this section, the various advanced aspects of glidein pools
will be presented. </p>

<h3><a name="glexec"></a>Integration with gLExec</h3>

<p>As you may have noticed, all of the glideins are submitted with the same
service proxy. While this has the advantage of simplifying the architecture
and improve both efficiency and VO control, it does have a few problems:</p>
<ul>
  <li><p style="margin-bottom: 0in">All glidein scripts and Condor daemons,
    AND user jobs all run under the same Unix UID. So users can interfere
    with the glidein tasks, possibly hacking the system. <br>
    Plus, when several glideins start on the same node (on multi
    processor/core machines), one user job can interfere with another user
    job. </p>
  </li>
  <li><p>The real user is never authenticated against the Grid site
    authorization infrastructure. This makes it impossible for the sites to
    enforce their policies, nor can they analyze the usage of their
    resources; they see only glideins. This makes them very unfriendly toward
    the glidein based WMS. </p>
  </li>
</ul>

<p>To solve this problem, some Grid sites are deploying gLExec on the worker
nodes. gLExec is a service that, taken</p>
<ul>
  <li><p style="margin-bottom: 0in">the user proxy, and </p>
  </li>
  <li><p>the desired command </p>
  </li>
</ul>
<dl>
  <dt>contacts the local authorization and mapping system, switches to the
  UID of the user (as opposed to the glidein UID), and executes the provided
  command as that UID. <br>
  <br>
  By using gLExec, a Glidein Factory can get rid of both of the above
  problems, and still keep all the advantages.<br>
  <br>
  To enable gLExec support, you need to specify:</dt>
    <dd><font face="monospace">&lt;</font><font
      face="monospace"><b>glidein</b></font><font face="monospace">&gt;<br>
       [entries&gt;&lt;entry&gt;]<br>
       &lt;</font><font face="monospace"><b>files</b></font><font
      face="monospace">&gt;<br>
         &lt;</font><font face="monospace"><b>file absfname</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>web_base/glexec_setup.sh</b></font><font
      face="monospace">"</font> <font
      face="monospace"><b>executable</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>True</b></font><font face="monospace">"/&gt;<br>
       &lt;</font><font face="monospace"><b>files</b></font><font
      face="monospace">/&gt;<br>
       &lt;</font><font face="monospace"><b>attrs</b></font><font
      face="monospace">&gt;<br>
        &lt;</font><font face="monospace"><b>attr name</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>GLEXEC_BIN</b></font><font face="monospace">"
      </font><font face="monospace"><b>value</b></font><font
      face="monospace">="</font><font face="monospace"><i>path to
      glexec</i></font><font face="monospace">" </font><font
      face="monospace"><b>publish</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>False</b></font><font face="monospace">"
      </font><font face="monospace"><b>parameter</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>True</b></font><font
    face="monospace">"/&gt;</font></dd>
  <dt style="margin-bottom: 0.2in"><br>
  <br>
  </dt>
  <dt style="margin-bottom: 0.2in">For most current gLExec installation this
  comes down to:</dt>
    <dd style="margin-bottom: 0.2in"><font face="monospace">&lt;</font><font
      face="monospace"><b>attr name</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>GLEXEC_BIN</b></font><font face="monospace">"
      </font><font face="monospace"><b>value</b></font><font
      face="monospace">=</font><font face="monospace"><b>"OSG"
      publish</b></font><font face="monospace">="</font><font
      face="monospace"><b>False</b></font><font face="monospace">"
      </font><font face="monospace"><b>parameter</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>True</b></font><font face="monospace">"/&gt;</font>
    </dd>
</dl>

<p>More details about scripts in general can be found in the <a
href="#custom_code">"custom code"</a> section. </p>
<dl>
  <dt style="margin-bottom: 0.2in">You will also need to properly configure
  the <b>shadow config files on the submit machine</b>, by adding: </dt>
    <dd style="margin-bottom: 0.2in"><font face="monospace">GLEXEC_STARTER =
      True<br>
      GLEXEC = /bin/false </font> </dd>
</dl>

<p>to the condor_config.</p>

<p>As of version 7.1.3 of Condor, a new, better glexec operation mode is
supported; in the old operation mode, condor_startd invoked condor_starter
through glexec. The result was that condor_starter was running under the same
UID as the user job, leaving it vulnerable to attack from a malicious user.
The new operating mode solves this by having condor_starter run the user jobs
via glexec; this adds a little more overhead to handle the user jobs, but
makes the system much more secure.</p>
<dl>
  <dt style="margin-bottom: 0.2in">To enable the new operation mode, add the
  following line to your configuration file:</dt>
    <dd style="margin-bottom: 0.2in"><font face="monospace">&lt;</font><font
      face="monospace"><b>attr name</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>GLEXEC_JOB</b></font><font face="monospace">"
      </font><font face="monospace"><b>value</b></font><font
      face="monospace">=</font><font face="monospace"><b>"True"
      publish</b></font><font face="monospace">="</font><font
      face="monospace"><b>False</b></font><font face="monospace">"
      </font><font face="monospace"><b>parameter</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>True</b></font><font face="monospace">"/&gt;</font>
    </dd>
</dl>

<p>Note that you still need to set <font
face="monospace"><b>GLEXEC_BIN</b></font>, too.<br>
<b>Warning</b>: Use it only if you use Condor 7.1.3 or later, as it will not
work on any older Condor version!</p>

<h4 style="margin-left: 0.39in"><a
name="glexec_troubleshooting"></a>Troubleshooting</h4>
<dl>
    <dd style="margin-bottom: 0.2in">gLExec installations on at least one
      site had problems with delegated proxies. If in doubt, try to disable
      the delegation.</dd>
    <dd style="margin-bottom: 0.2in">To disable delegation, add </dd>
  <dl>
      <dd style="margin-bottom: 0.2in"><font
        face="monospace">DELEGATE_JOB_GSI_CREDENTIALS=False<br>
        SEC_DEFAULT_ENCRYPTION=PREFERRED </font> </dd>
  </dl>
    <dd style="margin-bottom: 0.2in">to <b>the shadow configuration </b>file
      <br>
      and set in the glidein creation file:</dd>
  <dl>
      <dd style="margin-bottom: 0.2in"><font
        face="monospace">&lt;</font><font
        face="monospace"><b>glidein</b></font><font face="monospace">&gt;<br>
         [&lt;entries&gt;&lt;entry&gt;]<br>
          &lt;</font><font face="monospace"><b>attrs</b></font><font
        face="monospace">&gt; </font>  <font face="monospace"><br>
        </font>   <font face="monospace">&lt;</font><font
        face="monospace"><b>attr name</b></font><font
        face="monospace">="</font><font
        face="monospace"><b>SEC_DEFAULT_ENCRYPTION</b></font><font
        face="monospace">" </font><font
        face="monospace"><b>value</b></font><font
        face="monospace">="</font><font
        face="monospace"><b>REQUIRED</b></font><font face="monospace">"
        </font><font face="monospace"><b>publish</b></font><font
        face="monospace">="</font><font
        face="monospace"><b>False</b></font><font face="monospace">"
        </font><font face="monospace"><b>parameter</b></font><font
        face="monospace">="</font><font
        face="monospace"><b>True</b></font><font
        face="monospace">"/&gt;</font></dd>
  </dl>
    <dd style="margin-bottom: 0.2in"><br>
      Another thing to consider is the startup directory; it must be
      accessible by both the starting user and the target user(s). The
      directory you usually start in the Grid is most often not readable by
      any other user, so you must select something else. Both <font
      face="monospace">Condor</font> and <font face="monospace">OSG</font>
      should be fine, or you can specify any other fixed, WN-local
    location.</dd>
</dl>

<h3><a name="private_net"></a>Private networks and firewalls</h3>

<p>Condor daemons need two way communication in order to work properly. This
clashes with the network policies of most Grid sites, that have worker nodes
in private networks or implement a restrictive firewall. </p>

<p>Condor provides two mechanisms to address this: </p>
<ul>
  <li><a href="#gcb">GCB</a> and </li>
  <li><a href="#ccb">CCB</a> (since v7.3.0). </li>
</ul>

<h4><a name="gcb"></a>GCB - Generic Connection Broker</h4>
<dl>
  <dt style="margin-bottom: 0.2in">GCB was the first Condor implementation
  that allowed it to work in restrictive network environments. <br>
  The detailed description of GCB is beyond the scope of this manual and you
  should refer to the Condor documentation available at <a
  href="http://www.cs.wisc.edu/condor/manual/v7.2/3_7Networking_includes.html#sec:GCB">http://www.cs.wisc.edu/condor/manual/v7.2/3_7Networking_includes.html#sec:GCB</a>.
  Here you will find only the parameters needed to enable it in the
  glideins.<br>
  <br>
  To use Condor with GCB, you need to specify:</dt>
    <dd style="margin-bottom: 0.2in"><font face="monospace">&lt;</font><font
      face="monospace"><b>glidein</b></font><font face="monospace">&gt;<br>
       [entries&gt;&lt;entry&gt;]<br>
       &lt;</font><font face="monospace"><b>attrs</b></font><font
      face="monospace">&gt;<br>
        &lt;</font><font face="monospace"><b>attr name</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>GCB_LIST</b></font><font face="monospace">"
      </font><font face="monospace"><b>value</b></font><font
      face="monospace">="</font><font
      face="monospace"><i>IP[:PORT],IP[:PORT],...</i></font><font
      face="monospace">" </font><font
      face="monospace"><b>publish</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>False</b></font><font face="monospace">"
      </font><font face="monospace"><b>parameter</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>True</b></font><font face="monospace">"/&gt;<br>
      </font>  <font face="monospace">&lt;</font><font
      face="monospace"><b>attr name</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>GCB_ORDER</b></font><font face="monospace">"
      </font><font face="monospace"><b>value</b></font><font
      face="monospace">="</font><font
      face="monospace"><i><b>NONE|RANDOM</b></i></font><font
      face="monospace"><i>|</i></font><font
      face="monospace"><i><b>GCBLOAD</b></i></font><font
      face="monospace"><i>|</i></font><font
      face="monospace"><i><b>ROUNDROBIN</b></i></font><font
      face="monospace"><i>|</i></font><font
      face="monospace"><i><b>SEQUENTIAL</b></i></font><font
      face="monospace">" </font><font
      face="monospace"><b>publish</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>False</b></font><font face="monospace">"
      </font><font face="monospace"><b>parameter</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>True</b></font><font
    face="monospace">"/&gt;</font></dd>
</dl>

<p>where:</p>
<ul>
  <li><p style="margin-bottom: 0in"><font face="monospace">NONE</font><br>
    Do not use GCB (a good way to selectively disable it) </p>
  </li>
  <li><p style="margin-bottom: 0in"><font face="monospace">RANDOM</font><br>
    Randomly distributes between the listed GCBs </p>
  </li>
  <li><p style="margin-bottom: 0in"><font face="monospace">ROUNDROBIN</font>
    (or <font face="monospace">RR</font>)<br>
    Round robin between them, based on the job submission number. </p>
  </li>
  <li><p style="margin-bottom: 0in"><font face="monospace">SEQUENTIAL</font>
    (or <font face="monospace">SEQ</font>)<br>
    Keep the order. Essentially always tries the first one first (the others
    will be used only if the first one fails) </p>
  </li>
  <li><p><font face="monospace">GCBLOAD</font><br>
    Order by GCB load. All GCBs must support the <font
    face="monospace">freesockets</font> query and you must upload the <font
    face="monospace">gcb_broker_query</font> binary, too. See below. </p>
  </li>
</ul>
<dl>
  <dt>If your GCBs support <font face="monospace">freesockets</font> queries
  (v7.0 and above), you most probably want to protect your glideins from
  failing due to an overloaded GCB. To do that, <font
  face="monospace">gcb_broker_query</font> binary needs to be part of the
  Condor distribution you are using. You also need to decide what is the
  minimum number of free sockets you are comfortable with:</dt>
    <dd><font face="monospace">&lt;</font><font
      face="monospace"><b>glidein</b></font><font
      face="monospace">&gt;&lt;</font><font
      face="monospace"><b>attrs</b></font><font
      face="monospace">&gt;&lt;</font><font face="monospace"><b>attr
      name</b></font><font face="monospace">="</font><font
      face="monospace"><b>GCB_MIN_FREE</b></font><font face="monospace">"
      </font><font face="monospace"><b>value</b></font><font
      face="monospace">="</font><font
      face="monospace"><i>number</i></font><font face="monospace">"
      </font><font face="monospace"><b>publish</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>False</b></font><font face="monospace">"
      </font><font face="monospace"><b>parameter</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>True</b></font><font
    face="monospace">"/&gt;</font></dd>
  <dt>I would suggest you set it to at least 100, possibly more. Most Condor
  versions use around 5 sockets per VM (depending on configuration).<br>
  <br>
  You can also specify a default GCB port (defaults to <font
  face="monospace">65432)</font>:</dt>
    <dd><font face="monospace">&lt;</font><font
      face="monospace"><b>glidein</b></font><font
      face="monospace">&gt;&lt;</font><font
      face="monospace"><b>attrs</b></font><font
      face="monospace">&gt;&lt;</font><font face="monospace"><b>attr
      name</b></font><font face="monospace">="</font><font
      face="monospace"><b>GCB_PORT</b></font><font face="monospace">"
      </font><font face="monospace"><b>value</b></font><font
      face="monospace">="</font><font
      face="monospace"><i>port</i></font><font face="monospace">"
      </font><font face="monospace"><b>publish</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>False</b></font><font face="monospace">"
      </font><font face="monospace"><b>parameter</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>True</b></font><font
    face="monospace">"/&gt;</font></dd>
  <dt style="margin-bottom: 0.2in">although Condor GCB right now does not
  support any other port number.<br>
  <br>
  Also, for more flexibility, you can let <a
  href="../frontend/index.html#management">the frontends</a> to provide their
  own GCB servers, by setting <font
  face="monospace"><b>publish</b></font><font face="monospace">="</font><font
  face="monospace"><b>True</b></font><font face="monospace">" </font><font
  face="monospace"><b>const</b></font><font face="monospace">="</font><font
  face="monospace"><b>False</b></font><font face="monospace">"</font> .<br>
  <br>
  If you are more sophisticate, and want to use <a
  href="http://www.cs.wisc.edu/condor/manual/v7.0/3_7Networking_includes.html#SECTION00473500000000000000">GCB
  routing tables</a>, too, add:</dt>
    <dd style="margin-bottom: 0.2in"><font face="monospace">&lt;</font><font
      face="monospace"><b>glidein</b></font><font face="monospace">&gt;<br>
       [entries&gt;&lt;entry&gt;]<br>
       &lt;</font><font face="monospace"><b>files</b></font><font
      face="monospace">&gt;<br>
         &lt;</font><font face="monospace"><b>file absfname</b></font><font
      face="monospace">="</font><font face="monospace"><i>path to routing
      file</i></font><font face="monospace">" </font><font
      face="monospace"><b>relfname</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>gcb_route.cfg</b></font><font
      face="monospace">"/&gt;<br>
       &lt;</font><font face="monospace"><b>files</b></font><font
      face="monospace">/&gt;<br>
       &lt;</font><font face="monospace"><b>attrs</b></font><font
      face="monospace">&gt;<br>
        &lt;</font><font face="monospace"><b>attr name</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>GCB_REMAP_ROUTE</b></font><font face="monospace">"
      </font><font face="monospace"><b>value</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>gcb_route.cfg</b></font><font face="monospace">"
      </font><font face="monospace"><b>publish</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>False</b></font><font face="monospace">"
      </font><font face="monospace"><b>parameter</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>True</b></font><font
    face="monospace">"/&gt;</font></dd>
</dl>

<p><br>
Please be aware that the above will configure the glideins only; you still
need to properly configure the Collector and the submit machines. </p>

<h4><a name="ccb"></a>CCB - Condor Connection Broker</h4>
<dl>
  <dt style="margin-bottom: 0.2in">CCB was introduced in Condor v7.3.0 to
  replace GCB in most circumstances. It is much more reliable than GCB and
  also easier to setup. <br>
  The detailed description of CCB is beyond the scope of this manual and you
  should refer to the Condor documentation available at <a
  href="http://www.cs.wisc.edu/condor/manual/v7.3/3_7Networking_includes.html#sec:CCB">http://www.cs.wisc.edu/condor/manual/v7.3/3_7Networking_includes.html#sec:CCB</a>.
  Here you will find only the parameters needed to enable it in the
  glideins.<br>
  <br>
  To use Condor with CCB, you need to specify:</dt>
    <dd style="margin-bottom: 0.2in"><font face="monospace">&lt;</font><font
      face="monospace"><b>glidein</b></font><font face="monospace">&gt;<br>
       [entries&gt;&lt;entry&gt;]<br>
       &lt;</font><font face="monospace"><b>attrs</b></font><font
      face="monospace">&gt;<br>
        &lt;</font><font face="monospace"><b>attr name</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>USE_CCB</b></font><font face="monospace">"
      </font><font face="monospace"><b>value</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>True</b></font><font face="monospace">"
      </font><font face="monospace"><b>publish</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>False</b></font><font face="monospace">"
      </font><font face="monospace"><b>parameter</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>True</b></font><font face="monospace">"/&gt;<br>
      </font>  </dd>
</dl>

<p>and you are done. Just make sure you follow the <a
href="http://www.cs.wisc.edu/condor/manual/v7.3/3_7Networking_includes.html#sec:CCB">suggested
scalability guidelines described in the Condor manual</a>.</p>

<h3><a name="security"></a>Security handles</h3>

<p>As mentioned in the <a href="../index.html#pool_glidein">startup page</a>,
the glidein pool must be properly configured to protect it from hackers and
malicious users. The same page also describes what needs to be done on the
collector machine.<br>
The glidein itself can also be configured. The default configuration works
fine for most users, but you may need to change them.<br>
<br>
The values are set using the <font face="monospace"><b>&lt;attr
/&gt;</b></font> option, and the default values are:</p>
<ul>
  <li><p style="margin-bottom: 0in"><font
    face="monospace"><b>SEC_DEFAULT_ENCRYPTION</b></font>=<font
    face="monospace">OPTIONAL</font> </p>
  </li>
  <li><p style="margin-bottom: 0in"><font
    face="monospace"><b>SEC_DEFAULT_INTEGRITY</b></font>=<font
    face="monospace">REQUIRED</font> </p>
  </li>
  <li><p><font
    face="monospace"><b>DELEGATE_JOB_GSI_CREDENTIALS</b></font>=<font
    face="monospace">False</font> </p>
  </li>
</ul>

<p>As of Condor version 7.1.3 condor also supports a more efficient
authentication mechanism between the condor_schedd/condor_shadow and
condor_startd/condor_starter. This method uses the match ClaimId as a shared
password for authentication between these daemons. Since using a shared
secret is much cheaper that using GSI authentication, this should be used
every time it is feasible.</p>

<p>To enable this option, you need to set an attribute using the <font
face="monospace"><b>&lt;attr /&gt;</b></font> option:</p>
<ul>
  <li><p><font face="monospace"><b>USE_MATCH_AUTH</b></font>=<font
    face="monospace">True</font> </p>
  </li>
</ul>
<dl>
  <dt><br>
  </dt>
  <dt style="margin-bottom: 0.2in">You will also need to enable this on the
  <b>submit machin</b>e, by adding</dt>
    <dd style="margin-bottom: 0.2in"><font
      face="monospace">SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION =
    True</font></dd>
  <dt>to the <b>schedd condor_config</b>. Do not add this option to either
  the negotiator or collector as it will not work.</dt>
  <dt style="margin-bottom: 0.2in">Obviously, this will only work with Condor
  versions 7.1.3 and above.</dt>
</dl>

<h3><a name="tcp"></a>Using TCP to send updates to the Collector</h3>
<dl>
  <dt style="margin-bottom: 0.2in">By default, Condor uses UDP packets to
  communicate between the glideins and the Collector. While more efficient
  than TCP, UDP packets are often blocked at the firewall, or lost on the
  WAN. <br>
  <br>
  To switch on TCP updates, please specify, with the <font
  face="monospace">&lt;</font><font face="monospace"><b>attr</b></font> <font
  face="monospace">/&gt;</font> option:</dt>
    <dd style="margin-bottom: 0.2in"><font
      face="monospace"><b>UPDATE_COLLECTOR_WITH_TCP</b>=True</font></dd>
</dl>

<p><br>
Please be aware that this will configure the glideins only; you still need to
properly configure the Collector machine. See <a
href="http://www.cs.wisc.edu/condor/manual/v7.0/3_7Networking_includes.html#SECTION00474000000000000000">Condor
documentation</a> for more details.</p>

<h3><a name="multicol"></a>Multiple Collectors</h3>

<p>By default, Condor uses only one Collector for the <a
href="../index.html#pool_glidein">glidein (user) pool</a>.However, if the
load becomes too high, you can configure multiple collectors in a chain.<br>
<br>
You will need a master and a set of slave collectors. The slave collectors
forward the startd adds to the master collector.<br>
The negotiator and the schedds will talk to the master collector, while the
startds will talk to one of the slave ones. <br>
<br>
To set up slave collector in the <a href="../index.html#pool_glidein">glidein
(user) pool</a>, one way is to set the following env variables before
starting up the condor_master: </p>
<pre style="margin-left: 0.39in">COLH=`condor_config_val COLLECTOR_HOST`
LD=`condor_config_val LOCAL_DIR`
export _CONDOR_COLLECTOR_HOST=$COLH:
export _CONDOR_MASTER_NAME=collector_
export _CONDOR_DAEMON_LIST="MASTER, COLLECTOR"
export _CONDOR_LOCAL_DIR=$LD/$_CONDOR_MASTER_NAME
export _CONDOR_LOCK=$_CONDOR_LOCAL_DIR/lock
# Forward all the traffic to the main collector
export _CONDOR_CONDOR_VIEW_HOST=$COLH:9618</pre>
<dl>
    <dd style="margin-bottom: 0.2in">Once you have the slave collectors set
      up, you will want to use them. <br>
      <br>
      The <a href="../frontend/index.html">VO frontend</a> will have to point
      the factory to a <a href="../frontend/index.html#management">list of
      collectors</a>. <br>
      <br>
      However, by default the glideins expect a specific collector, so you
      need to add an additional script to handle this: </dd>
    <dd style="margin-bottom: 0.2in"><font face="monospace">&lt;</font><font
      face="monospace"><b>glidein</b></font><font face="monospace">&gt;<br>
       [entries&gt;&lt;entry&gt;]<br>
       &lt;</font><font face="monospace"><b>files</b></font><font
      face="monospace">&gt;<br>
         &lt;</font><font face="monospace"><b>file absfname</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>web_base/collector_setup.sh</b></font><font
      face="monospace">"</font> <font
      face="monospace"><b>executable</b></font><font
      face="monospace">="</font><font
      face="monospace"><b>True</b></font><font face="monospace">"/&gt;<br>
       &lt;</font><font face="monospace"><b>files</b></font><font
      face="monospace">/&gt;</font></dd>
</dl>

<h3><a name="start_rank"></a>Setting the glidein start and
rank condition</h3>

<p>As with any Condor pool, you may need to set the startd <a
href="http://www.cs.wisc.edu/condor/manual/v7.0/3_5Startd_Policy.html#SECTION00452000000000000000">start</a>
and <a
href="http://www.cs.wisc.edu/condor/manual/v7.0/3_5Startd_Policy.html#SECTION00454000000000000000">rank</a>
conditions. <br>
For a glidein, you can set this with the &lt;<b>attr</b> /&gt; options: </p>
<ul>
  <li><p style="margin-bottom: 0in"><font
    face="monospace"><b>GLIDEIN_Start</b>=<i>expression</i> </font> </p>
  </li>
  <li><p><font face="monospace"><b>GLIDEIN_Rank</b>=<i>expression</i> </font>
    </p>
  </li>
</ul>
<dl>
  <dt style="margin-bottom: 0.2in"><br>
  For example:</dt>
    <dd style="margin-bottom: 0.2in"><font
      face="monospace">&lt;<b>glidein</b>&gt;<br>
       [entries&gt;&lt;entry&gt;]<br>
        &lt;<b>attrs</b>&gt;<br>
          &lt;<b>attr name</b>="<b>GLIDEIN_Start</b>"
      <b>value</b>="<b>Owner==&amp;quot;sfiligoi&amp;quot;</b>"
      <b>publish</b>="<b>False</b>" <b>parameter</b>="<b>True</b>"/&gt;<br>
          &lt;<b>attr name</b>="<b>GLIDEIN_Rank</b>"
      <b>value</b>="<b>ImageSize</b>" <b>publish</b>="<b>False</b>"
      <b>parameter</b>="<b>True</b>"/&gt; </font> </dd>
</dl>

<h3><a name="time_limit"></a>Limiting time spent on a Grid resource</h3>

<p>The whole concept of gliding into Grid resources is based on the idea that
you are getting those resources on a <b>temporary basis</b>. This implies
that you need to leave the slot as soon as possible, else your jobs will
simply be killed by the annoyed Grid administrators.<br>
On the other hand, submitting new glideins is not cost free, so you want to
keep the resource for at least some period of time.<br>
<br>
The glideins have two mechanisms to regulate this:</p>
<ol>
  <li><p style="margin-bottom: 0in">After a specified amount of time, the
    glidein will enter the <a
    href="http://www.cs.wisc.edu/condor/manual/v7.0/3_5Startd_Policy.html#SECTION00457400000000000000">RETIRING
    state</a>. This means, it will wait for the current job to finish (or
    kill it if it does not end within a configurable timeout) and exit
    immediately afterwards. This obviously implies that no new jobs will
    start after it entered that state.<br>
    The two timeouts can be set with the &lt;<b>attr</b> /&gt; options: </p>
    <ul>
      <li><p style="margin-bottom: 0in"><font
        face="monospace"><b>GLIDEIN_Retire_Time</b>=<i>nr_of_seconds</i>
        </font> </p>
      </li>
      <li><p><font
        face="monospace"><b>GLIDEIN_Job_Max_Time</b>=<i>nr_of_seconds</i>
        </font> </p>
      </li>
    </ul>
    <p style="margin-bottom: 0in">The two default to 2 and 100 hours. </p>
  </li>
  <li><p style="margin-bottom: 0in">If a glidein is not claimed within a
    configurable timeout, the glidein will exit.<br>
    The timeout can be set qith: </p>
    <ul>
      <li><p><font
        face="monospace"><b>GLIDEIN_Max_Idle</b>=<i>nr_of_seconds</i> </font>
        </p>
      </li>
    </ul>
    <p>The default is 20 minutes. </p>
  </li>
</ol>
<dl>
  <dt style="margin-bottom: 0.2in">An example:</dt>
    <dd style="margin-bottom: 0.2in"><font
      face="monospace">&lt;<b>glidein</b>&gt;<br>
       [entries&gt;&lt;entry&gt;]<br>
        &lt;<b>attrs</b>&gt;<br>
          &lt;<b>attr name</b>="<b>GLIDEIN_Max_Idle</b>"
      <b>value</b>="<b>300</b>" <b>type</b>="<b>int</b>"
      <b>publish</b>="<b>False</b>" <b>parameter</b>="<b>True</b>"/&gt;<br>
          &lt;<b>attr name</b>="<b>GLIDEIN_Retire_Time</b>"
      <b>value</b>="<b>14400</b>" <b>type</b>="<b>int</b>"
      <b>publish</b>="<b>False</b>" <b>parameter</b>="<b>True</b>"/&gt;<br>
          &lt;<b>attr name</b>="<b>GLIDEIN_Job_Max_Time</b>"
      <b>value</b>="<b>180000</b>" <b>type</b>="<b>int</b>"
      <b>publish</b>="<b>False</b>" <b>parameter</b>="<b>True</b>"/&gt;
      </font> </dd>
</dl>

<h3><a name="multi-monitor"></a>Old-style pseudo-interactive monitoring</h3>

<p>Since v1_4_1, the pseudo-interactive monitoring uses a dedicated startd in
the glideins for monitoring purposes. This allows for monitoring even when
the job starter enters the “<i>Retiring”</i> activity.</p>

<p>The side effect is that you do not have anymore the cross-VM statistics
and the names of the slots is also different.</p>

<p>To enable the old mode, use:</p>
<dl>
    <dd style="margin-bottom: 0.2in"><font face="monospace">&lt;<b>attr
      name="MONITOR_MODE" const="True" glidein_publish="False"
      job_publish="False" parameter="True" publish="False" type="string"
      value="MULTI"/&gt;</b></font></dd>
</dl>

<h3><a name="custom_code"></a>Adding custom code/files to the glideins</h3>

<p>While provided code should cover most of the general purpose use cases,
some administrators may have additional needs. For these cases, the glidein
creation command adds the following options:</p>
<ul>
  <li><p><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font face="monospace">&gt;<br>
     [entries&gt;&lt;entry&gt;]<br>
     &lt;</font><font face="monospace"><b>files</b></font><font
    face="monospace">&gt;<br>
       &lt;</font><font face="monospace"><b>file absfname</b></font><font
    face="monospace">="</font><font face="monospace"><i>script
    name</i></font><font face="monospace">" </font><font
    face="monospace"><b>executable</b></font><font
    face="monospace">="</font><font face="monospace"><b>True</b></font><font
    face="monospace">"</font> <font
    face="monospace"><b>comment</b></font><font
    face="monospace">="</font><font
    face="monospace"><i>comment</i></font><font face="monospace">"/&gt;<br>
    </font>Path to the custom script.<br>
    <br>
    The script will be copied in the Web-accessible area, and when a glidein
    starts, the glidein startup script will pull it and execute it. If any
    parameters are needed, they can be specified using <b>&lt;attr
    /&gt;</b>, or stored in a file (see below).<br>
    <br>
    For more detailed information, see the page dedicated to <a
    href="custom_scripts.html">writing custom scripts</a>.</p>
  </li>
  <li><p><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font face="monospace">&gt;<br>
     [entries&gt;&lt;entry&gt;]<br>
     &lt;</font><font face="monospace"><b>files</b></font><font
    face="monospace">&gt;<br>
       &lt;</font><font face="monospace"><b>file absfname</b></font><font
    face="monospace">="</font><font face="monospace"><i>script
    name</i></font><font face="monospace">" </font><font
    face="monospace"><b>wrapper</b></font><font
    face="monospace">="</font><font face="monospace"><b>True</b></font>"
    <font face="monospace"><b>comment</b></font><font
    face="monospace">="</font><font
    face="monospace"><i>comment</i></font><font
    face="monospace">"</font>/&gt;<br>
    Path to the wrapper custom script.<br>
    <br>
    The script will be copied in the Web-accessible area, and will be sourced
    just before a user job starts starts; i.e. it will become part of the <a
    href="http://www.cs.wisc.edu/condor/manual/v7.2/3_3Configuration.html#16039">user
    job wrapper</a>.</p>
  </li>
  <li><p style="margin-bottom: 0in"><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font face="monospace">&gt;<br>
     [entries&gt;&lt;entry&gt;]<br>
     &lt;</font><font face="monospace"><b>files</b></font><font
    face="monospace">&gt;<br>
       &lt;</font><font face="monospace"><b>file absfname</b></font><font
    face="monospace">="</font><font face="monospace"><i>loacl file
    name</i></font><font face="monospace">" </font><font
    face="monospace"><b>relfname=</b></font><font
    face="monospace">"</font><font face="monospace"><i>target file
    name</i></font><font face="monospace">" </font><font
    face="monospace"><b>const=</b></font><font face="monospace">"</font><font
    face="monospace"><i>Bool</i></font><font face="monospace">" </font><font
    face="monospace"><b>executable</b></font><font
    face="monospace">="</font><font face="monospace"><b>False</b></font><font
    face="monospace">"</font> <font
    face="monospace"><b>comment</b></font><font
    face="monospace">="</font><font
    face="monospace"><i>comment</i></font><font face="monospace">"/&gt;<br>
    </font>Path to the config file.<br>
    <br>
    The file will be copied in the Web-accessible area, and pulled by the
    glidein startup script when a glidein starts. It can be then used by any
    script (see above). <br>
    <br>
    Please be cautious in using the <b>const</b> flag; if set to
    <b>False</b>, the content of the file will not be verified by the glidein
    startup script and could be tampered in transit by a malicious user. So
    never put sensitive data (like the switch to disable security checks) in
    a changeable file. </p>
  </li>
  <li><p style="margin-bottom: 0in"><font face="monospace">&lt;</font><font
    face="monospace"><b>glidein</b></font><font face="monospace">&gt;<br>
     [entries&gt;&lt;entry&gt;]<br>
     &lt;</font><font face="monospace"><b>files</b></font><font
    face="monospace">&gt;<br>
       &lt;</font><font face="monospace"><b>file absfname</b></font><font
    face="monospace">="</font><font face="monospace"><i>loacl file
    name</i></font><font face="monospace">" </font><font
    face="monospace"><b>untar</b></font><font face="monospace">="</font><font
    face="monospace"><b>True</b></font><font face="monospace">"</font> <font
    face="monospace"><b>comment</b></font><font
    face="monospace">="</font><font
    face="monospace"><i>comment</i></font><font face="monospace">"&gt;<br>
        &lt;</font><font face="monospace"><b>untar_options</b></font> <font
    face="monospace"><b>cond_attr</b></font><font
    face="monospace">="</font><font
    face="monospace"><i>conf_sw</i></font><font face="monospace">"
    </font><font face="monospace"><b>dir</b></font><font
    face="monospace">="</font><font face="monospace"><i>dir
    name</i></font><font face="monospace">" </font><font
    face="monospace"><b>absdir_outattr</b></font><font
    face="monospace">="</font><font face="monospace"><i>attr
    name</i></font>"&gt;<br>
    Sometimes it is useful to transfer a whole set of files, or even
    directories, and that is much easier to accomplish by means of a
    tar-ball. A subsystem is the glidein way to describe a compressed tarball
    that is delivered to the worker nodes, untarred in a separate directory
    and advertised to the other scripts.<br>
    <br>
    where: </p>
    <ul>
      <li><p style="margin-bottom: 0in"><font
        face="monospace"><b>absfname</b><br>
        Path to the costum tarball. (like "/tmp/mytar_v12.5.tgz") </font> </p>
      </li>
      <li><p style="margin-bottom: 0in"><font
        face="monospace"><b>conf_sw</b><br>
        Name of a configuration switch. (like "ENABLE_KRB5")<br>
        <br>
        The tarball will be unpacked only if that parameter will be set to 1.
        Use the <b>&lt;attr /&gt;</b> switch to define the default value.<br>
        A special name <b>TRUE</b> can be used to always untar it. </font>
        </p>
      </li>
      <li><p style="margin-bottom: 0in"><font face="monospace"><b>dir</b><br>
        Name of the subdirectory to untar it in. (like "krb5") </font> </p>
      </li>
      <li><p><font face="monospace"><b>absdir_outattr</b><br>
        Name of a variable name. (like "KRB5_SUBSYS_DIR")<br>
        <br>
        The variable will be set to the absolute path of the directory where
        the tarball was unpacked, if and only if the unpacking actually
        happened. It will not be define </font> </p>
      </li>
    </ul>
  </li>
</ul>

<p><a name="ref"></a>Please notice that files and subsystems will be
downloaded before the scripts, and that the user provided scripts will be
executed in the specified order, and before the Condor daemons are started
up.</p>

<table width="100%" border="0" cellpadding="2" cellspacing="2">
  <tbody>
    <tr valign="top">
      <td><h2 align="left">Repository</h2>

        <h3 align="left">CVSROOT</h3>

        <p align="left">cvsuser@cdcvs.fnal.gov:/cvs/cd</p>

        <h2 align="left">Package(s)</h2>

        <p align="left">glideinWMS/creation</p>
      </td>
      <td><h2 align="left">Author(s)</h2>

        <p align="left">Since Aug. 14th - Igor Sfiligoi (Fermilab Computing
        Division)</p>
      </td>
    </tr>
  </tbody>
</table>

<p><br>
<br>
<br>
</p>
</body>
</html>
