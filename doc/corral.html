<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <meta http-equiv="CONTENT-TYPE" content="text/html; charset=UTF-8">
  <title>glideinWMS - Corral</title>
  <meta name="CREATED" content="0;0">
  <meta name="CHANGED" content="20100521;20081031;14115200">    
  <link rel="stylesheet" type="text/css" href="common/glideinWMS.css" media="screen, projection" />
</head>

<body lang="en-US" dir="ltr">
    <h1>
        <a href="index.html">GlideinWMS</a>
	<span>The Glidein-based Workflow Management System</span>
    </h1>
    <ul class="breadcrumbs">
        <li><a href="./index.html">Home</a></li>
        <li>Corral</li>
    </ul>
    <div class="clear" />
    <div class="leftmenu">
        <ul class="components">
	<li> <a href="./index.html">Home</a></li>
	<li> <a href="./download.html">Download</a></li>
	<li> <a href="./frontend/index.html">Glidein Frontend</a></li>
    <li> <a href="./corral.html">Corral Frontend</a></li>
	<li> <a href="./factory/index.html">WMS Factory</a></li>
	<li> <a href="./components/index.html" >Components</a></li>
        <li> <a href="./recipes/index.html">Recipes</a></li>
	<li> <a href="./components/faq.html" class="last">FAQ</a></li>
        </ul>
        <div class="search">
            <script>
            (function() {
                var cx = '013439253731257915088:h-xvmglqvrq';
                var gcse = document.createElement('script');
                gcse.type = 'text/javascript';
                gcse.async = true;
                gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(gcse, s);
            })();
            </script>
            <gcse:search enableAutoComplete=true></gcse:search>
        </div>
    </div>
<div id="content" class="content">
    <div class="heading">
    <img align="right" width="280px" border="0px"
        src="./images/simple_diagram.png" usemap="#rightimage">
    <map name="rightimage">
        <area shape="rect" coords="90,3,177,60" href="frontend/index.html" />
        <area shape="rect" coords="5,88,118,146" href="components/collector_install.html" />
        <area shape="rect" coords="134,88,275,146" href="factory/index.html" />
        <area shape="rect" coords="189,3,274,60" target="_blank" href="./corral.html" />
    </map>
    <h2>GlideinWMS</h2>
	<ul class="subcomponents">
	     <li>Overview</li>
	     <li> <a href="./download.html">Download</a></li>
	     <li> <a href="./documentation.html">Documentation</a></li>
         <li> <a href="./install.html">Install</a></li>
	     <li> <a href="./history.html">History</a></li>
	     <li class="last"> <a href="./license.html">License</a></li>
	</ul>
    <div class="subheader">
        <h3>Overview</h3>
    </div>
	</div>
<div class="jump">
<u>Jump to:</u>
<ol>
    <li><a href="#intro">Introduction</a> </li>
    <li><a href="#install">Installation</a> </li>
    <li><a href="#usage">Usage Examples</a> </li>
</ol>
</div>
<div class="related">
<ul>
<li> <a href="http://pegasus.isi.edu">Pegasus Workflow System</a></li>
</ul>
</div>
<div class="section">
<a name="intro">
<h2>Introduction</h2>
<p><b>Corral is a lightweight frontend for glideinWMS. It is useful for individuals and when running across national cyberinfrastructures such as OSG and TeraGrid. It is also a useful tool when running
</a><a href="http://pegasus.isi.edu/" target="_blank">Pegasus</a> workflows.
</b></p>
<p>Although much work has been done in developing the national cyberinfrastructure in support of science, there is still a gap between the needs of the scientific applications and the capabilities provided by the resources. Leadership-class systems are optimized
 for highly-parallel, tightly coupled applications. Many scientific applications, however, are composed of a large number of loosely-coupled individual components, many with data and control dependencies. Running these complex, many-step workflows robustly
 and easily still poses difficulties on today?s cyberinfrastructure. One effective solution that allows applications to efficiently use the current cyberinfrastructure is resource provisioning using Condor glideins.
</p>
<p>GlideinWMS was initially developed to meet the needs of the CMS (Compact Muon Solenoid) experiment at the Large Hadron Collider (LHC) at CERN. It generalizes a Condor glideIn system developed for CDF (The Collider Detector at Fermilab) and first deployed
 for production in 2003. It has been in production across the Worldwide LHC Computing Grid (WLCG), with major contributions from the Open Science Grid (OSG) in support of CMS for the past two years, and has recently been adopted for user analysis. GlideinWMS
 also is currently being used by the CDF, DZero, and MINOS experiments, and servicing the NEBioGrid and Holland Computing Center communities. GlideinWMS has been used in production with more than 12,000 concurrently running jobs; the CMS use alone totals over
 45 million hours. </p>
<p>Corral, a tool developed to complement the Pegasus Workflow Management System was recently built to meet the needs of workflow-based applications running on the TeraGrid. It is being used today by the Southern California Earthquake Center (SCEC) CyberShake
 application. In a period of 10 days in May 2009, SCEC used Corral to provision a total of 33,600 cores and used them to execute 50 workflows, each containing approximately 800,000 application tasks, which corresponded to 852,120 individual jobs executed on
 the TeraGrid Ranger system. The 50-fold reduction from the number of workflow tasks to the number of jobs is due to job-clustering features within Pegasus designed to improve overall performance for workflows with short duration tasks.
</p>
<p>The integrated system provides a robust and scalable resource provisioning service that supports a broad set of domain application workflow and workload execution environments. The aim is to integrate and enable these services across local and distributed
 computing resources, the major national cyberinfrastructure providers (Open Science Grid and TeraGrid), as well as emerging commercial and community cloud environments.
</p>
<p><i>Funded by the National Science Foundation under the OCI SDCI program, grant #0943725</i>
</p>
</div>
<div class="section"><a name="install">
<h2>Installation</h2>
<p>There are two parts to a fully working system, a frontend and a factory. The frontend in this case is Corral, whereas the factory can either be installed locally, or you can use a hosted version at UCSD.</p>
<p>Installing the frontend is done by downloading the Corral frontend tar ball, untarring it and setting the CORRAL_HOME environment variable to point to the new install. Also add $CORRAL_HOME/bin to your path. The host your are deploying on should have GSI
 set up (host cert, grid-mapfile, ...).</p>
<h3>Configuration of submit host</h3>
<p>The submit host has to be set up to accept the glideins registering. This requires enabling GSI as an authentication method and it is pretty straightforward if the machine is not already part of a bigger pool. Replace the certificate DNs with the ones from
 your host and user certificate. Example condor_config.local file:</p>
<pre>
############################################################
## GSI Security config
############################################################

############################
# Authentication settings
############################
SEC_DEFAULT_AUTHENTICATION = REQUIRED
SEC_READ_AUTHENTICATION = OPTIONAL
SEC_WRITE_AUTHENTICATION = REQUIRED
SEC_CLIENT_AUTHENTICATION = OPTIONAL
SEC_DEFAULT_AUTHENTICATION_METHODS = FS,GSI
SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION = True
DENY_WRITE = anonymous@*
DENY_ADMINISTRATOR = anonymous@*
DENY_DAEMON = anonymous@*
DENY_NEGOTIATOR = anonymous@*
DENY_CLIENT = anonymous@*

############################
# Privacy settings
############################
SEC_DEFAULT_ENCRYPTION = OPTIONAL
SEC_DEFAULT_INTEGRITY = REQUIRED
SEC_READ_INTEGRITY = OPTIONAL
SEC_CLIENT_INTEGRITY = OPTIONAL
SEC_READ_ENCRYPTION = OPTIONAL
SEC_CLIENT_ENCRYPTION = OPTIONAL

# Grid Certificate directory
GSI_DAEMON_TRUSTED_CA_DIR=/etc/grid-security/certificates

############################
# Set daemon cert location
############################
GSI_DAEMON_DIRECTORY = /etc/condor

############################
# Credentials
############################
GSI_DAEMON_CERT = /etc/grid-security/hostcert.pem
GSI_DAEMON_KEY  = /etc/grid-security/hostkey.pem

#################################
# Where to find ID-&gt;uid mappings
#################################
CERTIFICATE_MAPFILE=/etc/condor/condor_mapfile

#####################################
# Add whitelist of condor daemon DNs
#####################################
GSI_DAEMON_NAME=/DC=org/DC=doegrids/OU=Services/CN=yggdrasil.isi.edu,/DC=org/DC=doegrids/OU=People/CN=Mats Rynge 274484

#####################################################
# With strong security, do not use IP based controls
#####################################################
HOSTALLOW_WRITE = *
ALLOW_WRITE = $(HOSTALLOW_WRITE)

#####################################
# Limit session caching to ~12h
#####################################
SEC_DAEMON_SESSION_DURATION = 50000
</pre>
<p>You also need a condor mapfile (/etc/condor/condor_mapfile in this case):</p>
<pre>

GSI &quot;/DC=org/DC=doegrids/OU=Services/CN=yggdrasil.isi.edu&quot; condor001
GSI &quot;/DC=org/DC=doegrids/OU=People/CN=Mats Rynge 274484&quot; condor003
GSI (.*) anonymous
FS (.*) \1
</pre>
<p>Check the CollectorLog for problems if the glideins do not work</p>
</div>
<div class="section"></a><a name="usage">
<h2>Usage Examples</h2>
<h3>Provisioner Description</h3>
<p>The way to tell Corral about your glidein needs, a XML configuration files is needed. Example:</p>
<pre>
&lt;corral-request&gt;

    &lt;local-resource-manager type=&quot;condor&quot;&gt;
        &lt;main-collector&gt;cwms-corral.isi.edu:9620&lt;/main-collector&gt;
        &lt;job-owner&gt;testuser&lt;/job-owner&gt;

        &lt;!-- alias for the site - make this match your Pegasus site catalog --&gt;
        &lt;pegasus-site-name&gt;Firefly&lt;/pegasus-site-name&gt;
    &lt;/local-resource-manager&gt;

    &lt;remote-resource type=&quot;glideinwms&quot;&gt;

        &lt;!-- get these values from the factory admin --&gt;
        &lt;factory-host&gt;cwms-factory.isi.edu&lt;/factory-host&gt;
        &lt;entry-name&gt;UNL&lt;/entry-name&gt;
        &lt;security-name&gt;corral_frontend&lt;/security-name&gt;
        &lt;security-class&gt;corral003&lt;/security-class&gt;

        &lt;!-- project is required when running on TeraGrid --&gt;
        &lt;project-id&gt;TG-...&lt;/project-id&gt;

        &lt;min-slots&gt;0&lt;/min-slots&gt;
        &lt;max-slots&gt;1000&lt;/max-slots&gt;

        &lt;!-- number of glideins to submit as one gram job --&gt;
        &lt;chunk-size&gt;1&lt;/chunk-size&gt;

        &lt;max-job-walltime&gt;600&lt;/max-job-walltime&gt;

        &lt;!--  List of entries for the grid-mapfile for the glideins. Include the daemon
              certificate of the collector, and the certificate of the user submitting the glideins.  --&gt;
        &lt;grid-map&gt;
            &lt;entry&gt;&quot;/DC=org/DC=doegrids/OU=People/CN=TestUser 001&quot; condor001&lt;/entry&gt;
            &lt;entry&gt;&quot;/DC=org/DC=doegrids/OU=Services/CN=cmws-corral.isi.edu&quot; condor002&lt;/entry&gt;
        &lt;/grid-map&gt;
    &lt;/remote-resource&gt;

&lt;/corral-request&gt;

</pre>
<p>&nbsp;</p>
<h3>Submitting the Request</h3>
<p>One you have created the request XML file you can submit it to Corral: </p>
<pre>
$ corral create-provisioner -h cwms-corral.isi.edu -f firefly.xml
</pre>
<p>&nbsp;</p>
<h3>Listing Provisioners</h3>
<pre>
$ corral list-provisioners -h cwms-corral.isi.edu

</pre>
<p>&nbsp;</p>
<h3>Removing provisioners</h3>
<pre>
$ corral remove-provisioner -h cwms-corral.isi.edu
</pre>


</div>
<div class="footer">
Banner image by 
<a href="http://www.flickr.com/people/leafwarbler/">Madhusudan Katti</a> 
used under Creative Commons license.<br/>
Original Home URL: <a href="http://glideinwms.fnal.gov">http://glideinwms.fnal.gov</a>.
glideinWMS email support: glideinwms-support at fnal.gov
</div>
</body>
</html>
