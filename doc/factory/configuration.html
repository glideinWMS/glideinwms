<!--
SPDX-FileCopyrightText: 2009 Fermi Research Alliance, LLC
SPDX-License-Identifier: Apache-2.0
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <meta http-equiv="CONTENT-TYPE" content="text/html; charset=UTF-8" />
    <title>GlideinWMS - Factory</title>
    <meta name="CREATED" content="0;0" />
    <meta name="CHANGED" content="20100521;20081031;14115200" />
    <link
      rel="stylesheet"
      type="text/css"
      href="../common/glideinWMS.css"
      media="screen, projection"
    />
    <link
      rel="canonical"
      href="https://glideinwms.fnal.gov/doc.prd/factory/configuration.html"
    />
  </head>

  <body lang="en-US" dir="ltr">
    <h1>
      <a href="index.html">GlideinWMS</a>
      <span>The Glidein-based Workflow Management System</span>
    </h1>
    <ul class="breadcrumbs">
      <li><a href="../index.html">Home</a></li>
      <li><a href="./index.html">WMS Factory</a></li>
      <li>Configuration</li>
    </ul>
    <div class="clear" />
    <div class="leftmenu">
      <ul class="components">
        <li><a href="../index.html">Home</a></li>
        <li><a href="../download.html">Download</a></li>
        <li><a href="../frontend/index.html">Glidein Frontend</a></li>
        <li><a href="../factory/index.html">WMS Factory</a></li>
        <li><a href="../components/index.html">Components</a></li>
        <li><a href="../recipes/index.html">Recipes</a></li>
        <li><a href="../components/faq.html" class="last">FAQ</a></li>
      </ul>
      <div class="search">
        <script>
          (function () {
            var cx = "013439253731257915088:h-xvmglqvrq";
            var gcse = document.createElement("script");
            gcse.type = "text/javascript";
            gcse.async = true;
            gcse.src = "https://cse.google.com/cse.js?cx=" + cx;
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(gcse, s);
          })();
        </script>
        <gcse:search enableAutoComplete="true"></gcse:search>
      </div>
    </div>
    <div class="content">
      <div class="heading">
        <img
          align="right"
          width="280px"
          border="0px"
          src="../images/simple_diagram.png"
          usemap="#rightimage"
        />
        <map name="rightimage">
          <area
            shape="rect"
            coords="90,3,177,60"
            href="../frontend/index.html"
            alt="Frontend"
          />
          <area
            shape="rect"
            coords="5,88,118,146"
            href="../components/user_pool.html"
            alt="Collector"
          />
          <area
            shape="rect"
            coords="134,88,275,146"
            href="../factory/index.html"
            alt="Factory"
          />
        </map>

        <h2>WMS Factory</h2>
        <ul class="subcomponents">
          <li><a href="./index.html">Overview</a></li>
          <li><a href="./details.html">Details</a></li>
          <li>Configuration</li>
          <li><a href="./design.html">Design</a></li>
          <li><a href="./monitoring.html">Monitoring</a></li>
          <li class="last">
            <a href="./troubleshooting.html">Troubleshooting</a>
          </li>
        </ul>
        <h3>Configuration</h3>
      </div>
      <div class="jump">
        <u>Jump to:</u>
        <ol>
          <li><a href="#example_configuration">Example Configuration</a></li>
          <li><a href="#args">Configuration File</a></li>
          <li><a href="#attr_substitution">Attribute substitution</a></li>
          <li><a href="#metasites">Grouping entries into metasites</a></li>
          <li><a href="#single_user">Single user (upgrade to 3.5)</a></li>
          <li><a href="#singularity">Singularity</a></li>
          <li><a href="#glexec">glExec</a></li>
          <li><a href="#private_net">Private Networks</a></li>
          <li><a href="#security">Security</a></li>
          <li><a href="#tcp">TCP Updates</a></li>
          <li>
            <a href="#custom_code"
              >Adding custom files/scripts to the glideins</a
            >
          </li>
          <li><a href="#multicol">Multiple Collectors</a></li>
          <li><a href="#tarballs">Multiple HTCondor Tarballs</a></li>
          <li>
            <a href="#xsltplugins">XSLT Plugins to extend configuration</a>
          </li>
          <li>
            <a href="#sitecollector"
              >Glidein's Startd Advertising to Site HTCondor-CE Collector</a
            >
          </li>
          <li>
            <a href="#reconfigure_hooks">Running pre/post reconfigure hooks</a>
          </li>
        </ol>
      </div>
      <div class="related">
        Related Links: <br />
        <ul>
          <li><a href="./custom_scripts.html">Custom Scripts</a></li>
          <li><a href="./custom_vars.html">Custom Variables</a></li>
          <li><a href="../components/tools.html">Tools</a></li>
        </ul>
      </div>
      <div class="section">
        <a name="example_configuration"></a>
        <h2>Example Configuration</h2>
        Below is an example Factory configuration xml file. Click on any piece
        for a more detailed description.
        <div class="config">
          <a href="#glidein"
            >&lt;glidein advertise_delay="5" factory_name="factory-dstrain"
            glidein_name="v2_4" loop_delay="60" restart_attempts="3"
            restart_interval="1800" schedd_name="schedd
            glideins1@submit.fnal.gov,schedd_glideins2@submit.fnal.gov"
            factory_collector="submit.fnal.gov:9618"
            entry_parallel_workers="0"&gt;</a
          ><br />
          <blockquote>
            <a href="#">&lt;log_retention &gt;</a><br />
            <blockquote>
              <a href="#"
                >&lt;condor_logs max_days="14.0" max_mbytes="100.0"
                min_days="3.0" /&gt;</a
              ><br />
              <a href="#"
                >&lt;job_logs max_days="7.0" max_mbytes="100.0" min_days="3.0"
                /&gt;</a
              ><br />
              <a href="#">&lt;process_logs &gt;</a><br />
              <blockquote>
                <a href="#process_logs"
                  >&lt;process_log extension="info" max_days="7.0"
                  max_mbytes="100.0" min_days="3.0" msg_types="INFO"
                  backup_count="5" compression="gz" /&gt;</a
                ><br />
                <a href="#process_logs"
                  >&lt;process_log extension="debug" max_days="7.0"
                  max_mbytes="100.0" min_days="3.0" msg_types="DEBUG,ERR,WARN"
                  backup_count="5" /&gt;</a
                ><br />
              </blockquote>
              <a href="#">&lt;/process_logs &gt;</a><br />
              <a href="#"
                >&lt;summary_logs max_days="31.0" max_mbytes="100.0"
                min_days="3.0" /&gt;</a
              ><br />
            </blockquote>
            <a href="#">&lt;/log_retention &gt;</a><br />
            <a href="#monitor"
              >&lt;monitor base_dir="/var/www/html/glidefactory/monitor"
              flot_dir="/opt/javascriptrrd-0.6.3/flot"
              javascriptRRD_dir="/opt/javascriptrrd-0.6.3/src/lib"
              jquery_dir="/opt/javascriptrrd-0.6.3/flot" /&gt;</a
            ><br />
            <a href="#monitor_footer"
              >&lt;monitor_footer display_txt="Legal Disclaimer"
              href_link="/site/disclaimer.html" /&gt;</a
            ><br />
            <a href="#security"
              >&lt;security key_length="2048" pub_key="RSA"
              reuse_oldkey_onstartup_gracetime="900" remove_old_cred_freq="24"
              remove_old_cred_age="30"/&gt;</a
            ><br />
            <blockquote>
              <a href="#security">&lt;frontends &gt;</a><br />
              <blockquote>
                <a href="#security_frontend"
                  >&lt;frontend name="vofrontend"
                  identity="vofrontend@vofrontend.fnal.gov" &gt;</a
                ><br />
                <blockquote>
                  <a href="#security_class">&lt;security_classes &gt;</a><br />
                  <blockquote>
                    <a href="#security_class"
                      >&lt;security_class name="frontend" username="frontend1"
                      /&gt;</a
                    ><br />
                  </blockquote>
                  <a href="#security_class">&lt;/security_classes &gt;</a><br />
                </blockquote>
                <a href="#security_frontend">&lt;/frontend &gt;</a><br />
              </blockquote>
              <a href="#security_frontend">&lt;/frontends &gt;</a><br />
            </blockquote>
            <a href="#security">&lt;/security &gt;</a><br />
            <a href="#stage"
              >&lt;stage base_dir="/var/www/html/glidefactory/stage"
              use_symlink="True"
              web_base_url="http://factory.fnal.gov:9000/glidefactory/stage"/&gt;</a
            ><br />
            <a href="#submit"
              >&lt;submit base_client_log_dir="/opt/clientlogs/clients/logs"
              base_client_proxies_dir="/opt/clientlogs/clients/proxies"
              base_dir="/opt/wmsfactory/" base_log_dir="/opt/wmsfactory/logs"
              num_factories="1" /&gt;</a
            ><br />
            <a href="#attrs">&lt;attrs&gt;</a><br />
            <blockquote>
              <a href="#attrs"
                >&lt;attr name="CONDOR_VERSION" const="True"
                glidein_publish="False" job_publish="False" parameter="True"
                publish="False" type="string" value="default" /&gt;</a
              ><br />
              <a href="#attrs"
                >&lt;attr name="USE_CCB" const="True" glidein_publish="True"
                job_publish="False" parameter="True" publish="True"
                type="string" value="False" /&gt;</a
              ><br />
              <a href="#attrs"
                >&lt;attr name="USE_MATCH_AUTH" const="False"
                glidein_publish="False" job_publish="False" parameter="True"
                publish="True" type="string" value="True" /&gt;</a
              ><br />
              <a href="#attrs"
                >&lt;attr name="GLIDEIN_MaxMemMBs" const="True"
                glidein_publish="True" job_publish="False" parameter="True"
                publish="True" type="int" value="2500" /&gt;</a
              ><br />
              <a href="#attrs"
                >&lt;attr name="PBS_RSL" const="True" glidein_publish="False"
                job_publish="False" parameter="False" publish="False"
                type="string"
                value="(queue=default)(jobtype=single)(maxWalltime=$$(GLIDEIN_Max_Walltime))(memory=$$(GLIDEIN_MaxMemMBs))"
                /&gt;</a
              ><br />
            </blockquote>
            <a href="#attrs">&lt;/attrs&gt;</a><br />
            <a href="#entry">&lt;entries&gt;</a><br />
            <blockquote>
              <a href="#entry"
                >&lt;entry name="EXAMPLE_ENTRY" enabled="True"
                auth_method="grid_proxy" trust_domain="OSG"
                gatekeeper="gatewayname.fnal.gov gatewayname.fnal.gov:port"
                gridtype="condor" rsl="$(PBS_RSL)" verbosity="std"
                work_dir="OSG"&gt;</a
              ><br />
              <blockquote>
                <a href="#config">&lt;config&gt;</a><br />
                <blockquote>
                  <a href="#config">&lt;max_jobs&gt;</a><br />
                  <blockquote>
                    <a href="#config"
                      >&lt;per_entry held="1000" idle="2000"
                      glideins="10000"/&gt;</a
                    ><br />
                    <a href="#config"
                      >&lt;default_per_frontend held="50" idle="100"
                      glideins="5000"/&gt;</a
                    ><br />
                    <a href="#config">&lt;per_frontends&gt;</a><br />
                    <blockquote>
                      <a href="#config"
                        >&lt;per_frontend name="FRONTEND:SECURITY_CLASS"
                        held="50" idle="100" glideins="5000"/&gt;</a
                      ><br />
                    </blockquote>
                    <a href="#config">&lt;/per_frontends&gt;</a><br />
                  </blockquote>
                  <a href="#config">&lt;/max_jobs&gt;</a><br />
                  <a href="#config"
                    >&lt;release max_per_cycle="20" sleep="0.2"/&gt;</a
                  ><br />
                  <a href="#config"
                    >&lt;remove max_per_cycle="5" sleep="0.2"/&gt;</a
                  ><br />
                  <a href="#config"
                    >&lt;submit cluster_size="10" max_per_cycle="100"
                    sleep="0.2" slots_layout="partitionable"&gt;</a
                  ><br />
                  <blockquote>
                    <a href="#config">&lt;submit_attrs&gt;</a><br />
                    <blockquote>
                      <a href="#config"
                        >&lt;submit_attr name="RequestMemory"
                        value="2000"/&gt;</a
                      ><br />
                    </blockquote>
                    <a href="#config">&lt;submit_attrs/&gt;</a><br />
                  </blockquote>
                  <a href="#config">&lt;/submit&gt;</a><br />
                </blockquote>
                <a href="#">&lt;/config&gt;</a><br />
                <a href="#allow_frontend">&lt;allow_frontends /&gt;</a><br />
                <a href="#attrs">&lt;attrs&gt;</a><br />
                <blockquote>
                  <a href="#entry_attrs"
                    >&lt;attr name="CONDOR_ARCH" const="True"
                    glidein_publish="False" job_publish="False" parameter="True"
                    publish="False" type="string" value="default"/&gt;</a
                  ><br />
                  <a href="#entry_attrs"
                    >&lt;attr name="CONDOR_OS" const="True"
                    glidein_publish="False" job_publish="False" parameter="True"
                    publish="False" type="string" value="default" /&gt;</a
                  ><br />
                  <a href="#entry_attrs"
                    >&lt;attr name="GLIDEIN_Site" const="True"
                    glidein_publish="True" job_publish="True" parameter="True"
                    publish="True" type="string"
                    value="FNAL_EXAMPLE_SITE"/&gt;</a
                  ><br />
                  <a href="#entry_attrs"
                    >&lt;attr name="GLIDEIN_CPUS" const="True"
                    glidein_publish="True" job_publish="True" parameter="True"
                    publish="True" type="string" value="1"/&gt;</a
                  ><br />
                  <a href="#entry_attrs"
                    >&lt;attr name="GLIDEIN_Max_Walltime" const="True"
                    glidein_publish="False" job_publish="False" parameter="True"
                    publish="True" type="int" value="171000"/&gt;</a
                  ><br />
                  <a href="#entry_attrs">&lt;attr /&gt;</a><br />
                </blockquote>
                <a href="#entry_attrs">&lt;/attrs&gt;</a><br />
                <a href="#monitorgroups">&lt;monitorgroups/&gt;</a><br />
                <a href="#custom_code">&lt;files/&gt;</a><br />
                <a href="#infosys">&lt;infosys_refs /&gt;</a><br />
              </blockquote>
              <a href="#entry">&lt;/entry&gt;</a><br />
            </blockquote>
            <a href="#entry">&lt;/entries&gt;</a><br />
            <a href="#files">&lt;files&gt;</a><br />
            <blockquote>
              <a href="#files"
                >&lt;file absfname="/usr/conf/sethome.source"
                after_entry="False" const="True" executable="False"
                untar="False" wrapper="True" /&gt;</a
              ><br />
            </blockquote>
            <a href="#files">&lt;/files&gt;</a><br />
            <a href="#cvmfsexec_distro"
              >&lt;cvmfsexec_distro sources="" platforms="" /&gt;</a
            ><br />
            <a href="#condor_tarball">&lt;condor_tarballs&gt;</a><br />
            <blockquote>
              <a href="#condor_tarball"
                >&lt;condor_tarball arch="default" base_dir="/opt/wmscollector/"
                os="default"
                tar_file="/var/www/html/glidefactory/stage/glidein_v2_4/condor_bin_default-default-default.a83ePm.tgz"
                version="default"/&gt;</a
              ><br />
            </blockquote>
            <a href="#condor_tarball">&lt;/condor_tarballs&gt;</a><br />
            <a href="#factmoncollector">&lt;monitoring_colectors&gt;</a><br />
            <blockquote>
              <a href="#factmoncollector"
                >&lt;monitoring_colector
                DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector.fnal.gov"
                node="factmoncollector.fnal.gov" secondary="False"
                group="default" /&gt;</a
              ><br />
              <a href="#factmoncollector"
                >&lt;monitoring_colector
                DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector.fnal.gov"
                node="factmoncollector.fnal.gov:9620-9819" secondary="True"
                group="default" /&gt;</a
              ><br />
              <a href="#factmoncollector"
                >&lt;monitoring_colector
                DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector2.fnal.gov"
                node="factmoncollector2.fnal.gov" secondary="False" group="ha"
                /&gt;</a
              ><br />
              <a href="#factmoncollector"
                >&lt;monitoring_colector
                DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector2.fnal.gov"
                node="factmoncollector2.fnal.gov:9620-9919" secondary="True"
                group="ha" /&gt;</a
              ><br />
            </blockquote>
            <a href="#factmoncollector">&lt;/monitoring_colectors&gt;</a><br />
          </blockquote>
          <a href="#glidein">&lt;/glidein&gt;</a><br />
        </div>
      </div>

      <div class="section">
        <h2 class="western"><a name="args"></a>The configuration file</h2>

        <p>
          The configuration file is a XML document. It contains both global
          arguments as well as specific configuration to each entry point. At
          least one entry point must be specified in the configuration file.
        </p>
        <p>
          The tags of the XML configuration file are described below. Each is
          given a designation:
        </p>
        <ul>
          <li>
            <b>Required:</b> You must change or examine this in order for the
            Factory to function correctly.
          </li>
          <li>
            <b>Recommended:</b> The installer provides a good default, but you
            should examine this attribute to make sure it is correct for your
            installation.
          </li>
          <li>
            <b>Optional:</b> The installer-provided default is likely correct
            for your installation. Change this only if your particular
            configuration requires special treatment or fine-tuning.
          </li>
        </ul>
      </div>

      <div class="section">
        <h3 class="western"><a name="args_global"></a>Global arguments</h3>
        <p>
          Global arguments are common to all entry points but can be overridden
          by individual entry point configuration.
        </p>

        <ul>
          <li>
            <a name="glidein" />
            <div class="xml">&lt;glidein ... &gt;</div>
            <p>
              <b>Required:</b> The main tag of the Factory configuration. See
              below for the parameters for this tag:
            </p>

            <ul>
              <li>
                <p></p>
                <div class="xml">
                  &lt;glidein glidein_name=&quot;<i>your name</i>&quot;&gt;
                </div>
                <b>Required:</b> The name of the configuration. It will be used
                to advertise the entry points, will be defined as HTCondor
                glidein attribute <tt>GLIDEIN_Name</tt>, and is used also to
                create the directory names. Choose a short name that describes
                the set of Grid resources . It represents and append a version
                number (like <tt>&quot;fnalcms_1&quot;</tt>). Starting with v2.0
                of GlideinWMS, you can use the
                <a href="index.html#reconfig_entry">Factory reconfig tool </a>
                to make changes to the Factory configuration. You will only need
                new configuration for the factories during major upgrade. For
                more details refer the
                <a href="index.html#management"
                  >Glidein Factory management section</a
                >
              </li>
              <li>
                <div class="xml">
                  &lt;glidein factory_name=&quot;<i>your name</i>&quot;&gt;
                </div>
                <b>Recommended:</b> Changing this value from the name of the
                machine allows you to move the Factory without disrupting the
                system.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein schedd_name=&quot;<i>schedd name[,schedd name]*</i
                  >&quot;&gt;
                </div>
                <b>Recommended:</b> If you want to use multiple HTCondor schedds
                or you don't like the default name, you definitely need to set
                this. If you specify more than a single schedd, the various
                entries will be equally spread among all the listed schedds.
                Possible values include (but are not limited to): <br />
                <tt>&quot;myschedd@mymachine.mydomain&quot;</tt><br />
                <tt
                  >&quot;myschedd_g1@mymachine.mydomain,myschedd_g2@mymachine.mydomain,myschedd_g3@mymachine.mydomain&quot;</tt
                ><br />
              </li>
              <li>
                <div class="xml">
                  &lt;glidein
                  factory_collector=&quot;<i>collector_name:port</i>&quot;&gt;
                </div>
                <b>Recommended:</b> You can have a dedicated collector serving
                just for message passing with the Frontend.<br />
                If this is not set, the default collector will be used, which
                also happens to be used to advertise the internal HTCondor-G
                ClassAds. That's undersirable both for security reasons, and
                also because frequent HTCondor-G updates tend to load it
                heavily.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein loop_delay=&quot;<i>seconds</i>&quot;
                  advertise_delay=&quot;<i>nr</i>&quot; &gt;
                </div>
                <b>Optional:</b> Defines how active the glidein Factory should
                be. The glidein Factory works in polling mode.
                <tt><b>loop_delay</b></tt> defines how much time should pass
                between each polling loop, with the collector being updated
                every <tt><b>advertise_delay</b></tt> loops.
              </li>

              <li>
                <div class="xml">
                  &lt;glidein restart_attempts=&quot;<i>nr</i>&quot;
                  restart_interval=&quot;<i>seconds</i>&quot; &gt;
                </div>
                <b>Optional:</b> Defines how many times restart_attempts should
                be applied within restart_interval seconds for an entry if the
                entry crashes.
              </li>
              <li>
                <div class="xml">
                  &lt;recoverable_exitcodes=&quot;<i>N,M,...</i>&quot; &gt;
                </div>
                <b>Optional:</b> Comma separated list of condor
                HoldReasonCode/HoldReasonSubCode that are going to be retried.
                For each code, a lis of space separated subcodescan be
                specified. Subcodes are optional. All codes must be integers.
                Example: recoverable_exitcodes="c1, c2 s1, c3 s1 s3 s4, ..."
              </li>
              <li>
                <div class="xml">
                  &lt;glidein advertise_with_tcp=&quot;<i>True|False</i>&quot;
                  &gt;
                </div>
                <b>Optional:</b> Defines if the Factory should use TCP to
                advertise its ClassAds.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein
                  advertise_with_multiple=&quot;<i>True|False</i>&quot; &gt;
                </div>
                <b>Optional:</b> Defines if the Factory should use -multiple to
                advertise its ClassAds.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein
                  advertise_pilot_accounting=&quot;<i>True|False</i>&quot; &gt;
                </div>
                <b>Optional:</b> Defines if the Factory should condor_qedit
                pilot jobs after they finishes to add accounting information. A
                ClassAd MONITOR_INFO will be added and jobs will be left in the
                Complete state for 12 hours.
              </li>
            </ul>
          </li>
          <li>
            <a name="process_logs" />
            <div class="xml">
              &lt;glidein&gt;&lt;log_retention&gt;&lt;process_logs&gt;&lt;process_log
              max_days=&quot;<i>max days</i>&quot; min_days=&quot;<i>min days</i
              >&quot; max_bytes=&quot;<i>max bytes</i>&quot;
              type=&quot;<i>INFO</i>&quot; backup_count=&quot;<i>backup count</i
              >&quot; compression=&quot;<i>gz</i>&quot;/&gt;
            </div>
            <p>
              The admin can configure one or more logs with any combination of
              following log message types:
            </p>
            <ul>
              <li>
                INFO: Informational messages about the state of the system.
              </li>
              <li>
                DEBUG: Debug message. These are additional informational
                messages that describe code execution in detail.
              </li>
              <li>ERR: Error messages. These may include tracebacks.</li>
              <li>
                WARN: Warning messages. These warn of conditions that were found
                that don't necessarily cause abnormal execution.
              </li>
              <li>
                ADMIN: This is a special setting only applicable to Factory logs
                (and not entry logs) that contains admin messages, such as
                reconfig comments. This will create a new log called
                factoryadmin.extension.log. Currently, it cannot be combined
                with other message types.
              </li>
            </ul>
            The extension is added to the log name to create separate logs.
            <br /><br />
            <b>Log Retention and Rotation Policy:</b>
            <br /><br />
            Log files are rotated based on a time and size of the log files as
            follows:
            <ul>
              <li>
                If the log file size reaches <i>max_bytes</i> it will be rotated
                (NOTE: the value will be truncated and 0 means no rotation).
              </li>
              <li>
                If the log file size is less that <i>max_bytes</i> but the file
                is older than max_days, it will be rotated.
              </li>
              <li>
                <i>min_days</i> is not used and is there for backwards
                compatibility.
              </li>
              <li>
                Rotated files may be compressed. Supported compressions are Gzip
                "gz" and Zip "zip". Default is no compression (empty string).
              </li>
              <li>
                After rotation, recent number of <i>backup_count</i> files will
                be kept and older ones are deleted. Defaults to 5.
              </li>
            </ul>
          </li>
          <li>
            <a name="condor_tarball" />
            <div class="xml">
              &lt;glidein&gt;&lt;condor_tarballs&gt;&lt;condor_tarball
              os=&quot;<i>os</i>&quot; arch=&quot;<i>arch</i>&quot;
              base_dir=&quot;<i>directory</i>&quot; version=&quot;<i
                >condor version</i
              >&quot;/&gt;
            </div>
            <p>
              <b>Required:</b> Where to find the HTCondor binaries. You can list
              as many as you need, but at least one is required. This lets you
              configure glideins for different sites to use different version of
              HTCondor binaries based on architecture, OS of the worker nodes
              that could be found on the site.<br />
              It is recommended to have one default entry with
              <b
                >os=&quot;default&quot; arch=&quot;default&quot;
                version=&quot;default&quot;</b
              >.<br />
              To configure multiple tarballs, OS, arch and version accept a
              comma separated list. See
              <a href="#tarballs">multiple tarballs</a> for more detailed
              instructions on supporting tarballs for multiple architectures.
            </p>
          </li>

          <li>
            <a name="submit" />
            <div class="xml">
              &lt;glidein&gt;&lt;submit base_dir=&quot;<i>directory</i>&quot;
              base_log_dir=&quot;<i>log directory</i>&quot;
              base_client_log_dir=&quot;<i>client log directory</i>&quot;
              base_client_proxies_dir=&quot;<i
                >directory where proxies will be stored</i
              >&quot; num_factories=&quot;<i>1</i>&quot;/&gt;
            </div>
            <p>
              <b>Recommended:</b> Where to create the glidein submit directory.
              The default is the user home directory. Log directories can be
              configured independent of the base directory using options
              mentioned above. <b>num_factories</b> is a scaling factor used to
              scale down <i>max_glideins, max_held</i>, and <i>max_idle</i> for
              the entries.
            </p>
          </li>

          <li>
            <a name="stage" />
            <div class="xml">
              &lt;glidein&gt;&lt;stage base_dir=&quot;<i>web dir</i>&quot;
              web_base_dir=&quot;<i>URL</i>&quot;/&gt;
            </div>
            <p>
              <b>Recommended:</b> These two define where the Web server
              directories are located. <br />The defaults are reasonable, but
              you may have different needs.
            </p>
          </li>

          <li>
            <a name="monitor" />
            <div class="xml">
              &lt;glidein&gt;&lt;monitor base_dir=&quot;<i>web dir</i>&quot;
              javascriptRRD_dir=&quot;<i>web dir</i>&quot; flot_dir=&quot;<i
                >web dir</i
              >&quot; jquery_dir=&quot;<i>web dir</i>>&quot; &gt;
            </div>
            <p>
              <b>Recommended:</b> The <strong>base_dir</strong> defines where
              the monitoring web are is.<br />The other entries point to where
              javascriptRRD, Flot and JQuery libraries are.
            </p>
          </li>

          <li>
            <a name="monitor_footer" />
            <div class="xml">
              &lt;glidein&gt;&lt;monitor_footer display_txt=&quot;<i
                >Legal Disclaimer</i
              >&quot; href_link=&quot;<i>/site/disclaimer.html</i>&quot; /&gt;
            </div>
            <p>
              OPTIONAL: If the display text and link are configured, the
              monitoring pages will display the text/link at the bottom of the
              page.
            </p>
          </li>

          <li>
            <a name="security" />
            <div class="xml">
              &lt;glidein&gt;&lt;security
              reuse_oldkey_onstartup_gracetime=&quot;<i>900</i>&quot;
              remove_old_cred_age=&quot;<i>30</i>&quot;
              remove_old_cred_freq=&quot;<i>24</i>&quot;
              pub_key=&quot;<i>RSA</i>&quot;/&gt;
            </div>
            <p>
              The Factory can remove old credential files saved on disk. You can
              set the min age (in days) the credential needs to be before it can
              be deleted and the frequency (in hours) to perform the removal. If
              you set the frequency to less than zero, the clean up
              functionality is disabled.
            </p>
          </li>
          <li>
            <a name="security_frontend" />
            <div class="xml">
              &lt;glidein&gt;&lt;security&gt;&lt;frontends&gt;&lt;frontend
              name=&quot;<i>FrontendName</i>&quot;
              identity=&quot;username_usedby_factory@factory_hostname&quot;
              /&gt;
            </div>

            <p>
              <b>Recommended:</b>
              This configures the Frontend.
              <b
                >Frontend on the Frontend hosting machine should have the same
                name as mentioned in the 'name'. </b
              >Identity tells the Factory the username under which the Factory
              should map the given Frontend to.
              <b
                >If this does not match the Frontend configuration, the Factory
                will drop all requested glideins.</b
              >
            </p>
          </li>

          <li>
            <a name="security_class" />
            <div class="xml">
              &lt;glidein&gt;&lt;security&gt;&lt;frontends&gt;&lt;frontend&gt;&lt;security_classes&gt;&lt;security_class
              name=&quot;<i>frontend</i>&quot;
              username=&quot;<i>>username_usedby_factory</i>&quot;/&gt;
            </div>

            <p>
              <b>Required:</b> Tells the class and user name the Factory uses
              for this Frontend.<br />
            </p>
            <ul>
              <div class="xml">
                -
                <b
                  >&lt;security_class name=&quot;frontend&quot;
                  username=&quot;<i>username_usedby_factory</i>&quot;/&gt;</b
                >
              </div>
            </ul>
          </li>
          <li>
            <a name="attrs" />
            <div class="xml">
              &lt;glidein&gt;&lt;attrs&gt;&lt;attr name=&quot;<i>attr name</i
              >&quot; value=&quot;<i>value</i>&quot; const=&quot;True&quot;
              parameter=&quot;True&quot; publish=&quot;True&quot;
              glidein_publish=&quot;True&quot;
              comment=&quot;<i>comment</i>&quot; /&gt;
            </div>

            <p>
              Attributes you want to publish that effect all the Factory entries
            </p>
            <p>
              To set specific attributes to an entry point, set them in
              /glidein/entries/entry/attrs section.
            </p>
            <p>Table below describes the &lt;attrs ... &gt; tag.</p>
            <table class="requirements">
              <tr class="head">
                <td>
                  <p><b>Attribute Name</b></p>
                </td>

                <td>
                  <p><b>Attribute Description</b></p>
                </td>
              </tr>
              <tr>
                <td>
                  <p><b>name</b></p>
                </td>
                <td>
                  <p>Name of the attribute</p>
                </td>
              </tr>
              <tr>
                <td>
                  <p><b>value</b></p>
                </td>
                <td><p>Value of the attribute</p></td>
              </tr>

              <tr>
                <td>
                  <p><b>const</b></p>
                </td>
                <td>
                  <p>
                    Set to True if the attribute is a constant. If so, Glidein
                    Frontend can not change it. If set to const, the attribute
                    will be available in the constants file created in the
                    staging area.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p><b>parameter</b></p>
                </td>
                <td>
                  <p>
                    Set True if the attribute should be passed as a parameter.
                    Always set this to True unless you know what you are doing.
                    <b
                      >NOTE As of 3.4.6 in the Factory, publish has to be set to
                      True and const to False, otherwise the attribute will not
                      published in the parameter list.</b
                    >
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p><b>publish</b></p>
                </td>

                <td>
                  <p>
                    If set to True, the attribute will be published in Factory's
                    ClassAd
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p><b>glidein_publish</b></p>
                </td>
                <td>
                  <p>
                    If set to True, the attribute will be available in the
                    condor_startd's ClassAd (and the glidein condor
                    configuration). Used only if parameter is True.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p><b>job_publish</b></p>
                </td>
                <td>
                  <p>
                    If set to True, the attribute will be available in the user
                    job's environment. Used only if parameter is True.
                  </p>
                </td>
              </tr>
              <tr>
                <td>
                  <p><b>comment</b></p>
                </td>
                <td>
                  <p>You can specify description of the attribute here.</p>
                </td>
              </tr>
              <tr>
                <td>
                  <p><b>type</b></p>
                </td>
                <td>
                  <p>
                    Type of the attribute. Supported types are 'int', 'string'
                    and 'expr'. Typeexpr is equivalent to condor
                    constant/expression in condor_vars.lst
                  </p>
                </td>
              </tr>
            </table>
            <p>
              <br />These are used by the
              <a href="../frontend/index.html#match_expr"
                >VO Frontend matchmaking</a
              >
              and job matchmaking.<br /><br />Example attributes are:
            </p>
            <pre>
&lt;attrs&gt;
 &lt;attr name=&quot;VOpilot&quot; value=&quot;CMS&quot;
    publish=&quot;True&quot; parameter=&quot;True&quot; const=&quot;True&quot; glidein_publish=&quot;True&quot; comment=&ldquo;A test attribute&rdquo;/&gt;

 &lt;attr name=&quot;CondorVersion&quot; value=&quot;v6.9.1&quot;
    publish=&quot;True&quot; parameter=&quot;True&quot; const=&quot;True&quot; glidein_publish=&quot;True&quot;/&gt;

&lt;/attrs&gt;</pre
            >
            <p>
              A list of all the attributes can be found on the
              <a href="custom_vars.html">
                dedicated configuration variables page</a
              >.
            </p>
          </li>
          <li>
            <a name="custom_code_summary" />
            <div class="xml">
              &lt;glidein&gt;&lt;files&gt;&lt;file absfname=&quot;<i
                >script name</i
              >&quot; executable=&quot;<i>True</i>&quot; period=&quot;period in
              seconds&quot; prefix=&quot;cron prefix&quot;
              after_entry=&quot;True&quot; type="file type"
              comment=&quot;<i>comment</i>&quot; /&gt;
            </div>

            <p>
              Custom files configuration is discussed in the
              <a href="#custom_code"
                >Adding custom files/scripts to the glideins</a
              >
              paragraph in the advanced section below.
            </p>
            <p>
              Custom files (how to write and use them), are discussed in the
              <a href="custom_scripts.html">custom scripts page</a>.
            </p>
          </li>
          <li>
            <a name="cvmfsexec_distro" />
            <div class="xml">
              &lt;glidein&gt;&lt;cvmfsexec_distro
              sources=&quot;<i>sources_list</i>&quot;
              platforms=&quot;<i>platforms_list</i>&quot; /&gt;
            </div>

            <p>
              This knob provides control over the building and/or rebuilding of
              cvmfsexec distributions when CVMFS is to be provisioned on demand.
              Distributions (in .tar.gz format) built via this knob will be
              located in factory work directory location (by default, for an
              RPM-based install of GlideinWMS, this would typically be
              <i>/var/lib/gwms-factory/work-dir/cvmfsexec/tarballs</i>). Two
              attributes are available to control the behavior of this knob and
              are described below. If both the attributes are empty, then
              (re)building of cvmfsexec distributions will be disabled (the
              default behavior).
            </p>
            <p>
              The <b><i>sources</i></b> attribute specifies the source(s) to
              download the latest cvmfs configuration and repositories from.
              Must be at least one value or a comma-separated list of values
              from the options { <i>osg</i> | <i>egi</i> | <i>default</i> }.
            </p>
            <p>
              The <b><i>platforms</i></b> attribute indicates machine types
              (platform- and architecture-based) for which distributions is to
              be built. Can be empty, a single value or a comma-separated list
              of values from the options { <i>rhel7-x86_64</i> |
              <i>rhel8-x86_64</i> | <i>suse15-x86_64</i> }.
            </p>
            <p>
              Note that, <b><i>sources</i></b> is a <b>required</b> attribute
              and <b><i>platforms</i></b> is an <b>optional</b> attribute.
            </p>
            <ul>
              <li>
                if <b><i>platforms</i></b> is empty and <b><i>sources</i></b> is
                non-empty, the distribution will be built for all available
                platforms (<i>rhel7-x86_64,rhel8-x86_64,suse15-x86_64</i>).
              </li>
              <li>
                if <b><i>sources</i></b> is empty and <b><i>platforms</i></b> is
                non-empty, an error will be thrown during factory
                reconfiguration and/or upgrade, since <b><i>sources</i></b> is a
                required attribute.
              </li>
            </ul>
          </li>
        </ul>
        <p>
          <br />The other arguments are for advanced admins only, and are
          explained in a <a href="#advanced">dedicated section</a>.
        </p>
      </div>

      <div class="section" id="args_entry">
        <h3 class="western">Entry point arguments</h3>
        <p>
          The following are arguments that are specific to each entry point.
          They override the global arguments if present.
        </p>
        <ul>
          <li>
            <a name="entry" />
            <div class="xml">
              &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                >entry name</i
              >&quot;&gt;
            </div>
            <p>
              <b>Required:</b> Each entry point will have its own root tag with
              parameters:
            </p>
            <ul>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot;&gt;
                </div>
                <b>Required:</b> Specify an easy name to remember, that will
                identify this entry for display purposes and for specifying
                using command line tools.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot; auth_method=&quot;<i>grid_proxy</i>&quot;&gt;
                </div>
                <b>Required:</b> The authentication method this entry supports.
                It is advertised to the Frontends to show which credentials are
                required for submission. Valid values: grid_proxy, voms_proxy,
                key_pair, cert_pair, username_password, vm_type, vm_id,
                project_id, scitoken.<br />
                See
                <a href="custom_vars.html#CONTINUE_IF_NO_PROXY"
                  >CONTINUE_IF_NO_PROXY</a
                >
                to find out how the authentication method matching is altered to
                ease the transition from grid_proxy to scitoken.<br />
                Multiple authentication methods may be needed and there may be
                reqirements on the authentication method depending on the type
                of entry. E.g. ec2 requires a credential pair (key_pair,
                cert_pair, username_password) and the VM id and type. BOSCO
                requires a key_pair and a grid_proxy. The authentication method
                then must be &lt;entry auth_method="grid_proxy+project_id" &gt;.
                <br />
                When multiple methods are needed these can be additional entry
                values: &lt;entry vm_type="vmtype" or vm_id="vmid" &gt; <br />
                OR <br />
                can be added to the authentication method so the Frontend is
                required to pass them: &lt;entry
                auth_method="key_pair+vm_id+vm_type" &gt; <br />
              </li>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot; trust_domain=&quot;<i>OSG</i>&quot;&gt;
                </div>
                <b>Required:</b> The trust domain for the entry. This is not
                interpreted by the Factory code, only used to show what
                credentials are valid. For example, there may be two ec2-type
                entries for two different clouds with the authentication method
                of "key-pair". This shows allows the Frontend to map a key pair
                to a particular cloud. Or in BOSCO you can use it to select the
                key to use with a specific cluster.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot; gatekeeper=&quot;<i>gatekeeper</i>&quot;&gt;
                </div>
                <b>Required:</b> The identifier of your Grid/BOSCO resource
                (like
                <tt>&quot;cmsitbsrv01.fnal.gov/jobmanager-condor&quot;</tt>).
                BOSCO resources are USER@FQDN, e.g.
                <tt>cmsuser@cmscluster.fnal.gov</tt>.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot; rsl=&quot;<i>rsl</i>&quot;&gt;
                </div>
                Please check the Grid site documentation and/or ask the Grid
                site administrator for the proper rsl and queue name for the
                site.<br />
                (example: '<tt
                  >(condorsubmit=(universe vanilla)(requirements
                  \&quot;(ISMINOSAFS=?=True)\&quot;))</tt
                >'). <br />
                NOTE: If the auth_method contains "+project_id" for a TeraGrid
                entry, the string "(project=TG_PROJECT_ID)" will be added by the
                Factory and populated with the project id passed in the request.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot; gridtype=&quot;<i>grid type [default: condor]</i
                  >&quot;&gt;
                </div>
                <b>Optional:</b> The default condor is for HTCondor-CE
                Gatekeepers. Other values are ec2 or one of the batch types
                supported by HTCondor: batch pbs (for PBS and SLURM), batch lsf,
                batch sge, batch condor. This tag can specify additional
                HTCondor Grid types.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot; work_dir=&quot;<i>WN dir</i>&quot;&gt;
                </div>
                <b>Recommended:</b> This argument defines where the glidein
                should run once on the worker node. <br />
                Options are: ".", Condor (CONDOR), OSG, TMPDIR, AUTO <br />
                <ul>
                  <li>".": run in pwd <br /></li>
                  <li>
                    Condor (CONDOR): will run in $_CONDOR_SCRATCH_DIR <br />
                  </li>
                  <li>OSG: will run in $OSG_WN_TMP <br /></li>
                  <li>TMPDIR: will run in $TMPDIR <br /></li>
                  <li>
                    AUTO: will try to determine which direcotry has enogh space
                    (at least 1 GB of free space). Directory checked are
                    $_CONDOR_SCRATCH_DIR, $OSG_WN_TMP $TG_NODE_SCRATCH,
                    $TG_CLUSTER_SCRATCH, $SCRATCH $TMPDIR, $TMP, $PWD (in this
                    order) <br />
                  </li>
                </ul>
                <i
                  >Note: Most OSG sites are known to crash if you use your
                  starting directory to run.
                </i>
                For those sites, it is good practice to specify
                <tt>&quot;Condor&quot;</tt> if they are running HTCondor as the
                underlying batch system, and
                <tt>&quot;OSG&quot;</tt>
                else. On EGI sites, &quot;.&quot; is usually fine.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot; bosco_dir=&quot;<i>BOSCO dir [default: bosco]</i
                  >&quot;&gt;
                </div>
                <b>Optional:</b> This argument defines the directory where BOSCO
                (some HTCondor executables and Glite BLAHP) are installed on the
                BOSCO resource submit host. This is the node specified in the
                gatekeeper attribute when using "batch ..." grid type. This is
                ignored for other grid types. The path specified is relative to
                $HOME.
                <i
                  >Note: This must be the same directory used for the BOSCO
                  installation on the remote resource (bosco_cluster_add).
                </i>
                A different directory is useful only to avoid interferences if
                the same home directory is shared and mounted by multiple
                resources.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot; proxy_url=&quot;<i>Proxy URL</i>&quot;&gt;
                </div>
                <b>Recommended:</b> If you have a Web cache you can use, you set
                it here (like
                <tt>&quot;cmsitbsquid002.fnal.gov:3128&quot;</tt>). On OSG
                resources, you can set it to <tt>&quot;OSG&quot;</tt>, and the
                default OSG squid will be used. If you cannot use any Web cache
                server, you can skip this argument (the default is not to use
                caching). If defined, the user jobs will be able to use it as
                <tt>&quot;GLIDEIN_Proxy_URL&quot;</tt> environment variable.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot; schedd_name=&quot;<i>schedd name</i>&quot;&gt;
                </div>
                <b>Optional:</b> If you have an entry that needs a dedicated
                schedd, you can set it here (to something like
                <tt>&quot;myveryspecialschedd@mymachine.mydomain&quot;)</tt>
              </li>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot; enabled=&quot;<i>True/False</i>&quot;&gt;
                </div>
                <b>Optional:</b> You can define an entry point even if you do
                not plan to use it right away. The entry point directory will be
                created independently of the <tt><b>enabled</b></tt> flag, but
                will only be used by the glidein Factory if it is set to
                <tt><b>True</b></tt
                >. (Defaults to <tt><b>True</b></tt
                >).
              </li>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot; verbosity=&quot;<i>std/fast/nodebug</i>&quot;&gt;
                </div>
                <b>Optional:</b> Specify the verbosity level and termination
                time in case of validation errors:
                <ul>
                  <li>
                    <b>std (default)</b> &ndash; reasonable verbosity (including
                    the condor log files) and 20min sleep in case of error (to
                    reduce the damage resulting from broken nodes)
                  </li>
                  <li>
                    <b>fast</b> &ndash; same verbosity as std, but will only
                    wait 2 mins before terminating in case of error (good for
                    debugging)
                  </li>
                  <li>
                    <b>nodebug</b> &ndash; very low verbosity, if you want to
                    save on disk space
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            <a name="config" />
            <div class="xml">
              &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                >entry name</i
              >&quot;&gt;<br />
              &lt;config&gt;<br />
              &lt;max_jobs num_factories="3"&gt;<br />
              &nbsp;&nbsp;&lt;per_entry held="1000" idle="2000"
              glideins="10000"/&gt;<br />
              &nbsp;&nbsp;&lt;default_per_frontend held="50" idle="100"
              glideins="5000"/&gt;<br />
              &nbsp;&nbsp;&lt;per_frontends&gt;<br />
              &nbsp;&nbsp;&nbsp;&nbsp;&lt;per_frontend
              name="FRONTEND:SECURITY_CLASS" held="50" idle="100"
              glideins="5000"/&gt;<br />
              &nbsp;&nbsp;&lt;/per_frontends&gt;<br />
              &lt;max_jobs/&gt;<br />
              &lt;release max_per_cycle="20" sleep="0.2"/&gt;<br />
              &lt;remove max_per_cycle="5" sleep="0.2"/&gt;<br />
              &lt;submit cluster_size="10" max_per_cycle="100" sleep="0.2"
              slots_layout="partitionable"&gt;<br />
              &nbsp;&nbsp;&lt;submit_attrs&gt;<br />
              &nbsp;&nbsp;&nbsp;&nbsp;&lt;submit_attr name="RequestMemory"
              value="2000"/&gt;<br />
              &nbsp;&nbsp;&nbsp;&nbsp;&lt;submit_attr
              name="+GlideinSkipIdleRemoval" value="True"
              all_grid_types="True"/&gt;<br />
              &nbsp;&nbsp;&lt;/submit_attrs&gt;<br />
              &lt;/submit&gt;<br />
              &lt;/config&gt;
            </div>
            <p>
              The config section controls the glidein policies for the entry.
              <br />
            </p>

            <ul>
              <li>
                The max_jobs section limits the number of glidins held, idle,
                and total (including running).
                <ul>
                  <li>
                    &lt;per_entry ... &gt; specifies the limits per entry.
                  </li>
                  <li>
                    &lt;default_per_frontend ... &gt; specifies default limits
                    for each frontend-security class (for this entry).
                  </li>
                  <li>
                    &lt;per_frontend ... &gt; overrides the limits for a
                    specific frontend-security class.
                  </li>
                </ul>
                All these limits are scaled down by the num_factories attributes
                (it can be specified here, at the entry level or in the global
                submit section)
              </li>
              <li>
                Release regulates how many glideins are released per cycle.
              </li>
              <li>Remove regulates how many glideins are removed per cycle.</li>
              <li>
                Submit limits how fast the glideins are submitted and controls
                the glideins type. Each main loop (cycle) the glideins are
                submitted using multiple condor_submit commands
                <ul>
                  <!-- Attributes in the code
cluster_size, self.jobDescript.data['SubmitCluster'], self.gflFactoryConfig.max_cluster_size;
max_per_cycle, jobDescript.data['MaxSubmitRate'], self.gflFactoryConfig.max_submits;
sleep, self.jobDescript.data['SubmitSleep'], self.gflFactoryConfig.submit_sleep ->
-->
                  <li>
                    cluster_size limits how many glideins are submitted with one
                    condor_submit command (if more glideins need to be
                    submitted, multiple condor_submit invocations are used).
                  </li>
                  <li>
                    sleep is the minimum wait between two condor_submit commands
                    (actual time is longer).
                  </li>
                  <li>
                    max_per_cycle limits how many glideins to submit every cycle
                  </li>
                  <li>
                    slots_layout tells what kind of glideins the entry supports:
                    "fixed" number of slots; or "partitionable" slots, which
                    enables HTCondor's partionable/dynamic slots. The number of
                    cores claimed by the glidein can be controlled by the
                    GLIDEIN_CPUS variable. GLIDEIN_ESTIMATED_CPUS can provide an
                    estimate used for matching when the number of cores is
                    discovered automatically.
                  </li>
                  <li>
                    &lt;submit_attr ... &gt; specifies additional HTCondor
                    attributes to add to the HTCondor submit file that the
                    Factory uses to submit pilots to a site. These attributes
                    are only added when the
                    <a name="entry">gridtype</a> is "batch SOMETHING" (<a
                      href="../recipes/batch.html"
                      >using BOSCO</a
                    >) or "condor" or "ec2" or "gce". The attributes are ignored
                    for all other grid types unless the attribute
                    'all_grid_types' is set to true.
                  </li>
                  <li>
                    The following submit attribute can be added to disable the
                    temporary removal of idle glideins:
                    <br />
                    <div class="xml">
                      &lt;submit_attr name="+GlideinSkipIdleRemoval"
                      value="True" all_grid_types="True"/&gt;
                    </div>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            <a name="entry_attrs" />
            <div class="xml">
              &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                >entry name</i
              >&quot;&gt;&lt;attrs&gt;&lt;attr name=&quot;<i>attr name</i>&quot;
              value=&quot;<i>value</i>&quot; const=&quot;True&quot;
              parameter=&quot;True&quot; publish=&quot;True&quot;
              glidein_publish=&quot;True&quot;
              comment=&quot;<i>comment</i>&quot;/&gt;
            </div>
            <p>
              Attributes you want to publish into the HTCondor ClassAd. These
              are used by the
              <a href="../frontend/index.html#match_expr"
                >VO Frontend matchmaking</a
              >
              and job matchmaking.
            </p>
            <p>Example attributes are:</p>
            <pre>
 &lt;attr name=&quot;HasMySoftware&quot; value=&quot;True&quot; publish=&quot;True&quot; parameter=&quot;
True&quot; const=&quot;True&quot; glidein_publish=&quot;True&quot; comment=&ldquo;My users cannot live without&rdquo;
/&gt;

 &lt;attr name=&quot;OS&quot; value=&quot;Linux&quot; publish=&quot;True&quot; parameter=&quot;True&quot;
 const=&quot;True&quot; glidein_publish=&quot;True&quot;/&gt;
 </pre
            >
            Other pre-defined attributes are listed below:
            <ul>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot;&gt;&lt;attrs&gt;&lt;attr name=&quot;GLIDEIN_Site&quot;
                  value=&quot;<i>value</i>&quot; const=&quot;True&quot;
                  parameter=&quot;True&quot; publish=&quot;True&quot;/&gt;
                </div>
                <b>Recommended:</b> This defines the glidein attribute
                <tt>GLIDEIN_Site</tt>, both for use of the Frontend and for the
                use of the job negotiation. Logically defining a site is useful,
                so that you can change entry points but the user jobs do still
                known where they are running. If not specified, it defaults to
                the entry point name in the startd ClassAd.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=<i>entry name</i
                  >&quot;&gt;&lt;attrs&gt;<br />
                  &nbsp;&nbsp;&lt;attr name=&quot;CONDOR_VERSION&quot;
                  value=&quot;<i>os</i>&quot; type=&quot;string&quot;
                  const=&quot;True&quot; parameter=&quot;True&quot;
                  publish=&quot;False&quot; /&gt;<br />

                  &nbsp;&nbsp;&lt;attr name=&quot;CONDOR_ARCH&quot;
                  value=&quot;<i>arch</i>&quot; type=&quot;string&quot;
                  const=&quot;True&quot; parameter=&quot;True&quot;
                  publish=&quot;False&quot;/&gt;<br />
                  &nbsp;&nbsp;&lt;attr name=&quot;CONDOR_OS&quot;
                  value=&quot;<i>version</i>&quot; type=&quot;string&quot;
                  const=&quot;True&quot; parameter=&quot;True&quot;
                  publish=&quot;False&quot;/&gt;
                </div>
                <b>Recommended:</b> Select a non-default HTCondor binary.<br />

                The entry will default to
                <tt
                  ><b
                    >CONDOR_OS=&quot;default&quot;
                    CONDOR_ARCH=&quot;default&quot;
                    CONDOR_VERSION=&quot;default&quot;</b
                  ></tt
                >, if not otherwise defined.
              </li>

              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot;&gt;&lt;attrs&gt;&lt;attr
                  name=&quot;X509_CERT_DIR&quot; value=&quot;<i>value</i>&quot;
                  const=&quot;True&quot; parameter=&quot;True&quot;
                  glidein_publish=&quot;False&quot; job_publish=&quot;True&quot;
                  publish=&quot;True&quot;/&gt;
                </div>
                <b>Recommended for BOSCO resources:</b> BOSCO resources normally
                have no OSG software installed, so it is safer to publish the
                location of the CA certificates because the job may not be able
                to find them otherwise.
              </li>
              <li>
                <div class="xml">
                  &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                    >entry name</i
                  >&quot;&gt;&lt;attrs&gt;&lt;attr name=&quot;GLIDEIN_CPUS&quot;
                  value=&quot;<i>value</i>&quot; const=&quot;True&quot;
                  parameter=&quot;True&quot; publish=&quot;True&quot;/&gt;
                </div>
                <b>Recommended:</b> Specifies how many CPUs (cores) to claim on
                the compute node<br />
                Valid values are 1..N and "auto", "slot" or "node"
                (corresponding to 0, 0, -1) which means to use all cores on the
                slot or on the node (see it on the
                <a href="custom_vars.html">configuration variables page</a> for
                more). The entry will default to 1 if not otherwise defined.
              </li>
            </ul>
          </li>

          <li>
            <a name="allow_frontend" />
            <div class="xml">
              &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                >entry name</i
              >&quot;&gt; &lt;allow_frontends&gt; &lt;allow_frontend
              name="vofrontend_name" security_class="security_class_name"/&gt;
            </div>
            <p>
              This argument allows you to create a whitelist of VO Frontends
              that can access this entry point. If this tag is blank or missing,
              it is assumed that all VO Frontends can submit glideins to this
              entry point. However, if any allow_frontend tags exist, the entry
              point will <b>only</b> allow those Frontends to submit glideins.
              The name of the Frontend must match the name given in the security
              class above in the configuration.
            </p>
            <p>
              For each Frontend, you must tell it which security classes (e.g.
              proxies) can use the Frontend. The Factory will only submit
              glideins on behalf of these security classes. If you want all
              security classes to be allowed, you can put "All" in this field.
              Otherwise, it must match the security class configuration higher
              up in the xml.
            </p>
          </li>
          <li>
            <a name="infosys" />
            <div class="xml">
              &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<i
                >entry name</i
              >&quot;&gt; &lt;infosys_refs&gt;&lt;infosys_ref
              ref="<i>filename</i>" server="<i>SERVER</i>"
              type="<i>RESS/BDII</i>"/&gt;
            </div>
            <p>
              This argument is placed here by the installers based on
              information from BDII/RESS. This gives you information on where
              the server's information was retrieved from. It can also be used
              to retrieve downtime information from RESS/BDII.
            </p>
          </li>
        </ul>
      </div>

      <div class="section" id="attr_substitution">
        <h2>Attribute substitution</h2>

        <p>
          Attribute substitution can be used to parametrize the Factory
          configuration.
        </p>
        <p>
          Anytime one of the following two bits are found inside the
          configuration file
        </p>
        <ul>
          <li><b>$$(<i>attr_name</i>)</b></li>
          <li><b>$(<i>attr_name</i>)</b></li>
        </ul>

        <p>
          the value of the <i>named attribute</i> is inserted in that place.
        </p>
        <p>
          The <b>$$</b> variant will interpret the type of the attribute,
          quoting its value as appopriate, while the <b>$</b> requires a
          <i>string</i> type and will use it as-is.<br />
          They can appear in any string of the configuration file.
        </p>
        <p>
          If an attribute is defined both in the main and the entry section, the
          section one will prevail.<br />
          This can be used to e.g. define a generic expression in the global
          section, and customize it on a entry by entry basis by only
          re-defining the relevant bits.
        </p>
        <p>
          The attribute expansion also works recursively, as long as there are
          no loops.<br />
          <b>$(DOLLAR)</b> can be used to represent the <b>$</b> sign.
        </p>
        <p>For example, with</p>
        <div class="xml">
          <blockquote>
            &lt;attr name="GLIDEIN_MaxMemMBs" const="True"
            glidein_publish="True" job_publish="False" parameter="True"
            publish="True" type="int" value="2500" /&gt;<br />
            &lt;attr name="GLIDEIN_Max_Walltime" const="True"
            glidein_publish="False" job_publish="False" parameter="True"
            publish="True" type="int" value="171000"/&gt;<br />
            &lt;attr name="PBS_RSL" const="True" glidein_publish="False"
            job_publish="False" parameter="False" publish="False" type="string"
            value="(jobtype=single)(maxWalltime=$$(GLIDEIN_Max_Walltime))(memory=$$(GLIDEIN_MaxMemMBs))"
            /&gt;<br />
            ... rsl="(queue=default)$(PBS_RSL)" ...<br />
          </blockquote>
        </div>
        <p>will be expanded into</p>
        <div class="xml">
          <blockquote>
            ...
            rsl="(queue=default)(jobtype=single)(maxWalltime=171000)(memory=2500)"
            ...<br />
          </blockquote>
        </div>
        <p>
          Please notice that the Factory will throw an error on reconfig if a
          referenced attribute is not defined.
        </p>
      </div>

      <div class="section" id="metasites">
        <h2>Grouping entries into metasites</h2>
        <p>
          Starting in v3.2.20, entries with similar configuration can be grouped
          in &lt;entry_sets&gt; to form what we call a metasite.
          &lt;entry_sets&gt; starts right after the &lt;entries&gt; tag is
          closed. A metasite is defined by starting an &lt;entry_set&gt;, which
          then contains the common configuration for the different entries, and
          then an &lt;entries&gt; tag containing the different entries for the
          metasite.
        </p>
        <p>
          The following is an example of two different entry set containing two
          separate entries.
        </p>
        <p>
          The attributes auth_method, gridtype, and trust_domain must be the
          same in all entry elements (they are used for credential generation in
          the Frontend).
        </p>
        <p>
          Only the metasite will be advertized as a glideresource ClassAd, so
          the Frontend will only see one element (entry). The Frontend will
          apply limits transparently as before, and the Factory as well. Right
          before glidein submission, the Factory will detect there are multiple
          CE where the work can be send (multiple submission files) and it will
          count the running+idle glideins for each CE and send jobs to the one
          with less. The submission file is added to the job condor submit file
          for accounting purposes (GlideinEntrySubmitFile ClassAd).
        </p>

        <p>
          The &lt;entry_selection&gt; parameter determines how the factory
          decides between the subentries of the metasite. By default the
          frontend requests are equally split among subentries until they are
          filled. Limits for the subentries correspond to the limits for the
          metasites divided by the number of subentries. More algorithms may be
          implemented in the future.
        </p>

        <p></p>

        <div class="config">
          <a>
            ...<br />
            &lt;/entries&gt;<br />
            &lt;entry_sets&gt;<br />
            <blockquote>
              &lt;entry_set alias="T2_US_UCSD" enabled="True"&gt;<br />
              <blockquote>
                &lt;config&gt;<br />
                <blockquote>
                  &lt;max_jobs&gt;<br />
                  <blockquote>
                    &lt;default_per_frontend glideins="5000" held="50"
                    idle="100"/&gt;<br />
                    &lt;per_entry glideins="10000" held="1000"
                    idle="4000"/&gt;<br />
                    &lt;per_frontends&gt;<br />
                    &lt;/per_frontends&gt;<br />
                  </blockquote>
                  &lt;/max_jobs&gt;<br />
                  &lt;release max_per_cycle="20" sleep="0.2"/&gt;<br />
                  &lt;remove max_per_cycle="5" sleep="0.2"/&gt;<br />
                  &lt;restrictions require_voms_proxy="False"/&gt;<br />
                  &lt;entry_selection algorithm_name="Default" &gt;<br />
                  &lt;submit cluster_size="10" max_per_cycle="25" sleep="2"
                  slots_layout="partitionable"&gt;<br />
                  <blockquote>
                    &lt;submit_attrs&gt;<br />
                    &lt;/submit_attrs&gt;<br />
                  </blockquote>
                  &lt;/submit&gt;<br />
                </blockquote>
                &lt;/config&gt;<br />
                &lt;allow_frontends&gt;<br />
                &lt;/allow_frontends&gt;<br />
                &lt;attrs&gt;<br />
                <blockquote>
                  &lt;attr name="CONDOR_ARCH" const="False"
                  glidein_publish="False" job_publish="False"
                  parameter="True"<br />
                  publish="True" type="string" value="default"/&gt;<br />
                  &lt;attr name="CONDOR_OS" const="False"
                  glidein_publish="False" job_publish="False"
                  parameter="True"<br />
                  publish="True" type="string" value="default"/&gt;<br />
                  &lt;attr name="GLIDEIN_Site" const="True"
                  glidein_publish="True" job_publish="True" parameter="True"
                  publish="True" type="string" value="UCSD"/&gt;<br />
                  &lt;attr name="GLIDEIN_Supported_VOs" const="True"
                  glidein_publish="True" job_publish="True" parameter="True"
                  publish="True" type="string"
                  value="CMS,ATLAS,Fermilab,LIGO,NWICG,HCCLONG"/&gt;<br />
                  &lt;attr name="GLIDEIN_CPUS" const="True"
                  glidein_publish="False" job_publish="True" parameter="True"
                  publish="True" type="string" value="8"/&gt;<br />
                </blockquote>
                &lt;/attrs&gt;<br />
                &lt;files&gt;<br />
                &lt;/files&gt;<br />
                &lt;infosys_refs&gt;<br />
                &lt;/infosys_refs&gt;<br />
                &lt;monitorgroups&gt;<br />
                &lt;/monitorgroups&gt;<br />
                &lt;entries&gt;<br />
                <blockquote>
                  &lt;entry name="CMSHTPC_T2_US_UCSD_gw2"
                  auth_method="grid_proxy" comment="Created new multicore entry
                  on 2016/03/29 -- Marty" enabled="True"
                  gatekeeper="osg-gw-2.t2.ucsd.edu osg-gw-2.t2.ucsd.edu:9619"
                  gridtype="condor" proxy_url="OSG" trust_domain="grid"
                  verbosity="std" work_dir="Condor"&gt;<br />
                  &lt;/entry&gt;<br />
                  &lt;entry name="CMSHTPC_T2_US_UCSD_gw4"
                  auth_method="grid_proxy" comment="Created new multicore entry
                  on 2016/03/29 -- Marty" enabled="True"
                  gatekeeper="osg-gw-4.t2.ucsd.edu osg-gw-4.t2.ucsd.edu:9619"
                  gridtype="condor" proxy_url="OSG" trust_domain="grid"
                  verbosity="std" work_dir="Condor"&gt;<br />
                  &lt;/entry&gt;<br />
                </blockquote>
                &lt;/entries&gt;<br />
              </blockquote>
              &lt;/entry_set&gt;<br />
            </blockquote>
            <blockquote>
              &lt;entry_set alias="T2_CH_CERN" enabled="True"&gt;<br />
              <blockquote>
                &lt;config&gt;<br />
                <blockquote>
                  &lt;max_jobs&gt;<br />
                  <blockquote>
                    &lt;default_per_frontend glideins="5000" held="50"
                    idle="100"/&gt;<br />
                    &lt;per_entry glideins="10000" held="1000"
                    idle="4000"/&gt;<br />
                    &lt;per_frontends&gt;<br />
                    &lt;/per_frontends&gt;<br />
                  </blockquote>
                  &lt;/max_jobs&gt;<br />
                  &lt;release max_per_cycle="20" sleep="0.2"/&gt;<br />
                  &lt;remove max_per_cycle="5" sleep="0.2"/&gt;<br />
                  &lt;restrictions require_voms_proxy="False"/&gt;<br />
                  &lt;entry_selection algorithm_name="Default" &gt;<br />
                  &lt;submit cluster_size="10" max_per_cycle="10" sleep="2"<br />
                  slots_layout="fixed"&gt;<br />
                  <blockquote>
                    &lt;submit_attrs&gt;<br />
                    &lt;/submit_attrs&gt;<br />
                  </blockquote>
                  &lt;/submit&gt;<br />
                </blockquote>
                &lt;/config&gt;<br />
                &lt;allow_frontends&gt;<br />
                &lt;/allow_frontends&gt;<br />
                &lt;attrs&gt;<br />
                <blockquote>
                  &lt;attr name="GLIDEIN_CMSSite" const="True"
                  glidein_publish="True" job_publish="True" parameter="True"
                  publish="True" type="string" value="T2_CH_CERN"/&gt;<br />
                  &lt;attr name="GLIDEIN_CPUS" const="True"
                  glidein_publish="False" job_publish="True" parameter="True"
                  publish="True" type="string" value="8"/&gt;<br />
                  &lt;attr name="GLIDEIN_Country" const="True"
                  glidein_publish="True" job_publish="True" parameter="True"
                  publish="True" type="string" value="CH"/&gt;<br />
                  &lt;attr name="GLIDEIN_MaxMemMBs" const="True"
                  glidein_publish="False" job_publish="True" parameter="True"
                  publish="True" type="int" value="22000"/&gt;<br />
                  &lt;attr name="GLIDEIN_Max_Walltime" const="True"
                  iglidein_publish="False" job_publish="False" parameter="True"
                  publish="True" type="int" value="257400"/&gt;<br />
                  &lt;attr name="GLIDEIN_ResourceName" const="True"
                  glidein_publish="True" job_publish="True" parameter="True"
                  publish="True" type="string" value="CERN-PROD"/&gt;<br />
                  &lt;attr name="GLIDEIN_Retire_Time" const="True"
                  glidein_publish="False" job_publish="False" parameter="True"
                  publish="True" type="int" value="108000"/&gt;<br />
                  &lt;attr name="GLIDEIN_Site" const="True"
                  glidein_publish="True" job_publish="True" parameter="True"
                  publish="True" type="string" value="CERN"/&gt;<br />
                  &lt;attr name="GLIDEIN_Supported_VOs" const="True"
                  glidein_publish="False" job_publish="False" parameter="True"
                  publish="True" type="string" value="CMS"/&gt;<br />
                </blockquote>
                &lt;/attrs&gt;<br />
                &lt;files&gt;<br />
                &lt;/files&gt;<br />
                &lt;infosys_refs&gt;<br />
                &lt;/infosys_refs&gt;<br />
                &lt;monitorgroups&gt;<br />
                &lt;/monitorgroups&gt;<br />
                &lt;entries&gt;<br />
                <blockquote>
                  &lt;entry name="CMSHTPC_T2_CH_CERN_ce301"
                  auth_method="grid_proxy" comment="Converted to multicore
                  2016-03-29-Vassil" enabled="True"
                  gatekeeper="ce301.cern.ch:8443/cream-lsf-grid_cms"
                  gridtype="cream" rsl="WholeNodes = False; HostNumber = 1;
                  CPUNumber = 8" trust_domain="grid" verbosity="std"
                  work_dir="."&gt;<br />
                  &lt;/entry&gt;<br />
                  &lt;entry name="CMSHTPC_T2_CH_CERN_ce302"
                  auth_method="grid_proxy" comment="Converted to multicore
                  2016-03-31-Vassil" enabled="True"
                  gatekeeper="ce302.cern.ch:8443/cream-lsf-grid_cms"
                  gridtype="cream" rsl="WholeNodes = False; HostNumber = 1;
                  CPUNumber = 8" trust_domain="grid" verbosity="std"
                  work_dir="."&gt;<br />
                  &lt;/entry&gt;<br />
                </blockquote>
                &lt;/entries&gt;<br />
              </blockquote>
              &lt;/entry_set&gt;<br />
            </blockquote>
            &lt;/entry_sets&gt;<br />
            ...
          </a>
        </div>
      </div>

      <div class="section" id="advanced">
        <h2 class="western">Advanced topics</h2>
        <p>
          While the above is enough for setting up a personal glidein pool on
          the local area network, you will need to do more fine tuning when
          deploying a larger one. In this section, the various advanced aspects
          of glidein pools will be presented.
        </p>
      </div>

      <div class="section" id="single_user">
        <h3 class="western">
          Migration process for the removal of dependency of
          condor_root_switchboard (Upgrade to v3.5)
        </h3>

        <p>
          Starting v3.5, GlideinWMS stopped supporting Globus GRAM GT2/GT5 and
          Factory and all pilot jobs run under a single user (gfactory) to
          eliminate the need of switchboard and setuid/user-switching. Thus, all
          glideins will run using the Factory user (no more separated users
          per-VO). For the log and secure files, the same directory structure
          remains the same, only the ownership will change.
        </p>

        <p>
          The transition for the new jobs is clear. But either for upgrading an
          existing Factory version from v3.4.x or ealier (even if there are no
          glideins) or for the old glideins that are still running, there is a
          process which will ease the migration process for this purpose. This
          process implies the execution of a script which:<br />
          1. Will change the ownership of the log and security file
          directories<br />
          2. Will run a sed command on the condor job_queue files to change
          ownership of jobs inside condor<br />

          First of all, to check what the script does, you must be located in
          factory/tools of your GWMS installation and execute like (add --debug
          for a more verbose output):
        </p>

        <blockquote>
          sudo fact_chown --user=gfactory --group=gfactory --test --backup
        </blockquote>

        This execution should show you how the script works without making
        changes. It will also create a backup of the files that is going to
        modify in the current working directory. Please, notice that if you
        create the backup now, make sure that both condor and the factory are
        not running. Otherwise the backup might be out of date.<br />

        If you know what you are doing and, you would like actually to do the
        migration, please follow the following steps:<br />

        1. Stop Factory and <b>stop condor</b>. (This step is very important
        condor must not run when the script is being executed!)<br />
        2. Run the script fact_chown indicating the user and the group which the
        directories and their content will take the ownership. Add also the flag
        <b>--backup</b> to have backup of everything (or not if you are happy
        with a backup created previously). Example with backups (notice the
        absence of --test):

        <blockquote>
          sudo fact_chown --user=gfactory --group=gfactory --backup
        </blockquote>

        3. Start condor and Factory and check the changes<br />
        <p>
          Remember:<br />
          - Run the script with no options if you don't want to have backups.<br />
          - If you see the permissions have changed but not the ownership, make
          sure you have executed the script with condor stopped.<br />
          - If pilots go held after executing the script, make sure that you
          have executed the steps as indicated before. If condor was running
          during the script execution: stop condor, run the script again and
          release the jobs.<br />
        </p>

        <p>
          After executing these steps, you should see your jobs changed user in
          condor_q to the new owner. Also, the onwership to Factory user
          (gfactory) of: <br />
          - Log files directories in /var/log/gwms-factory/client/<br />
          - Security files directory in /var/lib/gwms-factory/client-proxies/<br />
          - All files and folders in the corresponding folder's tree indicated
          before:<br />
          -
          /var/log/gwms-factory/client/&lt;user_username&gt;/glidein_gfactory_instance/<br />
          - /var/lib/gwms-factory/client-proxies/&lt;USER_DIRS&gt; <br />
        </p>

        <p>
          To <b>revert</b> to a previous version of GlideinWMS, you need to
          restore the job_queue files and change back the permissions of the log
          directories. As commented previously, those operations need to be
          performed with both condor and GlideinWMS stoppped. <br />
          - To restore the job_queue condor files: untar all the
          schedd_glideins1_job_queue.log.tar.gz files, and move the
          job_queue.log file into its original location. You can print it when
          you run the fact_chown script (you can also run it with --test and
          --skipchown)<br />
          - To restore the directory permissions for the logfiles, you can run
          the following command: <br />
        </p>

        <blockquote>
          for dir in /var/log/gwms-factory/client/user_fe*; do
          USERARR=(${dir//_/ }); USER=${USERARR[1]}; chown -R $USER:$USER $dir;
          done
        </blockquote>

        <h4 class="western">
          <a name="ccb"></a>CCB - Condor Connection Broker
        </h4>
        <p>
          <br />
          The detailed description of CCB is beyond the scope of this manual and
          you should refer to the HTCondor documentation available
          <a
            href="https://htcondor.readthedocs.io/en/latest/admin-manual/networking.html?highlight=CCB#networking-includes-sections-on-port-usage-and-ccb"
            >here</a
          >. , where you will find only the parameters needed to enable it in
          the glideins.
        </p>
        <p>To use HTCondor with CCB, you need to specify:</p>
        <div class="xml">
          &lt;glidein&gt;<br />
          &nbsp;<i>[&lt;entries&gt;&lt;entry&gt;]</i><br />

          &nbsp;&lt;attrs&gt;<br />
          &nbsp;&nbsp;&lt;attr name=&quot;USE_CCB&quot; value=&quot;True&quot;
          publish=&quot;False&quot; parameter=&quot;True&quot;/&gt;
        </div>
        <p>
          and you are done. Just make sure you follow the
          <a
            href="https://htcondor.readthedocs.io/en/latest/admin-manual/networking.html?highlight=CCB#scalability-and-ccb"
            >suggested scalability guidelines described in the HTCondor
            manual</a
          >.
        </p>
      </div>

      <div class="section" id="singularity">
        <h3 class="western">Integration with Singularity</h3>
        <ul>
          <li>
            <p style="margin-bottom: 0in">
              An entry can control the use of Singularity by setting
              GLIDEIN_SINGULARITY_REQUIRE to NEVER (Singularity is not
              supported), OPTIONAL or PREFERRED (capable of Singularity but it
              is not enforced), REQUIRED (jobs must run with Singularity) or
              REQUIRED_GWMS (jobs must run with Singularity and use the GWMS
              wrapper scripts). This last option is the only one that really
              enforces Singularity, but is not compatible with VOs that
              currently self-manage Singularity with custom scripts, like OSG
              and CMS. The attribute can be set in the general or entry
              &lt;attrs&gt; section of the Factory configuration: &lt;attr
              name=&quot;GLIDEIN_SINGULARITY_REQUIRE&quot;
              const=&quot;True&quot; glidein_publish=&quot;True&quot;
              job_publish=&quot;True&quot; parameter=&quot;True&quot;
              publish=&quot;True&quot; type=&quot;string&quot;
              value=&quot;REQUIRED&quot;/&gt;.<br />
              The value of GLIDEIN_SINGULARITY_REQUIRE is used by the Frontend
              to provision resources and by the Glidein to negotiate the use of
              Singularity with the jobs. An entry where Singularity is OPTIONAL
              or PREFERRED will allow to run without Singularity if the job
              prefers so or if Singularity fails. An entry requiring Singularity
              (REQUIRED, REQUIRED_GWMS) will not allow to run without
              Singularity and the Glidein will fail if Singularity fails (e.g.
              the singularity binary or the image are not found).
            </p>
          </li>
          <li>
            <p style="margin-bottom: 0in">
              If Singularity is allowed or required (all values of
              GLIDEIN_SINGULARITY_REQUIRE except NEVER), singularity is expected
              on all worker nodes of the entry. The Glidein will search a
              singularity binary in the PATH and then invoking Modules (if
              available). SINGULARITY_BIN can not be used any more to control
              the use of Singularity in the Factory. Use
              GLIDEIN_SINGULARITY_REQUIRE instead. SINGULARITY_BIN is only
              considered in the search for singularity: the keyword OSG
              (default) starts the search form the OSG provided binary, the
              keyword PATH starts the search form the system path. See
              <a htef="/factory/custom_vars.html#singularity_vars"
                >the SINGULARITY_BIN description</a
              >
              for more.
            </p>
          </li>
          <li>
            <p style="margin-bottom: 0in">
              NOTE: For compatibility with previous versions and to ease the
              migration to the use of GWMS scripts,
              GLIDEIN_SINGULARITY_REQUIRE=REQUIRED works only if Singularity is
              managed via GWMS. GLIDEIN_Singularity_Use=GWMS_DISABLE in the
              Frontend configuration (default) allows VOs to manage Singularity
              independently from GWMS. GLIDEIN_SINGULARITY_REQUIRE=REQUIRED_GWMS
              will not accept jobs where GLIDEIN_Singularity_Use=GWMS_DISABLE.
              It is a stronger enforcement, but will not allow VOs managing
              Singularity on their own. Jobs with GWMS_DISABLE will not trigger
              Glideins on entries with REQUIRED_GWMS, and the Glidein will fail
              at setup setup if somehow this combination happens.
            </p>
          </li>
          <li>
            <p style="margin-bottom: 0in">
              The Factory can specify a dictionary of available Singularity
              images using SINGULARITY_IMAGES_DICT. This can be overridden by
              the Frontend, unless the attribute is declared constant
              (const="True"). &lt;attr name=&quot;SINGULARITY_IMAGES_DICT&quot;
              const=&quot;False&quot; glidein_publish=&quot;True&quot;
              job_publish=&quot;True&quot; parameter=&quot;True&quot;
              publish=&quot;True&quot; type=&quot;string&quot;
              value=&quot;rhel7:/cvmfs/singularity.opensciencegrid.org/opensciencegrid/osgvo-el7:latest,rhel6:/cvmfs/singularity.opensciencegrid.org/opensciencegrid/osgvo-el6:latest,rhel8:/cvmfs/singularity.opensciencegrid.org/opensciencegrid/osgvo-el8:latest&quot;/&gt;.
            </p>
          </li>
          <li>
            <p style="margin-bottom: 0in">
              The Factory can specify bind-mounts for Singularity images using
              GLIDEIN_SINGULARITY_BINDPATH_DEFAULT. This can be overridden by
              the Frontend, unless the attribute is declared constant
              (const="True"). If one or more of the specified paths does not
              exist on the node, it will be removed from the list. &lt;attr
              name=&quot;GLIDEIN_SINGULARITY_BINDPATH_DEFAULT&quot;
              const=&quot;False&quot; glidein_publish=&quot;True&quot;
              job_publish=&quot;True&quot; parameter=&quot;True&quot;
              publish=&quot;True&quot; type=&quot;string&quot;
              value=&quot;/cvmfs,/src_path:/dst_path&quot; /&gt;.
            </p>
          </li>
          <li>
            <p style="margin-bottom: 0in">
              The use of Singularity is negotiated according to the table below,
              using GLIDEIN_SINGULARITY_REQUIRE (from the Factory) and
              GLIDEIN_Singularity_Use (from the Frontend), resulting in DISABLE
              (do not use the GWMS Singularity mechanisms), FAIL (do not
              provision on this entry, do not match with these Glideins or fail
              the Glidein), NEVER (do not use Singularity), PREFERRED (use
              Singularity but allow to fall-back to no Singularity if something
              goes wrong, e.g. no image is found) or REQUIRED (use Singularity
              and fail the Glidein if it cannot run with Singularity).<br />
              The specification of a Singularity image in a job
              (+SingularityImage) removes the possibility to fall-back to no
              Singularity if something goes wrong.
              <b>The table below combines GLIDEIN_SINGULARITY_REQUIRE</b> values
              (first row, in bold) <b>and GLIDEIN_Singularity_Use</b> values
              (first column, in bold) and the results are in the intersection.
              REQUIRED_GWMS is in the same column as REQUIRED and the only
              difference is with DISABLE_GWMS, where it causes FAIL instead of
              DISABLE.
            </p>

            <table class="requirements">
              <tr>
                <td>
                  <p><b></b></p>
                </td>
                <td>
                  <p><b>NEVER</b></p>
                </td>
                <td>
                  <p><b>OPTIONAL</b></p>
                </td>
                <td>
                  <p><b>PREFERRED</b></p>
                </td>
                <td>
                  <p><b>REQUIRED (REQUIRED_GWMS)</b></p>
                </td>
              </tr>
              <tr>
                <td>
                  <p><b>NEVER</b></p>
                </td>
                <td><p>NEVER</p></td>
                <td><p>NEVER</p></td>
                <td><p>NEVER</p></td>
                <td><p>FAIL</p></td>
              </tr>
              <tr>
                <td>
                  <p><b>OPTIONAL</b></p>
                </td>
                <td><p>NEVER</p></td>
                <td><p>NEVER</p></td>
                <td><p>PREFERRED</p></td>
                <td><p>REQUIRED</p></td>
              </tr>
              <tr>
                <td>
                  <p><b>PREFERRED</b></p>
                </td>
                <td><p>NEVER</p></td>
                <td><p>PREFERRED</p></td>
                <td><p>PREFERRED</p></td>
                <td><p>REQUIRED</p></td>
              </tr>
              <tr>
                <td>
                  <p><b>REQUIRED</b></p>
                </td>
                <td><p>FAIL</p></td>
                <td><p>REQUIRED</p></td>
                <td><p>REQUIRED</p></td>
                <td><p>REQUIRED</p></td>
              </tr>
              <tr>
                <td>
                  <p><b>DISABLE_GWMS</b></p>
                </td>
                <td><p>DISABLE</p></td>
                <td><p>DISABLE</p></td>
                <td><p>DISABLE</p></td>
                <td><p>DISABLE (FAIL)</p></td>
              </tr>
            </table>
          </li>
        </ul>
      </div>
      <div class="section" id="glexec">
        <h3 class="western">GlExec</h3>

        <p>
          All of the glideins in a Frontend group are submitted with the same
          service proxy. gLExec is a tool, now unsupported, that was used before
          containers to achieve security (sandboxing) and isolation between
          different jobs in the same Glidein. It used a service with sudo
          privileges to switch the jobs to different Unix users dpending on the
          identity in a x509/VOMS Proxy. To obtain the same results look into
          Singularity. This section is kept for historical reasons.
        </p>
      </div>

      <div class="section" id="private_net">
        <h3 class="western">Private networks and firewalls</h3>

        <p>
          HTCondor daemons need two way communication in order to work properly.
          This clashes with the network policies of most Grid sites, that have
          worker nodes in private networks or implement a restrictive firewall.
        </p>
        <p>
          HTCondor provides the CCB mechanism to address this. It was providing
          also a second mechanism, GCB, but it is no more supported after
          HTCondor 7.8, so remove it if you still have it in your configuration.
        </p>

        <h4 class="western">
          <a name="ccb"></a>CCB - Condor Connection Broker
        </h4>
        <p>
          <br />
          The detailed description of CCB is beyond the scope of this manual and
          you should refer to the HTCondor documentation available
          <a
            href="https://htcondor.readthedocs.io/en/latest/admin-manual/networking.html?highlight=CCB#networking-includes-sections-on-port-usage-and-ccb"
            >here</a
          >. , where you will find only the parameters needed to enable it in
          the glideins.
        </p>
        <p>To use HTCondor with CCB, you need to specify:</p>
        <div class="xml">
          &lt;glidein&gt;<br />
          &nbsp;<i>[&lt;entries&gt;&lt;entry&gt;]</i><br />

          &nbsp;&lt;attrs&gt;<br />
          &nbsp;&nbsp;&lt;attr name=&quot;USE_CCB&quot; value=&quot;True&quot;
          publish=&quot;False&quot; parameter=&quot;True&quot;/&gt;
        </div>
        <p>
          and you are done. Just make sure you follow the
          <a
            href="https://htcondor.readthedocs.io/en/latest/admin-manual/networking.html?highlight=CCB#scalability-and-ccb"
            >suggested scalability guidelines described in the HTCondor
            manual</a
          >.
        </p>
      </div>

      <div class="section" id="security">
        <h3 class="western">Security handles</h3>
        <p>
          As mentioned in the
          <a href="../index.html#pool_glidein">startup page</a>, the glidein
          pool must be properly configured to protect it from hackers and
          malicious users. The same page also describes what needs to be done on
          the collector machine.<br />The glidein itself can also be configured.
          The default configuration works fine for most users, but you may need
          to change them.<br /><br />The values are set using the
          <tt><b>&lt;attr /&gt;</b></tt> option, and the default values are:
        </p>

        <tt>
          <ul>
            <li><b>SEC_DEFAULT_ENCRYPTION</b>=OPTIONAL</li>
            <li><b>SEC_DEFAULT_INTEGRITY</b>=REQUIRED</li>
            <li><b>DELEGATE_JOB_GSI_CREDENTIALS</b>=False</li>
          </ul>
        </tt>
        <p>
          HTCondor also supports a more efficient authentication mechanism
          between the condor_schedd/condor_shadow and
          condor_startd/condor_starter. This method uses the match ClaimId as a
          shared password for authentication between these daemons. Since using
          a shared secret is much cheaper that using GSI authentication, this
          should be used every time it is feasible.
        </p>

        <p>
          This option is enabled by default.
          <tt><b>&lt;attr /&gt;</b></tt> option:
        </p>
        <blockquote>
          &lt;attr name=<b>USE_MATCH_AUTH</b> ... value=<b>True</b>.. /&gt; ...
          <font color="blue"><b>enabled</b></font>
          <br />
          &lt;attr name=<b>USE_MATCH_AUTH</b> ... value=<b>False</b>.. /&gt; ...
          <font color="red"><b>disabled</b></font>
        </blockquote>
        <p>
          When enabled, this HTCondor attribute <b>must</b> be set in the
          <b>condor_config</b> of the <b>submit machine</b>.<br />
          This option is not used by the HTCondor negotiator or collector and
          therefore not needed if they are installed separately.
        </p>

        <p></p>
        <blockquote>
          <b>SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION</b> = True
        </blockquote>
      </div>

      <div class="section" id="tcp">
        <h3 class="western">Using TCP to send updates to the Collector</h3>
        <p>
          By default, HTCondor uses UDP packets to communicate between the
          glideins and the Collector. While more efficient than TCP, UDP packets
          are often blocked at the firewall, or lost on the WAN.
        </p>
        <p>
          To disable TCP updates, specify, with the
          <tt>&lt;<b>attr</b>/&gt;</tt> option:
        </p>
        <blockquote><b>UPDATE_COLLECTOR_WITH_TCP</b>=False</blockquote>
        <p>
          In GlideinWMS, we enable the glideins to update the user collector
          using TCP by default. <br />Please be aware that this will configure
          the glideins only; you still need to properly configure the Collector
          machine. See
          <a
            href="https://htcondor.readthedocs.io/en/latest/admin-manual/networking.html?highlight=CCB#networking-includes-sections-on-port-usage-and-ccb"
            >Condor documentation</a
          >
          for more details.
        </p>
      </div>

      <div class="section" id="multicol">
        <h3 class="western">Multiple Collectors</h3>
        <p>
          By default, HTCondor uses only one Collector for the
          <a href="../index.html#pool_glidein">glidein (user) pool</a>. However,
          if the load becomes too high on the collector, you can configure
          multiple collectors in a chain.
        </p>
        <p>
          You will need a master and a set of slave collectors. Each slave
          collector will service a portion of the pool and will forward
          communication between the startd daemons to the master collector.
          Machine ClassAds from these startd's will be sent to the master
          collector. The negotiator and the schedds will talk to the master
          collector, and the startds will talk to one of the slave ones. This
          will reduce load on the central manager.
        </p>
        <p>
          To set up slave collector in the
          <a href="../index.html#pool_glidein">glidein (user) pool</a>, one way
          is to set the following env variables before starting up the
          condor_master:
        </p>
        <pre>
COLH=`condor_config_val COLLECTOR_HOST`
LD=`condor_config_val LOCAL_DIR`
export _CONDOR_COLLECTOR_HOST=$COLH:
export _CONDOR_MASTER_NAME=collector_
export _CONDOR_DAEMON_LIST=&quot;MASTER, COLLECTOR&quot;
export _CONDOR_LOCAL_DIR=$LD/$_CONDOR_MASTER_NAME
export _CONDOR_LOCK=$_CONDOR_LOCAL_DIR/lock
# Forward all the traffic to the main collector
export _CONDOR_CONDOR_VIEW_HOST=localhost:9618</pre
        >
        <p>
          Using <t>localhost</t> to communicate to the master collector is more
          efficient. But will not work if they are on different hosts with
          HTCondor version 8.2. For those case you'll need:
          <t>export _CONDOR_CONDOR_VIEW_HOST=$COLH:9618</t>
        </p>
        <p>
          Once you have the slave collectors set up, you will want to use them.
        </p>
        <p>
          The <a href="../frontend/index.html">VO Frontend</a>
          will have to point the Factory to a
          <a href="../frontend/index.html#management">list of collectors</a>.
        </p>
        <p>
          The configuration internally will add a line in the Factory
          configuration file that will set up the glideins to handle the
          multiple collectors. (You should now see a line like:
          <i
            >"&lt;file absfname=&quot;web_base/collector_setup.sh&quot;
            executable=&quot;True&quot;/&gt;"</i
          >
          after reconfiguring).
        </p>
      </div>

      <div class="section">
        <h3 class="western">
          <a name="start_rank"></a>Setting the glidein start and
          rank&nbsp;condition
        </h3>
        <p>
          As with any HTCondor pool, you may need to set the startd
          <a
            href="https://htcondor.readthedocs.io/en/latest/admin-manual/policy-configuration.html?highlight=Policy%20configuration#the-start-expression"
            >start</a
          >
          and
          <a
            href="https://htcondor.readthedocs.io/en/latest/admin-manual/policy-configuration.html?highlight=Policy%20configuration#the-rank-expression"
            >rank</a
          >
          conditions. <br />

          For a glidein, you can set this with the &lt;<b>attr</b>/&gt; options:
        </p>
        <blockquote>
          <b>GLIDEIN_Start</b>=<i>expression</i><br />
          <b>GLIDEIN_Rank</b>=<i>expression</i>
        </blockquote>

        <p>For example:</p>

        <div class="xml">
          &lt;glidein&gt;<br />
          &nbsp;<i>[&lt;entries&gt;&lt;entry&gt;]</i><br />
          &nbsp; &lt;attrs&gt;<br />
          &nbsp; &nbsp; &lt;attr name=&quot;GLIDEIN_Start&quot;
          value=&quot;Owner==&amp;quot;sfiligoi&amp;quot;&quot;
          publish=&quot;False&quot; parameter=&quot;True&quot;/&gt;<br />
          &nbsp; &nbsp; &lt;attr name=&quot;GLIDEIN_Rank&quot;
          value=&quot;ImageSize&quot; publish=&quot;False&quot;
          parameter=&quot;True&quot;/&gt;
        </div>
      </div>

      <div class="section">
        <h3>Internal Configuration</h3>
        The configuration is parsed during the reconfiguration of the Factory,
        and split into a number of files:
        <ul>
          <li>job.descript => read by the daemon do decide how to work</li>
          <li>
            attributes.cfg => fixed values, these are published in the Factory
            ClassAd
          </li>
          <li>
            params.cfg => for values the Frontend will change, also published in
            the Factory ClassAd
          </li>
        </ul>
        For more information, see the
        <a href="design_entry.html#config">Entry Internals</a> page.
      </div>
      <div class="section" id="tarballs">
        <h3>Multiple Condor Tarballs</h3>

        <p>
          One frequent problem is that one particular condor binary will not run
          on all compute nodes. Entry points require different architectures, or
          have different versions of glibc.
        </p>
        <p>
          The solution is to have multiple condor binaries. The way to do this
          is to specify a tarball tag in the Factory configuration file.
        </p>
        <ol>
          <li>
            Download the HTCondor binary from the
            <a
              target="_blank"
              href="http://research.cs.wisc.edu/htcondor/downloads/"
              >University of Wisconsin</a
            >
            site. (Alternatively, You can build it from scratch on the
            architecture. Refer to HTCondor instructions for this.)
            <br />
            The glideinwms pilot uses a subset of the condor binaries/libraries.
            The <tt>create_condor_tarball</tt>
            script can be used to reduce space needed on your Factory node.
            Details on this script can be found in the
            <a href="../components/tools.html#create_condor_tarball">
              Components - Tools section of the documentation</a
            >.
          </li>
          <p />

          <li>
            Add a new <tt>condor_tarball</tt> tag to the Factory configuration
            file:<br />
            There are two different ways you can do this:
            <ul>
              <li>
                Put the tarball in a directory owned by the wmsfactory and enter
                the <tt>condor_tarball</tt> tag as:
                <blockquote>
                  &lt;glidein ... &gt;<br />
                  ...<br />
                  &nbsp;&nbsp;&lt;condor_tarballs &gt;<br />
                  &nbsp;&nbsp;&nbsp;&nbsp;&lt;condor_tarball os="<i>OS</i>"
                  arch="<i>Arch</i>"
                  <font color="blue"><b>tar_file="ZIPPED_TARFILE</b></font
                  >" version="<i>Condor_Version</i>" /&gt;
                </blockquote>
              </li>
              <li>
                Put the tarball in a directory owned by the wmsfactory and
                unzip/untar it. Then, enter the <tt>condor_tarball</tt> tag as:
                <blockquote>
                  &lt;glidein ... &gt;<br />
                  ...<br />
                  &nbsp;&nbsp;&lt;condor_tarballs &gt;<br />
                  &nbsp;&nbsp;&nbsp;&nbsp;&lt;condor_tarball os="<i>OS</i>"
                  arch="<i>Arch</i>"
                  <font color="blue"
                    ><b>base_dir="DIR_OF_UNTARRED_BINARY"</b></font
                  >
                  version="<i>Condor_Version</i>" /&gt;
                </blockquote>
              </li>
            </ul>
            <p />
            To simplify the configuration, os, arch and version support comma
            values. This can drastically reduce the number of condor_tarball
            entries needed in the configuration file.
            <br /><br />
            Consider an example below for default <tt>OS as rhel5</tt> and
            <tt>default arch as x86_64</tt>. If the Factory admin also wants
            <tt>os</tt> and <tt>arch</tt> information explicitly available, the
            configuration needs following entries to cover possible
            combinations.
            <blockquote>
              &lt;condor_tarball
              <font color="blue"><b>os="default" arch="default"</b></font>
              base_dir="dir" version="default"/&gt;<br />
              &lt;condor_tarball
              <font color="blue"><b>os="rhel6" arch="x86_64"</b></font>
              base_dir="dir" version="default"/&gt;<br />
              &lt;condor_tarball
              <font color="blue"><b>os="rhel6" arch="default"</b></font>
              base_dir="dir" version="default"/&gt;<br />
              &lt;condor_tarball
              <font color="blue"><b>os="default" arch="x86_64"</b></font>
              base_dir="dir" version="default"/&gt;
            </blockquote>
            Above example can be easily consolidated into a single
            <tt>condor_tarball</tt>
            entry as below and the Factory reconfiguration process will
            internally consider all the combinations. This also applies to the
            <tt>version</tt>.
            <blockquote>
              &lt;condor_tarball
              <font color="blue"
                ><b>os="default,rhel6" arch="default,x86_64"</b></font
              >
              base_dir="dir" <font color="blue"><b>version="default"</b></font
              >/&gt;
            </blockquote>
          </li>
          <p />
          <li>
            Verify your <tt>entry</tt> point attributes. Each
            <tt>entry</tt> point will have the following <tt>attr</tt> set up.
            Make sure that this matches the above
            <tt>condor_tarball</tt> parameters:<br />
            <blockquote>
              &lt;entry&gt;<br />
              &nbsp;&nbsp; &lt;attrs&gt;<br />
              &nbsp;&nbsp;&nbsp;&nbsp; &lt;attr
              <font color="blue"><b>name="CONDOR_ARCH"</b></font> const="True"
              parameter="True" glidein_publish="False" job_publish="False"
              publish="False" type="string"
              <font color="blue"><b>value="<i>Arch</i>"</b></font
              >/&gt;<br />
              &nbsp;&nbsp;&nbsp;&nbsp; &lt;attr
              <font color="blue"><b>name="CONDOR_OS"</b></font> const="True"
              parameter="True" glidein_publish="False" job_publish="False"
              publish="False" type="string"
              <font color="blue"><b>value="<i>Condor_Version</i>"</b></font
              >/&gt;<br />
              &nbsp;&nbsp;&nbsp;&nbsp; &lt;/attrs&gt;<br />
            </blockquote>
            The CONDOR_OS and the CONDOR_ARCH should match the <tt>os</tt> and
            <tt>arch</tt> defined in the tarball tag. If set to "auto", the
            glidein will decide the appropriate tarball to use for that worker
            node. By default, the CONDOR_VERSION will be defined globally in
            <tt>&lt;glidein&gt;&lt;attrs&gt;</tt> and should match the version
            in the <tt>condor_tarball</tt> tag. You can overwrite this global
            version and define one locally in the <tt>entry</tt> if needed.
          </li>
          <p />
          <li>
            Reconfigure the Factory using the command:
            <blockquote>
              ./factory_startup reconfig ../CONFIG_DIR/glideinWMS.xml
            </blockquote>
          </li>
          <p />
          <li>
            After reconfig, you can see the <tt>tar_file</tt> created from the
            condor distribution in the <tt>condor_tarball</tt> element in the
            configuration as (if you populated just <tt>tar_file</tt> in step 2
            <blockquote>
              &lt;condor_tarball arch="default" os="default"
              <font color="blue"
                ><b>tar_file="FACTORY_DIR/condor-8.7tgz"</b></font
              >
              version="default"/&gt;
            </blockquote>
            or (if you populated just <tt>base_dir</tt> in step 2)
            <blockquote>
              &lt;condor_tarball arch="default"
              base_dir="/opt/glideins/git-xen21-master-ps.ini/condor-wms"
              os="default"
              <font color="blue"
                ><b
                  >tar_file="/var/www/html/glideinwms/factory_service/stage/glidein_master/condor_bin_0.d7bbk9.tgz"</b
                ></font
              >
              version="default"/&gt;
            </blockquote>
          </li>
        </ol>
      </div>

      <div class="section">
        <h3 class="western">
          <a name="time_limit"></a>Limiting time spent on a Grid resource
        </h3>

        <p>
          The whole concept of gliding into Grid resources is based on the idea
          that you are getting those resources on a <b>temporary basis</b>. This
          implies that you need to leave the slot as soon as possible, else your
          jobs will simply be killed by the annoyed Grid administrators.<br />
          On the other hand, submitting new glideins is not cost free, so you
          want to keep the resource for at least some period of time.
        </p>
        <p>The glideins have two mechanisms to regulate this:</p>
        <ol>
          <li>
            <p>
              After a specified amount of time, the glidein will enter the
              <a
                href="https://htcondor.readthedocs.io/en/latest/admin-manual/policy-configuration.html?highlight=Policy%20configuration#machine-activities"
                >RETIRING state</a
              >. This means, it will wait for the current job to finish (or kill
              it if it does not end within a configurable timeout) and exit
              immediately afterwards. This obviously implies that no new jobs
              will start after it entered that state.<br />The two timeouts can
              be set with the &lt;<b>attr</b> /&gt; options:
            </p>

            <blockquote>
              <b>GLIDEIN_Retire_Time</b>=<i>nr_of_seconds</i><br />
              <b>GLIDEIN_Job_Max_Time</b>=<i>nr_of_seconds</i>
            </blockquote>
            <p>The two default to 2 and 100 hours.</p>
          </li>

          <li>
            <p>
              If a glidein is not claimed within a configurable timeout, the
              glidein will exit.<br />The timeout can be set with:
            </p>
            <blockquote>
              <b>GLIDEIN_Max_Idle</b>=<i>nr_of_seconds</i>
              <b>GLIDEIN_Max_Tail</b>=<i>nr_of_seconds</i>
            </blockquote>
            <p>
              There are two configurable parameters for this timeout behavior.
              The first, GLIDEIN_Max_Idle, affects how long a glidein will wait
              for its first job. The second parameter is how long a glidein will
              wait to get a subsequent job once its finished its job. The
              defaults for these are 1200 and 400 seconds, respectively.
            </p>
          </li>
        </ol>

        <p>An example:</p>
        <div class="xml">
          &lt;glidein&gt;<br />
          &nbsp;[&lt;entries&gt;&lt;entry&gt;]<br />&nbsp; &lt;attrs&gt;<br />

          &nbsp; &nbsp; &lt;attr name=&quot;GLIDEIN_Max_Idle&quot;
          value=&quot;300&quot; type=&quot;int&quot; publish=&quot;False&quot;
          parameter=&quot;True&quot;/&gt;<br />

          &nbsp; &nbsp; &lt;attr name=&quot;GLIDEIN_Retire_Time&quot;
          value=&quot;14400&quot; type=&quot;int&quot; publish=&quot;False&quot;
          parameter=&quot;True&quot;/&gt;<br />
          &nbsp;&nbsp;&lt;attr name=&quot;GLIDEIN_Job_Max_Time&quot;
          value=&quot;180000&quot; type=&quot;int&quot;
          publish=&quot;False&quot; parameter=&quot;True&quot;/&gt;
        </div>
      </div>

      <div class="section">
        <h3 class="western">
          <a name="multi-monitor"></a>Old-style pseudo-interactive monitoring
        </h3>
        <p>
          The pseudo-interactive monitoring uses a dedicated startd in the
          glideins for monitoring purposes. This allows for monitoring even when
          the job starter enters the &ldquo;<i>Retiring&rdquo;</i> activity.
        </p>

        <p>
          The side effect is that you do not have anymore the cross-VM
          statistics and the names of the slots is also different.
        </p>
        <p>To enable the old mode, use:</p>
        <div class="xml">
          &lt;attr name=&quot;MONITOR_MODE&quot; const=&quot;True&quot;
          glidein_publish=&quot;False&quot; job_publish=&quot;False&quot;
          parameter=&quot;True&quot; publish=&quot;False&quot;
          type=&quot;string&quot; value=&quot;MULTI&quot;/&gt;
        </div>
      </div>

      <div class="section">
        <h3 class="western">
          <a name="custom_code"></a><a name="files"></a>Adding custom
          files/scripts to the glideins
        </h3>
        <p>
          While provided code should cover most of the general purpose use
          cases, some administrators may have additional needs. For these cases,
          the Glidein framework provides the possibility to download and process
          additional files. Both , Factory and Frontend configuration allow to
          specify lists of files either for all their glideins, for a specific
          entry (Factory), or job group (Frontend). These files can be scripts
          (executables), regular files or tarballs and depending on the options
          can be downloaded at different times (see
          <a href="custom_scripts.html">the custom scripts document</a> for more
          detils).
        </p>
        <p>
          <b>Note:</b> <a name="ref"></a>Files and subsystems will be downloaded
          before the scripts. User provided scripts will be executed in the
          specified order, and before the HTCondor daemons are started up.
        </p>
        Here a list of the attributes of the files. Some examples follow below:
        <table class="requirements">
          <tr class="head">
            <td>
              <p><b>Attribute Name</b></p>
            </td>
            <td>
              <p><b>Attribute Description</b></p>
            </td>
          </tr>
          <tr>
            <td>
              <p><b>absfname</b></p>
            </td>
            <td>
              <p>
                Path of the file on the server (Factory or Frontend). The file
                name (basename of absfname) can be used also to control the
                conditional download of the file. If the file name starts with
                "gconditional_" (e.g. gconditional_FEATURE_myfile), then the
                name between the prefix and the following underscore is taken
                and GWMS will look for an attribute (in the attrs list) called
                GLIDEIN_USE_ followed by the name, and download and process the
                file only if the attribute is defined and not empty (e.g.
                GLIDEIN_USE_FEATURE=1).
              </p>
            </td>
          </tr>
          <tr>
            <td>
              <p><b>executable</b></p>
            </td>
            <td>
              <p>
                True if the file is a script (executable, see example below),
                default is False
              </p>
            </td>
          </tr>
          <tr>
            <td>
              <p><b>wrapper</b></p>
            </td>
            <td>
              <p>
                True if the file is a user wrapper (see example below), default
                is False
              </p>
            </td>
          </tr>
          <tr>
            <td>
              <p><b>untar</b></p>
            </td>
            <td>
              <p>
                True if the file is a tarball that needs to be expanded (see
                example below), default is False
              </p>
            </td>
          </tr>
          <tr>
            <td>
              <p><b>type</b></p>
            </td>
            <td>
              <p>
                File type, must be one of the valid types (regular, run, source,
                wrapper, untar). Can have qualifiers depending on the type after
                a colon (":"). Valid qualifier for <i>run</i> is "singularity"
                causes setup scripts to run in Singularity. Currently
                <i>type</i> is ignored for non executables and the only values
                used are "run" or "run:singularity". Default is empty
              </p>
            </td>
          </tr>
          <tr>
            <td>
              <p><b>const</b></p>
            </td>
            <td>
              <p>
                If False the file is not constant (i.e. changes may happen
                without a reconfiguration of the Factory and the file cannot be
                checksummed), default is True
              </p>
            </td>
          </tr>
          <tr>
            <td>
              <p><b>relfname</b></p>
            </td>
            <td>
              <p>
                Path to save the file, relative to the glidein main directory
              </p>
            </td>
          </tr>
          <tr>
            <td>
              <p><b>period</b></p>
            </td>
            <td>
              <p>
                If period>0 is the period (in seconds) of the executable .
                Default is 0 (non periodic script). This is ignored for non
                executable scripts. (see
                <a href="custom_scripts.html">the custom scripts document</a>
                for more)
              </p>
            </td>
          </tr>
          <tr>
            <td>
              <p><b>prefix</b></p>
            </td>
            <td>
              <p>
                STARTD_CRON prefix, it is prepended to all HTCondor variables
                generated by the script (see documentation). This is ignored
                from anything different from a periodic executable script. The
                default value is <it>GLIDEIN_PS_</it>, use <it>NOPREFIX</it> to
                have no prefix. Be aware that if you choose not to have a prefix
                your HTCondor variables may collide with other scripts or
                variables. Variables used by the wrapper, like GLIDEIN_PS_LAST,
                will keep using the prefix.
              </p>
            </td>
          </tr>
          <tr>
            <td>
              <p><b>comment</b></p>
            </td>
            <td><p>Arbitrary comment string</p></td>
          </tr>
          <tr>
            <td>
              <p><b>after_entry</b></p>
            </td>
            <td>
              <p>
                If True, the script is executed after the entry scripts. Default
                is False for the Factory, default is True for the Frontend. (see
                <a href="custom_scripts.html">the custom scripts document</a>
                for more)
              </p>
            </td>
          </tr>
          <tr>
            <td>
              <p><b>after_group</b></p>
            </td>
            <td>
              <p>
                If True, the Frontend script is executed after the group
                scripts. Default is False. Not considered in the Factory. (see
                <a href="custom_scripts.html">the custom scripts document</a>
                for more)
              </p>
            </td>
          </tr>
        </table>

        <ul>
          <li>
            <div class="xml">
              &lt;glidein&gt;<br />

              &nbsp;[&lt;entries&gt;&lt;entry&gt;]<br />
              &nbsp;&lt;files&gt;<br />
              &nbsp;&nbsp;&lt;file absfname=&quot;<i>script name</i>&quot;
              executable=&quot;True&quot; prefix=&quot;<i>cron_prefix</i>&quot;
              comment=&quot;<i>comment</i>&quot;/&gt;
            </div>
            <p>
              Path to the custom script. The script will be copied in the
              Web-accessible area, and when a glidein starts, the glidein
              startup script will pull it and execute it. If any parameters are
              needed, they can be specified using <b>&lt;attr /&gt;</b>, or
              stored in a file (see below). <br />
              For more detailed information, see the page dedicated to
              <a href="custom_scripts.html">writing custom scripts</a>.
            </p>

            <div class="xml">
              &lt;glidein&gt;<br />
              &nbsp;[&lt;entries&gt;&lt;entry&gt;]<br />
              &nbsp;&lt;files&gt;<br />
              &nbsp; &nbsp;&lt;file absfname=&quot;<i>script name</i>&quot;
              wrapper=&quot;True&quot; comment=&quot;<i>comment</i>&quot;/&gt;
            </div>
            <p>
              Path to the wrapper custom script. The script will be copied in
              the Web-accessible area, and will be sourced just before a user
              job starts; i.e. it will become part of the
              <a
                href="https://htcondor.readthedocs.io/en/latest/admin-manual/configuration-macros.html?highlight=Configuration%20Macros"
                >user job wrapper</a
              >.
            </p>

            <div class="xml">
              &lt;glidein&gt;<br />
              &nbsp;[&lt;entries&gt;&lt;entry&gt;]<br />
              &nbsp;&lt;files&gt;<br />
              &nbsp; &nbsp;&lt;file absfname=&quot;<i>local file name</i>&quot;
              relfname=&quot;<i>target file name</i>&quot;
              const=&quot;<i>Bool</i>&quot; executable=&quot;False&quot;
              comment=&quot;<i>comment</i>&quot;/&gt;
            </div>
            <p>
              Path to the config file. The file will be copied in the
              Web-accessible area, and pulled by the glidein startup script when
              a glidein starts. It can be then used by any script (see above).
              <br />
              <b>Note:</b> Please be cautious in using the <b>const</b> flag; if
              set to <b>False</b>, the content of the file will not be verified
              by the glidein startup script and could be tampered in transit by
              a malicious user. So never put sensitive data (like the switch to
              disable security checks) in a changeable file.
            </p>
          </li>

          <li>
            <div class="xml">
              &lt;glidein&gt;<br />
              &nbsp;[&lt;entries&gt;&lt;entry&gt;]<br />

              &nbsp;&lt;files&gt;<br />
              &nbsp;&nbsp;&lt;file absfname=&quot;<i>local file name</i>&quot;
              untar=&quot;True&quot; comment=&quot;<i>comment</i>&quot;&gt;<br />
              &nbsp; &nbsp; &lt;untar_options
              cond_attr=&quot;<i>conf_sw</i>&quot; dir=&quot;<i>dir name</i
              >&quot; absdir_outattr=&quot;<i>attr name</i>&quot;/&gt;
            </div>
            <p>
              Sometimes it is useful to transfer a whole set of files, or even
              directories, and that is much easier to accomplish by means of a
              tarball. A subsystem is the glidein way to describe a compressed
              tarball that is delivered to the worker nodes, untarred in a
              separate directory and advertised to the other scripts.
            </p>
            <ul>
              <li>
                <b>absfname</b>: Path to the custom tar-ball. (like
                &quot;/tmp/mytar_v12.5.tgz&quot;)
              </li>
              <li>
                <b>conf_sw</b>: Name of a configuration switch. (like
                &quot;ENABLE_KRB5&quot;)<br />
                The tarball will be downloaded and unpacked only if that
                parameter will be set to 1. Use the&nbsp;<b>&lt;attr /&gt;</b>
                switch to define the default value. A special name
                <b>TRUE</b> can be used to always untar it.
              </li>
              <li>
                <b>dir</b>: Name of the subdirectory to untar it in. (like
                &quot;krb5&quot;)
              </li>
              <li>
                <b>absdir_outattr</b>: Name of a variable name. (like
                &quot;KRB5_SUBSYS_DIR&quot;)<br />
                The variable will be set to the absolute path of the directory
                where the tarball was unpacked, if and only if the unpacking
                actually happened (else it will not be defined.)
                <b>ENTRY_</b> will be prepended if if the
                <b>&lt;file&gt;</b> directive occurs in an entry.
              </li>
            </ul>
          </li>
        </ul>
      </div>

      <div class="section">
        <a name="factmoncollector" />
        <h3 class="western">Monitoring collectors</h3>
        <p>
          By default, the glideins talk to the VO Pool Collector only. This
          makes monitoring them from the Factory side extremely difficult.
        </p>
        <p>
          To solve this, you can set up a Monitoring Collector tree that mirrors
          that of
          <a href="../frontend/configuration.html#usercollector"
            >the VO Pool Collector</a
          >, and tell the glideins to report there, too.
        </p>
        <p>
          The configuration syntax is very similar to that of the
          <a href="../frontend/configuration.html#usercollector"
            >the VO Pool Collector</a
          >, but using <b>monitoring_collector</b> instead of
          <b>collector</b> keyword.<br />
          For example:
        </p>

        <div class="xml">
          <blockquote>
            &lt;monitoring_colectors&gt;<br />
            <blockquote>
              &lt;monitoring_colector
              DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector.fnal.gov"
              node="factmoncollector.fnal.gov" secondary="False" group="default"
              /&gt;<br />
              &lt;monitoring_colector
              DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector.fnal.gov"
              node="factmoncollector.fnal.gov:9620-9819" secondary="True"
              group="default" /&gt;<br />
              &lt;monitoring_colector
              DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector2.fnal.gov"
              node="factmoncollector2.fnal.gov" secondary="False" group="ha"
              /&gt;<br />
              &lt;monitoring_colector
              DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector2.fnal.gov"
              node="factmoncollector2.fnal.gov:9620-9919" secondary="True"
              group="ha" /&gt;<br />
            </blockquote>
            &lt;/monitoring_colectors&gt;<br />
          </blockquote>
        </div>
        <p></p>
        <p>
          For more details, see the
          <a href="../frontend/configuration.html#usercollector"
            >Frontend documentation</a
          >.
        </p>
      </div>

      <div class="section">
        <a name="monitorgroups" />
        <h3 class="western">
          Grouping glidein Entries for monitoring purposes
        </h3>
        <p>
          Certain monitoring graphs are useful when grouped together. You can
          use the &ldquo;monitorgroups&rdquo; tag as follows to group the
          entries together.
        </p>
        <p>
          For example, below, entry1 and entry2 will be grouped together and the
          group information can be plotted against individual entry information.
        </p>
        <p></p>
        <div class="xml">
          &lt;glidein&gt;<br />
          &nbsp;&lt;entries&gt;<br />

          &nbsp; &lt;entry name=&ldquo;entry1&rdquo; ...&gt;<br />
          &nbsp; &nbsp;&lt;monitorgroups&gt;<br />
          &nbsp; &nbsp; &nbsp; &lt;monitorgroup
          group_name=&quot;Group1&quot;/&gt;<br />
          &nbsp; &nbsp; &nbsp; &lt;monitorgroup
          group_name=&quot;Group2&quot;/&gt;<br />

          &nbsp; &nbsp;&lt;/monitorgroups&gt;<br />
          &nbsp; &lt;/entry&gt;<br />
          &nbsp; &lt;entry name=&ldquo;entry2&rdquo; ...&gt;<br />
          &nbsp; &nbsp;&lt;monitorgroups&gt;<br />
          &nbsp; &nbsp; &nbsp; &lt;monitorgroup
          group_name=&quot;Group1&quot;/&gt;<br />

          &nbsp; &nbsp; &nbsp; &lt;monitorgroup
          group_name=&quot;Group4&quot;/&gt;<br />
          &nbsp; &nbsp;&lt;/monitorgroups&gt;<br />
          &nbsp; &lt;/entry&gt;<br />
          &nbsp;&lt;/entries&gt;<br />

          &lt;/glidein&gt;
        </div>
      </div>

      <div id="xsltplugins">
        <h3 class="western">XSLT Plugins to extend configuration</h3>
        <p>
          You can use XSL transformations (XSLT) to manage complex configuration
          files. During the reconfig process, the glidein Factory applies XSL
          transformations available to it in the directory configured by the
          environment variable GWMS_XSLT_PLUGIN_DIR. (It is also available by
          supplying the -xslt_plugin_dir option to the reconfig_glidein and
          reconfig_frontend commands as shown below.)
        </p>
        <p>
          Setting the variable via sysconfig files are supported:
          /etc/sysconfig/gwms-factory for the Factory service and
          /etc/sysconfig/gwms-frontend for the Frontend service, with the
          following contents:
        </p>
        <pre>
<b>prompt$</b> cat /etc/sysconfig/gwms-factory
# Configuration file for the Glideinwms services.

#
# Plugin directory to get xslt transformations from.
#

export GWMS_XSLT_PLUGIN_DIR=/etc/gwms-factory/plugin.d
        </pre>

        <p>
          The following sample XSLT adds a custom attribute to the configuration
          file used by the Factory.
        </p>

        <pre>
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; &gt;
<b>   &lt;xsl:template match=&quot;glidein/attrs&quot;&gt;</b>
       &lt;xsl:copy&gt;
<b>         &lt;attr name=&quot;SOME_GWMS_ATTRIBUTE&quot; const=&quot;False&quot; glidein_publish=&quot;False&quot; job_publish=&quot;False&quot; parameter=&quot;True&quot; publish=&quot;True&quot; type=&quot;int&quot; value=&quot;7000&quot;/&gt;</b>
         &lt;xsl:apply-templates select=&quot;@* | node()&quot;/&gt;
       &lt;/xsl:copy&gt;
   &lt;/xsl:template&gt;

   &lt;xsl:template match=&quot;/ | @* | node()&quot;&gt;
       &lt;xsl:copy&gt;
           &lt;xsl:apply-templates select=&quot;@* | node()&quot;/&gt;
       &lt;/xsl:copy&gt;
   &lt;/xsl:template&gt;
</pre>

        <p>
          The default behavior can be overridden by specifying the option
          -xslt_plugin_dir to reconfig_glidein and reconfig_frontend tools.
        </p>
        <pre>
<b>prompt$</b> reconfig_glidein -xslt_plugin_dir &lt;xslt directory&gt; [...]
<b>prompt$</b> reconfig_frontend -xslt_plugin_dir &lt;xslt directory&gt; [...]
</pre>
      </div>

      <div id="sitecollector">
        <h3 class="western">
          Glidein's Startd Advertising to Site HTCondor-CE Collector
        </h3>
        <p>
          You can make glidein's HTCondor daemons advertise to site's local
          collector. There is no Glideinwms configuration that enable this and
          all the changes are on the site side.
        </p>

        <ol>
          <li>
            <b>Give glidein write access to the site collector</b><br />
            This is done by adding glidein's DN to gridmapfile of the site
            collector
          </li>
          <li>
            <b>Set site collector info in the glidein's environment</b><br />
            Set the CONDORCE_COLLECTOR_HOST in the glidein's environment
            <pre>
CONDORCE_COLLECTOR_HOST=&lt;site-local HTCondorCE collector address&gt;</pre
            >
          </li>
        </ol>
      </div>

      <div>
        <a name="#reconfigure_hooks" />
        <h3 class="western">Running pre/post reconfigure hooks</h3>
        <p>You can put executable scipts in the</p>
        <pre>/etc/gwms-factory/hooks.reconfig.pre/</pre>
        or the
        <pre>/etc/gwms-factory/hooks.reconfig.pre/</pre>
        directories. These scripts will be executed every time you reconfigure
        the factory. The
        <pre>.pre</pre>
        scripts will be executed before the reconfiguration process begins. The
        <pre>.post</pre>
        will be executed after the reconfigurations has been done. Scripts will
        be executed in
        <pre>/var/lib/gwms-factory/work-dir</pre>
        as user
        <pre>gfactory</pre>
        . Only executable scripts will be executed.
      </div>

      <div class="footer">
        Banner image by
        <a href="http://www.flickr.com/people/leafwarbler/">Madhusudan Katti</a>
        used under Creative Commons license.<br />
        Original Home URL:
        <a href="https://glideinwms.fnal.gov">https://glideinwms.fnal.gov</a>.
        GlideinWMS email support: glideinwms-support at fnal.gov
      </div>
    </div>
  </body>
</html>
