<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <meta http-equiv="CONTENT-TYPE" content="text/html; charset=UTF-8">
  <title>glideinWMS - Factory</title>
  <meta name="CREATED" content="0;0">
  <meta name="CHANGED" content="20100521;20081031;14115200">    
  <link rel="stylesheet" type="text/css" href="../common/glideinWMS.css" media="screen, projection" />
</head>

<body lang="en-US" dir="ltr">
    <h1>
        <a href="index.html">GlideinWMS</a>
	<span>The Glidein-based Workflow Management System</span>
    </h1>
    <ul class="breadcrumbs">
	<li> <a href="../index.html">Home</a></li>
	<li> <a href="./index.html">WMS Factory</a></li>
        <li>Configuration</li>
    </ul>
    <div class="clear" />
    <div class="leftmenu">
        <ul class="components">
	        <li> <a href="../index.html">Home</a></li>
	        <li> <a href="../download.html">Download</a></li>
	        <li> <a href="../frontend/index.html">Glidein Frontend</a></li>
                <li> <a href="../corral.html">Corral Frontend</a></li>
	        <li> <a href="../factory/index.html">WMS Factory</a></li>
	        <li> <a href="../components/index.html" >Components</a></li>
                <li> <a href="../recipes/index.html">Recipes</a></li>
	        <li> <a href="../components/faq.html" class="last">FAQ</a></li>
        </ul>
        <div class="search">
            <div id="cse-search-form" style="width: 100%;">Loading</div>
            <script src="http://www.google.com/jsapi" type="text/javascript"></script>
            <script src="../common/glidein.js" type="text/javascript"></script>
            <script type="text/javascript">
            google.load('search', '1', {language : 'en', style : google.loader.themes.MINIMALIST});
            google.setOnLoadCallback(onLoad);
            </script>
        </div>
    </div>
    <div id="searchcontent"><h2>Search Results</h2><div id="cse"></div> </div>
    <div class="content">
    <div class="heading">
    <img align="right" width="280px" border="0px"
        src="../images/simple_diagram.png" usemap="#rightimage">
    <map name="rightimage">
        <area shape="rect" coords="90,3,177,60" href="../frontend/index.html" />
        <area shape="rect" coords="5,88,118,146" href="../components/collector_install.html" />
        <area shape="rect" coords="134,88,275,146" href="../factory/index.html" />
        <area shape="rect" coords="189,3,274,60" target="_blank" href="../corral.html" />
    </map>

    <h2>WMS Factory</h2>
	<ul class="subcomponents">
	     <li> <a href="./index.html">Overview</a></li>
         <li> <a href="./install.html">Install</a></li>
	     <li> Configuration</li>
	     <li> <a href="./design.html">Design</a></li>
	     <li> <a href="./monitoring.html">Monitoring</a></li>
	     <li class="last"> <a href="./troubleshooting.html">Troubleshooting</a></li>
	</ul>
        <h3>Configuration</h3>
	</div>
<div class="jump">
<u>Jump to:</u>
<ol>
        <LI><A HREF="#example_configuration">Example Configuration</A>
        <LI><A HREF="#args">Configuration File</A>
        <li><a href="#glexec">glExec</a> </li>
        <li><a href="#private_net">Private Networks</a> </li>
        <li><a href="#security">Security</a> </li>
        <li><a href="#tcp">TCP Updates</a> </li>
        <li><a href="#custom_code">Adding custom files/scripts to the glideins</a> </li>
        <li><a href="#multicol">Multiple Collectors</a> </li>
        <li><a href="#tarballs">Multiple HTCondor Tarballs</a> </li>
        <li><a href="#xsltplugins">XSLT Plugins to extend configuration</a> </li>
</ol>
</div>
<div class="related">
Related Links: <br/>
<ul>
        <LI><A HREF="./custom_scripts.html">Custom Scripts</A></li>
        <LI><A HREF="./custom_vars.html">Custom Variables</A></li>
        <LI><A HREF="../components/tools.html">Tools</A></li>
</ul>
</div>
<div class="section">
<a name="example_configuration"></a><h2>Example Configuration</h2>
Below is an example factory configuration xml file.  Click on any piece
for a more detailed description.
<div class="config">
<a href="#glidein">&lt;glidein advertise_delay="5" factory_name="factory-dstrain" glidein_name="v2_4" loop_delay="60" restart_attempts="3" restart_interval="1800" schedd_name="schedd glideins1@submit.fnal.gov,schedd_glideins2@submit.fnal.gov" factory_collector="submit.fnal.gov:9618" entry_parallel_workers="0"&gt;</a><br/>
<blockquote>
    <a href="#">&lt;log_retention &gt;</a><br/>
    <blockquote>
        <a href="#">&lt;condor_logs max_days="14.0" max_mbytes="100.0" min_days="3.0" /&gt;</a><br/>
        <a href="#">&lt;job_logs max_days="7.0" max_mbytes="100.0" min_days="3.0" /&gt;</a><br/>
        <a href="#">&lt;process_logs &gt;</a><br/>
        <blockquote>
            <a href="#process_logs">&lt;process_log extension="info" max_days="7.0" max_mbytes="100.0" min_days="3.0" msg_types="INFO" backup_count="5" compression="gz" /&gt;</a><br/>
            <a href="#process_logs">&lt;process_log extension="debug" max_days="7.0" max_mbytes="100.0" min_days="3.0" msg_types="DEBUG,ERR,WARN" backup_count="5" /&gt;</a><br/>
        </blockquote>
        <a href="#">&lt;/process_logs &gt;</a><br/>
        <a href="#">&lt;summary_logs max_days="31.0" max_mbytes="100.0" min_days="3.0" /&gt;</a><br/>
    </blockquote>
    <a href="#">&lt;/log_retention &gt;</a><br/>
    <a href="#monitor">&lt;monitor base_dir="/var/www/html/glidefactory/monitor" flot_dir="/opt/javascriptrrd-0.6.3/flot" javascriptRRD_dir="/opt/javascriptrrd-0.6.3/src/lib" jquery_dir="/opt/javascriptrrd-0.6.3/flot" /&gt;</a><br/>
    <a href="#monitor_footer">&lt;monitor_footer display_txt="Legal Disclaimer" href_link="/site/disclaimer.html"  /&gt;</a><br/>
    <a href="#security">&lt;security key_length="2048" pub_key="RSA" reuse_oldkey_onstartup_gracetime="900" remove_old_cred_freq="24" remove_old_cred_age="30"/&gt;</a><br/>
    <blockquote>
        <a href="#security">&lt;frontends &gt;</a><br/>
        <blockquote>
        <a href="#security_frontend">&lt;frontend name="vofrontend" identity="vofrontend@vofrontend.fnal.gov" &gt;</a><br/>
            <blockquote>
                <a href="#security_class">&lt;security_classes &gt;</a><br/>
                <blockquote>
                    <a href="#security_class">&lt;security_class name="frontend" username="frontend1" /&gt;</a><br/>
                </blockquote>
                <a href="#security_class">&lt;/security_classes &gt;</a><br/>
            </blockquote>
            <a href="#security_frontend">&lt;/frontend &gt;</a><br/>
        </blockquote>
        <a href="#security_frontend">&lt;/frontends &gt;</a><br/>
    </blockquote>
    <a href="#security">&lt;/security &gt;</a><br/>
    <a href="#stage">&lt;stage base_dir="/var/www/html/glidefactory/stage" use_symlink="True" web_base_url="http://factory.fnal.gov:9000/glidefactory/stage"/&gt;</a><br/>
    <a href="#submit">&lt;submit base_client_log_dir="/opt/clientlogs/clients/logs" base_client_proxies_dir="/opt/clientlogs/clients/proxies" base_dir="/opt/wmsfactory/" base_log_dir="/opt/wmsfactory/logs" /&gt;</a><br/>
    <a href="#attrs">&lt;attrs&gt;</a><br/>
    <blockquote>
        <a href="#attrs">&lt;attr name="CONDOR_VERSION" const="True" glidein_publish="False" job_publish="False" parameter="True" publish="False" type="string" value="default" /&gt;</a><br/>
        <a href="#attrs">&lt;attr name="GCB_ORDER" const="True" glidein_publish="True" job_publish="False" parameter="True" publish="True" type="string" value="NONE" /&gt;</a><br/>
        <a href="#attrs">&lt;attr name="GLEXEC_JOB" const="True" glidein_publish="False" job_publish="False" parameter="True" publish="True" type="string" value="True" /&gt;</a><br/>
        <a href="#attrs">&lt;attr name="USE_CCB" const="True" glidein_publish="True" job_publish="False" parameter="True" publish="True" type="string" value="False" /&gt;</a><br/>
        <a href="#attrs">&lt;attr name="USE_MATCH_AUTH" const="False" glidein_publish="False" job_publish="False" parameter="True" publish="True" type="string" value="True" /&gt;</a><br/>
    </blockquote>
    <a href="#attrs">&lt;/attrs&gt;</a><br/>
    <a href="#entry">&lt;entries&gt;</a><br/>
    <blockquote>
        <a href="#entry">&lt;entry name="EXAMPLE_ENTRY" enabled="True" auth_method="grid_proxy" trust_domain="OSG" gatekeeper="gatewayname.fnal.gov/jobmanager-condor" gridtype="gt2" rsl="(queue=default)(jobtype=single)" schedd_name="wmscollector.fnal.gov" verbosity="std" work_dir="OSG"&gt;</a><br/>
        <blockquote>
            <a href="#config">&lt;config&gt;</a><br/>
            <blockquote>
                <a href="#config">&lt;max_jobs&gt;</a><br/>
                <blockquote>
                    <a href="#config">&lt;per_entry held="1000" idle="2000" glideins="10000"/&gt;</a><br/>
                    <a href="#config">&lt;default_per_frontend held="50" idle="100" glideins="5000"/&gt;</a><br/>
                    <a href="#config">&lt;per_frontends&gt;</a><br/>
                      <blockquote>
                        <a href="#config">&lt;per_frontend name="FRONTEND:SECURITY_CLASS" held="50" idle="100" glideins="5000"/&gt;</a><br/>
                      </blockquote>
                    <a href="#config">&lt;/per_frontends&gt;</a><br/>
                </blockquote>
                <a href="#config">&lt;/max_jobs&gt;</a><br/>
                <a href="#config">&lt;release max_per_cycle="20" sleep="0.2"/&gt;</a><br/>
                <a href="#config">&lt;remove max_per_cycle="5" sleep="0.2"/&gt;</a><br/>
                <a href="#config">&lt;submit cluster_size="10" max_per_cycle="100" sleep="0.2" slots_layout="partitionable"&gt;</a><br/>
                    <blockquote>
                    <a href="#config">&lt;submit_attrs&gt;</a><br/>
                        <blockquote>
                        <a href="#config">&lt;submit_attr name="RequestMemory" value="2000"&gt;</a><br/>
                        </blockquote>
                    <a href="#config">&lt;submit_attrs/&gt;</a><br/>
                    </blockquote>
                <a href="#config">&lt;/submit&gt;</a><br/>
            </blockquote>
            <a href="#">&lt;/config&gt;</a><br/>
            <a href="#allow_frontend">&lt;allow_frontends /&gt;</a><br/>
            <a href="#attrs">&lt;attrs&gt;</a><br/>
            <blockquote>
                <a href="#entry_attrs">&lt;attr name="CONDOR_ARCH" const="True" glidein_publish="False" job_publish="False" parameter="True" publish="False" type="string" value="default"/&gt;</a><br/>
                <a href="#entry_attrs">&lt;attr name="CONDOR_OS" const="True" glidein_publish="False" job_publish="False" parameter="True" publish="False" type="string" value="default" /&gt;</a><br/>
                <a href="#entry_attrs">&lt;attr name="GLEXEC_BIN" const="True" glidein_publish="False" job_publish="False" parameter="True" publish="True" type="string" value="NONE"/&gt;</a><br/>
                <a href="#entry_attrs">&lt;attr name="GLIDEIN_Site" const="True" glidein_publish="True" job_publish="True" parameter="True" publish="True" type="string" value="FNAL_EXAMPLE_SITE"/&gt;</a><br/>
                <a href="#entry_attrs">&lt;attr name="GLIDEIN_CPUS" const="True" glidein_publish="True" job_publish="True" parameter="True" publish="True" type="string" value="1"/&gt;</a><br/>
                <a href="#entry_attrs">&lt;attr /&gt;</a><br/>
            </blockquote>
            <a href="#entry_attrs">&lt;/attrs&gt;</a><br/>
            <a href="#monitorgroups">&lt;monitorgroups/&gt;</a><br/>
            <a href="#custom_code">&lt;files/&gt;</a><br/>
            <a href="#infosys">&lt;infosys_refs /&gt;</a><br/>
        </blockquote>
        <a href="#entry">&lt;/entry&gt;</a><br/>
    </blockquote>
    <a href="#entry">&lt;/entries&gt;</a><br/>
    <a href="#files">&lt;files&gt;</a><br/>
    <blockquote>
      <a href="#files">&lt;file absfname="/usr/conf/sethome.source" after_entry="False" const="True" executable="False" untar="False" wrapper="True" /&gt;</a><br/>
    </blockquote>
    <a href="#files">&lt;/files&gt;</a><br/>     
    <a href="#condor_tarball">&lt;condor_tarballs&gt;</a><br/>
    <blockquote>
        <a href="#condor_tarball">&lt;condor_tarball arch="default" base_dir="/opt/wmscollector/" os="default" tar_file="/var/www/html/glidefactory/stage/glidein_v2_4/condor_bin_default-default-default.a83ePm.tgz" version="default"/&gt;</a><br/>
    </blockquote>
    <a href="#condor_tarball">&lt;/condor_tarballs&gt;</a><br/>
    <a href="#factmoncollector">&lt;monitoring_colectors&gt;</a><br/>
    <blockquote>
        <a href="#factmoncollector">&lt;monitoring_colector DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector.fnal.gov" node="factmoncollector.fnal.gov" secondary="False" group="default" /&gt;</a><br/>
        <a href="#factmoncollector">&lt;monitoring_colector DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector.fnal.gov" node="factmoncollector.fnal.gov:9620-9819" secondary="True" group="default" /&gt;</a><br/>
        <a href="#factmoncollector">&lt;monitoring_colector DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector2.fnal.gov" node="factmoncollector2.fnal.gov" secondary="False" group="ha" /&gt;</a><br/>
        <a href="#factmoncollector">&lt;monitoring_colector DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector2.fnal.gov" node="factmoncollector2.fnal.gov:9620-9919" secondary="True" group="ha" /&gt;</a><br/>
    </blockquote>
    <a href="#factmoncollector">&lt;/monitoring_colectors&gt;</a><br/>
</blockquote>
<a href="#glidein">&lt;/glidein&gt;</a><br/>
</div>


<div class="section">
 

<H2 CLASS="western">
<A NAME="args"></A>The configuration file</H2>

<P>
    The configuration file is a XML document.
    It contains both global arguments as well as configuration specific 
    to each entry point.  At least one entry point must be specified in the
    configuration file.

</p>
<p>
    The tags of the XML configuration file are described below.
    Each is given a designation:
    <uL>
        <li><b>Required</b> You must change or examine this in order for the factory to function correctly.</li>
        <li><b>Recommended</b> The installer provides a good default, but you should examine this attribute to make sure it is correct for your installation.</li>
        <li><b>Optional</b> The installer-provided default is likely correct for your installation.  Change this only if your particular configuration requires special treatment or fine-tuning.</li>
    </ul>
</p>
</div>

<div class="section">
<H3 CLASS="western">
<A NAME="args_global"></A>Global arguments</H3>
<P>Global arguments are common to  all entry points but can be overridden by 
individual entry point configuration.
<UL>

    <LI>
        <a name="glidein" />
        <div class="xml">
        &lt;glidein ... &gt;
        </div>
    <p><b>Required</b> The main tag of the Factory configuration.  See below for the 
        parameters for this tag:
    <ul>
    <li>
    <p>
        <div class="xml">
        &lt;glidein glidein_name=&quot;<I>your name</I>&quot;&gt;
        </div>
        <b>Required</b> The name
    of the configuration. It will be used to advertise the entry points,
    will be defined as HTCondor glidein attribute <tt>GLIDEIN_Name</tt>,
    and is used also to create the directory names.
    Choose a short name that describes the set of Grid resources 
    it represents and append a version number (like 
    <tt>&quot;fnalcms_1&quot;</tt>).
    Starting with v2.0 of glideinWMS, you can use the 
    <A HREF="index.html#reconfig_entry">factory reconfig tool </A>
    to make changes to the factory configuration. You
    will only need new configuration for the factories during major
    upgrade. For more details refer the 
    <A HREF="index.html#management">Glidein Factory management section</A>
    </li><LI>
        <div class="xml">
        &lt;glidein factory_name=&quot;<I>your name</I>&quot;&gt;
        </div>
    <b>Recommended</b>  Changing this value from the name of the 
       machine allows you to move the factory without disrupting the system.
    </li><LI>
        <div class="xml">
        &lt;glidein
        schedd_name=&quot;<I>schedd name[,schedd name]*</I>&quot;&gt;
        </div>
    <b>Recommended</b> If you want to use multiple HTCondor schedds or you don't like the
    default name, you definitely need to set this. If you specify more
    than a single schedd, the various entries will be equally spread
    among all the listed schedds.  Possible values include (but are not limited to): <br/>
    <tt>&quot;myschedd@mymachine.mydomain&quot;</tt><br/>
    <tt>&quot;myschedd_g1@mymachine.mydomain,myschedd_g2@mymachine.mydomain,myschedd_g3@mymachine.mydomain&quot;</tt><br/>
    </li><LI>
        <div class="xml">
        &lt;glidein
        factory_collector=&quot;<I>collector_name:port</I>&quot;&gt;
        </div>
    <b>Recommended</b> You can have a dedicated collector serving just for message passing with the Frontend.<br>
    If this is not set, the default collector will be used, which also happens to be used to advertise the
    internal Condor-G classads. That's undersirable both for security reasons, 
    and also because frequent Condor-G updates tend to load it heavily.

    </li>
    <LI>
        <div class="xml">
        &lt;glidein loop_delay=&quot;<I>seconds</I>&quot;
        advertise_delay=&quot;<I>nr</I>&quot; &gt;
        </div>
        <b>Optional</b> Defines how active the glidein factory should be.
        The glidein factory works in polling mode.
        <tt><B>loop_delay</B></tt> defines how much time should pass between each polling loop, with
    the collector being updated every <tt><B>advertise_delay</B></tt> loops.
<LI>
        <div class="xml">
        &lt;glidein restart_attempts=&quot;<I>nr</I>&quot;
        restart_interval=&quot;<I>seconds</I>&quot; &gt;
        </div>
    <b>Optional</b> Defines how many times restart_attempts should be
    applied within restart_interval seconds for an entry if the entry
    crashes.
    </li>
    <LI>
    <div class="xml">
        &lt;glidein advertise_with_tcp=&quot;<I>True|False</I>&quot; &gt;
    </div>
        <b>Optional</b> Defines if the factory should use TCP to advertise its classads.
    </li>
    <LI>
    <div class="xml">
        &lt;glidein advertise_with_multiple=&quot;<I>True|False</I>&quot; &gt;
    </div>
        <b>Optional</b> Defines if the factory should use -multiple to advertise its classads (requires HTCondor 7.5.4+).  
    </li>
    <LI>
    <div class="xml">
        &lt;glidein advertise_pilot_accounting=&quot;<I>True|False</I>&quot; &gt;
    </div>
        <b>Optional</b> Defines if the factory should condor_qedit pilot jobs after they finishes to add accounting information. A classad MONITOR_INFO will be added and jobs will be left in the Complete state for 12 hours.
    </li>
    </ul>
    </li>
    <LI>
        <a name="process_logs" />
        <div class="xml">
            &lt;glidein&gt;&lt;log_retention&gt;&lt;process_logs&gt;&lt;process_log 
            max_days=&quot;<I>max days</I>&quot;
            min_days=&quot;<I>min days</I>&quot;
            max_bytes=&quot;<I>max bytes</I>&quot;
            type=&quot;<I>INFO</I>&quot;
            backup_count=&quot;<I>backup count</I>&quot;
            compression=&quot;<I>gz</I>&quot;/&gt;
        </div>
    <p>
    The admin can configure one or more logs with any combination of following log message types: 
    <ul>
    <li>INFO:  Informational messages about the state of the system. </li>
    <li>DEBUG:  Debug message. These are additional informational messages that describe code execution in detail.</li>
    <li>ERR:  Error messages. These may include tracebacks. </li>
    <li>WARN: Warning messages. These warn of conditions that were found that don't necessarily cause abnormal execution.</li>
    <li>ADMIN: This is a special setting only applicable to factory logs (and not entry logs) that contains admin messages, such as reconfig comments.  This will create a new log called factoryadmin.extension.log.  Currently, it cannot be combined with other message types.</li>
    </ul>
    The extension is added to the log name to create separate logs.
    <br><br>
    <b>Log Retention and Rotation Policy:</b>
    <br><br>
    Log files are rotated based on a time and size of the log files as follows:
    <ul>
        <li>If the log file size reaches <i>max_bytes</i> it will be rotated (NOTE: the value will be truncated and 0 means no rotation).</li>
        <li>If the log file size is less that <i>max_bytes</i> but the file is older than max_days it will be rotated.</li>
        <li><i>min_days</i> is not used and is there for backwards compatibility.</li>
        <li>Rotated files may be compressed. Supported compressions are Gzip "gz" and Zip "zip". Default is no compression (empty string).</li> 
        <li>After rotation, recent number of <i>backup_count</i> files will be kept and older ones are deleted. Defaults to 5.</li>
    </ul>

    </p>
    </li>
    <LI>
        <a name="condor_tarball" />
        <div class="xml">
            &lt;glidein&gt;&lt;condor_tarballs&gt;&lt;condor_tarball
            os=&quot;<i>os</I>&quot;

            arch=&quot;<I>arch</I>&quot;
            base_dir=&quot;<I>directory</I>&quot;
            version=&quot;<I>condor version</I>&quot;/&gt;
        </div>
    <p><b>Required</b> Where to find the HTCondor binaries.
    You can list as many as you need,
    but at least one is required. This lets you configure glideins for
    different sites to use different version of HTCondor binaries based on
    architecture, os of the worker nodes that could be found on the site.<br/>
    It is recommended to have one default entry with
        <b>os=&quot;default&quot; arch=&quot;default&quot;
        version=&quot;default&quot;</b>.<br/>
        To configure multiple tarballs, os, arch and version accept a comma
        separated list. See <a href="#tarballs">multiple tarballs</a> for more
        detailed instructions on supporting tarballs for multiple architectures.
    </p>
    <LI>
        <a name="submit" />
        <div class="xml">
        &lt;glidein&gt;&lt;submit base_dir=&quot;<I>directory</I>&quot;
        base_log_dir=&quot;<I>log directory</I>&quot;
        base_client_log_dir=&quot;<i>client log directory</I>&quot;

        base_client_proxies_dir=&quot;<I>directory where proxies will be stored</I>&quot;/&gt;
        </div>
    <p><b>Recommended</b> Where to create the glidein submit directory. 
    The default is the user home
    directory. Log directories can be configured independent of the base
    directory using options mentioned above.</P>
    <LI>
        <a name="stage" />
        <div class="xml">
        &lt;glidein&gt;&lt;stage base_dir=&quot;<I>web dir</I>&quot;

        web_base_dir=&quot;<I>URL</I>&quot;/&gt;
        </div>
    <p><b>Recommended</b> These two define where the Web server directories are located.
    <BR/>The defaults are reasonable, but you may have different needs. 
    </P>
    <LI>
        <a name="monitor" />
        <div class="xml">
        &lt;glidein&gt;&lt;monitor base_dir=&quot;<I>web dir</I>&quot; 
        javascriptRRD_dir=&quot;<I>web dir</I>&quot; 
        flot_dir=&quot;<I>web dir</I>&quot; 
        jquery_dir=&quot;<I>web dir</I>>&quot; &gt;

        </div>
    <p><b>Recommended</b> The <STRONG>base_dir</STRONG> defines where the monitoring web are
    is.<BR/>The other entries point to where javascriptRRD, Flot and
    JQuery libraries are.</P>
    <LI>
        <a name="monitor_footer" />
        <div class="xml">
        &lt;glidein&gt;&lt;monitor_footer display_txt=&quot;<I>Legal Disclaimer</I>&quot; 
        href_link=&quot;<I>/site/disclaimer.html</I>&quot; /&gt;
        </div>
    <p>OPTIONAL:  If the display text and link are configured, the monitoring pages will display the text/link at the 
    bottom of the page.</P>
    <LI>
        <a name="security" />
        <div class="xml">
        &lt;glidein&gt;&lt;security 
        reuse_oldkey_onstartup_gracetime=&quot;<I>900</I>&quot;
        remove_old_cred_age=&quot;<I>30</I>&quot;
        remove_old_cred_freq=&quot;<I>24</I>&quot;
        pub_key=&quot;<I>RSA</I>&quot;/&gt;

        </div>
        <p>
        The factory can remove old credential files saved on disk.  You can set the min age (in days) the credential needs to be 
        before it can be deleted and the frequency (in hours) to perform the removal.  If you set the frequency to less than zero,
        the clean up functionality is disabled.
        </p>
    </li>
    <LI>
        <a name="security_frontend" />
        <div class="xml">
        &lt;glidein&gt;&lt;security&gt;&lt;frontends&gt;&lt;frontend
        name=&quot;<I>FrontendName</I>&quot;
        identity=&quot;username_usedby_factory@factory_hostname&quot;
        /&gt;</div>

    <p><b>Recommended</b> (Required for privilege separation) 
    This configures a frontend. 
    <b>Frontend on the frontend hosting machine
    should have same name as mentioned in the 'name'. </b>Identity tells the
    factory the username under which the factory should map the given
    frontend to.
    <b>If this does not match the frontend configuration, 
    the factory will drop all requested glideins.</b>
    </P>
    <LI>
        <a name="security_class" />
        <div class="xml">
        &lt;glidein&gt;&lt;security&gt;&lt;frontends&gt;&lt;frontend&gt;&lt;security_classes&gt;&lt;security_class
        name=&quot;<I>frontend</I>&quot;
        username=&quot;<I>>username_usedby_factory</I>&quot;/&gt;
        </div>

    <p><b>Required</b> Tells the class and user name the factory uses for this frontend.<br/></p>
    <ul>
        <div class="xml">-  <b>&lt;security_class name=&quot;frontend&quot; username=&quot;<I>username_usedby_factory</I>&quot;/&gt;</b></div>

       </ul> 
    </li>
    <LI>
        <a name="attrs" />
        <div class="xml">
        &lt;glidein&gt;&lt;attrs&gt;&lt;attr 
        name=&quot;<I>attr name</I>&quot;
        value=&quot;<I>value</I>&quot;
        const=&quot;True&quot;

        parameter=&quot;True&quot; publish=&quot;True&quot;
        glidein_publish=&quot;True&quot; 
        comment=&quot;<I>comment</I>&quot; /&gt;
        </div>

    <p>Attributes you want to publish that 
    effect all the factory entries</p>
    <p>To set Attributes specific to an entry point, set them in
    /glidein/entries/entry/attrs section.</p>
    <p>Table below describes
    the &lt;attrs ... &gt; tag. 
    </P>
    <table class="requirements">
        <tr class="head">
            <td> <P><B>Attribute Name</B></P> </TD>

            <TD> <P><B>Attribute Description</B></P> </TD>
        </TR>
        <TR>
            <TD> <P><b>name</b></P> </TD>
            <TD>
                <P>Name of the attribute</P>

            </TD>
        </TR>
        <TR>
            <TD> <P><b>value</b></P> </TD>
            <TD> <P>Value of the attribute</P> </TD>
        </TR>

        <TR>
            <TD> <P><b>const</b></P> </TD>
            <TD>
                <P>If this attribute is a constant so that 
                Glidein Frontend can not change it. If set to const, 
                the attribute will be available in
                the constants file created in the staging area. 
                </P>
            </TD>
        </TR>
        <TR>

            <TD> <P><b>parameter</b></P> </TD>
            <TD>
                <P>Set True if the attribute should be passed 
                as a parameter.  Always set this to True 
                unless you know what you are doing.</P>
            </TD>
        </TR>
        <TR>
            <TD> <P><b>publish</b></P> </TD>

            <TD>
                <P>If set to True, 
                the attribute will be published in Factory's
                classad</P>
            </TD>
        </TR>
        <TR>
            <TD> <P><b>glidein_publish</b></P> </TD>
            <TD>

                <P>If set to True, the attribute will be 
                available in the condor_startd's classad (and the glidein condor configuration). 
                Used only if parameter is True.</P>
            </TD>
        </TR>
        <TR>
            <TD> <P><b>job_publish</b></P> </TD>
            <TD>
                <P>If set to True, the attribute will be 
                available in the user job's environment. 
                Used only if parameter is True.</P>

            </TD>
        </TR>
        <TR>
            <TD> <P><b>comment</b></P> </TD>
            <TD>
                <P>You can specify description 
                of the attribute here.</P>
            </TD>

        </TR>
        <TR>
            <TD> <P><b>type</b></P> </TD>
            <TD>
                <P>Type of the attribute. 
                Supported types are 'int', 'string' and
                'expr'. Typeexpr is equivalent to 
                condor constant/expression in
                condor_vars.lst</P>
            </TD>
        </TR>

    </TABLE>
    <P><BR>These are used by the <A HREF="../frontend/index.html#match_expr">VO
    frontend matchmaking</A> and job matchmaking.<BR><BR>Example
    attributes are:</P>
    <PRE>&lt;attrs&gt;
 &lt;attr name=&quot;VOpilot&quot; value=&quot;CMS&quot; 
    publish=&quot;True&quot; parameter=&quot;True&quot; const=&quot;True&quot; glidein_publish=&quot;True&quot; comment=&ldquo;A test attribute&rdquo;/&gt;

 &lt;attr name=&quot;CondorVersion&quot; value=&quot;v6.9.1&quot; 
    publish=&quot;True&quot; parameter=&quot;True&quot; const=&quot;True&quot; glidein_publish=&quot;True&quot;/&gt;

&lt;/attrs&gt;</PRE>
    </p><p>A list of all the
    attributes can be found on the 
    <A HREF="custom_vars.html"> dedicated configuration variables page </A>. 
    </P>
    </LI>
    <LI>
        <a name="custom_code_summary" />
        <div class="xml">
        &lt;glidein&gt;&lt;files&gt;&lt;file 
        absfname=&quot;<I>script name</I>&quot;
        executable=&quot;<I>True</I>&quot;
        period=&quot;period in seconds&quot;
        prefix=&quot;cron prefix&quot; 
        after_entry=&quot;True&quot; 
        comment=&quot;<I>comment</I>&quot; /&gt;
        </div>

    <p>Custom files configuration is discussed in the <A HREF="#custom_code">Adding custom files/scripts to the glideins</A> paragraph in the advanced section below.</p>
    <p>Custom files, how to write and use them, are discussed in the <A HREF="custom_scripts.html">custom scripts page</A>.</p>
    </LI> 
</UL>
<P><BR>The other arguments are for advanced admins only, and are
explained in a <A HREF="#advanced">dedicated section</A>.</P>
</div>

<div class="section">
<H3 CLASS="western"><A NAME="args_entry"></A>Entry point arguments</H3>
<p>
The following are arguments that are specific to each entry point.  They 
override the global arguments if present.
</p>
<UL>
    <LI>
        <a name="entry" />
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;&gt;
        </div>
    <P><b>Required</b> Each entry point will have its own root tag with parameters:</p>
    <ul>
    <LI>
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;&gt;
        </div>
    <b>Required</b> Specify an easy to remember name that will identify this entry for display purposes and for specifying using command line tools.
    </li>
    <LI>
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot; auth_method=&quot;<I>grid_proxy</I>&quot;&gt;
        </div>
    <b>Required</b> The authentication method this entry supports.  It is advertised to the Frontends to show which credentials are required for 
    submission.  Valid values: grid_proxy, voms_proxy, key_pair, cert_pair, username_password, vm_type, vm_id, project_id<br/>
    Multiple authentication methods may be needed and there may be reqirements on the authentication method depending on the type of entry. 
    E.g. ec2 requires a credential pair (key_pair, cert_pair, username_password) and the VM id and type. BOSCO requires a key_pair and a grid_proxy.
    A TeraGrid site requires a project id from the Corral Frontend (not supported by VO Frontends).  The authentication 
    method then must be &lt;entry auth_method="grid_proxy+project_id" &gt;. <br/>
    When multiple methods are needed these can be additional entry values: &lt;entry vm_type="vmtype" or vm_id="vmid" &gt; <br/>
    OR <br/>
    can be added to the authentication method so the Frontend is required to pass them: &lt;entry auth_method="key_pair+vm_id+vm_type" &gt; <br/>
    </li>
    <LI>
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot; trust_domain=&quot;<I>OSG</I>&quot;&gt;
        </div>
    <b>Required</b> The trust domain for the entry.  This is not interpreted by the Factory code, only used to show what credentials are valid.  For example,
    there may be two ec2-type entries for two different clouds with the authentication method of "key-pair".  This shows allows the Frontend to map a key pair
    to a particular cloud. Or in BOSCO you can use it to select the key to use with a specific cluster.
    </li>
    <LI>
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;
        gatekeeper=&quot;<I>gatekeeper</I>&quot;&gt;
        </div>
    <b>Required</b> The identifier of your Grid/BOSCO resource (like
    <tt>&quot;cmsitbsrv01.fnal.gov/jobmanager-condor&quot;</tt>). 
    BOSCO resources are USER@FQDN, e.g. <tt>cmsuser@cmscluster.fnal.gov</tt>.
    </li>
    <li>
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot; 
        rsl=&quot;<I>rsl</I>&quot;&gt;
        </div>
    Please check the Grid site documentation and/or ask the Grid
    site administrator for the proper rsl and queue name for the site.<br/>
    (example: '<tt>(condorsubmit=(universe vanilla)(requirements \&quot;(ISMINOSAFS=?=True)\&quot;))</tt>'). <br/>
    NOTE:  If the auth_method contains "+project_id" for a TeraGrid entry, the string "(project=TG_PROJECT_ID)" 
    will be added by the Factory and populated with the project id passed in the Corral request.  Only Corral Frontends can use
    these entries since we currently do not support a VO Frontend passing the project id.
    </li>
    <li>
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;

        gridtype=&quot;<I>grid type [default: gt2]</I>&quot;&gt;
        </div>
    <b>Optional</b> The default gt2 is for Globus v2 Gatekeepers. Other values are ec2, condor or one of the batch types supported by HTCondor: 
    batch pbs (for PBS and SLURM), batch lsf, batch sge, batch condor. 
    This tag can specify additional HTCondor Grid types.
    </li>
    <LI>
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;
        work_dir=&quot;<I>WN dir</I>&quot;&gt;
        </div>
    <b>Recommended</b> This argument defines where the glidein should run once
    on the worker node.
    <i>Note: Most OSG sites are known to crash if you use your
    starting directory to run. </i>  For those sites, it is good practice to
    specify <tt>&quot;HTCondor&quot;</tt> if they are
    running HTCondor as the underlying batch system, and
    <tt>&quot;OSG&quot;</tt>
    else.  On EGEE sites, &quot;.&quot; is usually fine.
    </li>
    <LI>
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;
        proxy_url=&quot;<I>Proxy URL</I>&quot;&gt;
        </div>
    <b>Recommended</b> If you have a Web cache you can use, you set it here (like
    <tt>&quot;cmsitbsquid002.fnal.gov:3128&quot;</tt>).
    On OSG resources, you can set it to <tt>&quot;OSG&quot;</tt>,
    and the default OSG squid will be used.
    If you cannot use any Web cache server,
    you can skip this argument (the default is not to
    use caching).  If defined, the user jobs will be able to use
    it as <tt>&quot;GLIDEIN_Proxy_URL&quot;</tt> environment variable.
    </li>
    <LI>
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;
        schedd_name=&quot;<I>schedd name</I>&quot;&gt;
        </div>
    <b>Optional</b> If you have an entry that needs a dedicated schedd,
    you can set it here (to something like
    <tt>&quot;myveryspecialschedd@mymachine.mydomain&quot;)</tt>
    </li>
    <LI>
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;

        enabled=&quot;<I>True/False</I>&quot;&gt;
        </div>
    <b>Optional</b> You can define an entry point even if you do not plan to use it right
    away.  The entry point directory will be created independently of
    the <tt><B>enabled</B></tt> flag, but will only
    be used by the glidein factory if it is set to
    <tt><B>True</B></tt>.
    (Defaults to <tt><B>True</B></tt>).
    </li>
    <LI>
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;
        verbosity=&quot;<I>std/fast/nodebug</I>&quot;&gt;
        </div>
    <b>Optional</b> Specify the verbosity level and
    termination time in case of validation errors:
    <UL>
        <LI><b>std (default)</b> &ndash; reasonable
        verbosity (including the condor log files) and 20min sleep in case
        of error (to reduce the damage resulting from broken nodes)</li>
        <LI><b>fast</b> &ndash; same verbosity as std,
        but will only wait 2 mins before terminating in
        case of error (good for debugging)</li>
        <LI><b>nodebug</b> &ndash; very low verbosity,
        if you want to save on disk space</li>
    </UL>
    </li>
    </ul>
    </li>
    <li>
        <a name="config" />
        <div class="xml">
            &lt;glidein&gt;&lt;entries&gt;&lt;entry name=&quot;<I>entry name</I>&quot;&gt;<br/>
            &lt;config&gt;<br/>
            &lt;max_jobs&gt;<br/>
            &nbsp;&nbsp;&lt;per_entry held="1000" idle="2000" glideins="10000"/&gt;<br/>
            &nbsp;&nbsp;&lt;default_per_frontend held="50" idle="100" glideins="5000"/&gt;<br/>
            &nbsp;&nbsp;&lt;per_frontends&gt;<br/>
            &nbsp;&nbsp;&nbsp;&nbsp;&lt;per_frontend name="FRONTEND:SECURITY_CLASS" held="50" idle="100" glideins="5000"/&gt;<br/>
            &nbsp;&nbsp;&lt;/per_frontends&gt;<br/>
            &lt;max_jobs/&gt;<br/>
            &lt;release max_per_cycle="20" sleep="0.2"/&gt;<br/>
            &lt;remove max_per_cycle="5" sleep="0.2"/&gt;<br/>
            &lt;submit cluster_size="10" max_per_cycle="100" sleep="0.2" slots_layout="partitionable"&gt;<br/>
            &nbsp;&nbsp;&lt;submit_attrs&gt;<br/>
            &nbsp;&nbsp;&nbsp;&nbsp;&lt;submit_attr name="RequestMemory" value="2000"/&gt;<br/>
            &nbsp;&nbsp;&lt;/submit_attrs&gt;<br/>
            &lt;/submit&gt;<br/>
            &lt;/config&gt;
        </div>
        <p>
        The config section controls the glidein policies for the entry.  <br/>
        <ul>
           <li>The max_jobs section limits the number of glidins held, idle, and total (including running).
             <ul>
                 <li>&lt;per_entry ... &gt; specifies the limits per entry.</li>
                 <li>&lt;default_per_frontend ... &gt; specifies default limits for each frontend-security class (for this entry).</li>
                 <li>&lt;per_frontend ... &gt; overrides the limits for a specific frontend-security class.</li>
             </ul>
           </li>
        <li>Release regulates how many glideins are released per cycle.</li>  
        <li>Remove regulates how many glideins are removed per cycle.</li>  
        <li>Submit limits how fast the glideins are submitted
           and controls the glideins type. Each main loop (cycle) the glideins are submitted using 
           multiple condor_submit commands
           <ul>
<!-- Attributes in the code
cluster_size, self.jobDescript.data['SubmitCluster'], self.gflFactoryConfig.max_cluster_size; 
max_per_cycle, jobDescript.data['MaxSubmitRate'], self.gflFactoryConfig.max_submits;
sleep, self.jobDescript.data['SubmitSleep'], self.gflFactoryConfig.submit_sleep -> 
-->
               <li>cluster_size limits how many glideins are submitted with
               one condor_submit command (if more glideins need to be submitted, multiple condor_submit invocations are used).</li>
               <li>sleep is the minimum wait between two condor_submit commands (actual time is longer).</li>
               <li>max_per_cycle limits how many glideins to submit every cycle</li>
               <li>slots_layout tells what kind of glideins the entry supports: 
           "fixed" number of slots; or "partitionable" slots, which  enables HTCondor's
           partionable/dynamic slots. The number of cores claimed by the glidein
           can be controlled by the GLIDEIN_CPUS variable.</li>
               <li>
               &lt;submit_attr ... &gt; specifies additional HTCondor attributes to
               add to the HTCondor submit file that the Factory uses to submit pilots
               to a site.  These attributes are only added when the 
               <a name="entry">gridtype</a> is "batch SOMETHING" (<a href="../recipes/batch.html">using BOSCO</a>) 
               or "condor".  The attributes are ignored
               for all other grid types.
               </li>
           </ul>
        </li>
        </p>
    </li>
        <LI>
        <a name="entry_attrs" />
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;&gt;&lt;attrs&gt;&lt;attr
        name=&quot;<I>attr name</I>&quot;

        value=&quot;<I>value</I>&quot;
        const=&quot;True&quot;
        parameter=&quot;True&quot; publish=&quot;True&quot;
        glidein_publish=&quot;True&quot;
        comment=&quot;<I>comment</I>&quot;/&gt;

        </div>
    <p>
    Attributes you want to publish into the HTCondor classad.
    These are used by the
    <A HREF="../frontend/index.html#match_expr">VO Frontend matchmaking</A>
    and job matchmaking.</p>
    <p>Example
    attributes are:</P>
    <PRE>
 &lt;attr name=&quot;HasMySoftware&quot; value=&quot;True&quot; publish=&quot;True&quot; parameter=&quot;
True&quot; const=&quot;True&quot; glidein_publish=&quot;True&quot; comment=&ldquo;My users cannot live without&rdquo;
/&gt;

 &lt;attr name=&quot;OS&quot; value=&quot;Linux&quot; publish=&quot;True&quot; parameter=&quot;True&quot;
 const=&quot;True&quot; glidein_publish=&quot;True&quot;/&gt;
 </PRE>
    Other pre-defined attributes are listed below:
    <ul> 
    <LI>

        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;&gt;&lt;attrs&gt;&lt;attr
        name=&quot;GLIDEIN_Site&quot;
        value=&quot;<I>value</I>&quot;
        const=&quot;True&quot;

        parameter=&quot;True&quot;
        publish=&quot;True&quot;/&gt;
        </div>
    <b>Recommended</b> This defines the glidein attribute <tt>GLIDEIN_Site</tt>,
    both for use of the Frontend and for the use of the job
    negotiation.  Logically defining a site is useful, so that you
    can change entry points but the user jobs do still known where they
    are running. If not specified, it defaults to the entry point name
    in the startd ClassAd. 
    </li>
    <li>
    <div class="xml">
    &lt;glidein&gt;&lt;entries&gt;&lt;entry 
    name=<I>entry name</I>&quot;&gt;&lt;attrs&gt;<br/>
    &nbsp;&nbsp;&lt;attr name=&quot;CONDOR_VERSION&quot;
    value=&quot;<I>os</I>&quot;

    type=&quot;string&quot;
    const=&quot;True&quot; parameter=&quot;True&quot;
    publish=&quot;False&quot; /&gt;<br/>

    &nbsp;&nbsp;&lt;attr name=&quot;CONDOR_ARCH&quot;
    value=&quot;<I>arch</I>&quot;
    type=&quot;string&quot;
    const=&quot;True&quot; parameter=&quot;True&quot;

    publish=&quot;False&quot;/&gt;<BR/>
    &nbsp;&nbsp;&lt;attr name=&quot;CONDOR_OS&quot;
    value=&quot;<I>version</I>&quot;
    type=&quot;string&quot;

    const=&quot;True&quot; parameter=&quot;True&quot; 
    publish=&quot;False&quot;/&gt;
    </div>
    <b>Recommended</b> Select a non-default HTCondor binary.<BR/>

    The entry will default to 
    <tt><B>CONDOR_OS=&quot;default&quot; CONDOR_ARCH=&quot;default&quot; 
    CONDOR_VERSION=&quot;default&quot;</B></tt>,
    if not otherwise defined. 

     <li>
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;&gt;&lt;attrs&gt;&lt;attr
        name=&quot;X509_CERT_DIR&quot;
        value=&quot;<I>value</I>&quot;
        const=&quot;True&quot;
        parameter=&quot;True&quot;
        glidein_publish=&quot;False&quot; 
        job_publish=&quot;True&quot;
        publish=&quot;True&quot;/&gt;
        </div>
        <b>Recommended for BOSCO resources</b> BOSCO resources normally have no OSG software installed, so it is safer to publish the location of the CA certificates because the job may not be able to find them otherwise.
     </li>
     <li>
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;&gt;&lt;attrs&gt;&lt;attr
        name=&quot;GLIDEIN_CPUS&quot;
        value=&quot;<I>value</I>&quot;
        const=&quot;True&quot;
        parameter=&quot;True&quot;
        publish=&quot;True&quot;/&gt;
        </div>
        <b>Recommended</b> Specifies how many CPUs (cores) to claim on the compute node<BR/>
        Valid values are 1..N and "auto" or "0" which means to use all cores by using HTCondor's
        core auto-detection.  The entry will default to 1 if not otherwise defined. 
    </li>
    </ul>
        <li>
        <a name="allow_frontend" />
        <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;&gt;
        &lt;allow_frontends&gt;
        &lt;allow_frontend name="vofrontend_name"
        security_class="security_class_name"/&gt;
        </div>
        <p>
        This argument allows you to create a whitelist of
        vo Frontends that can access this entry point.
        If this tag is blank or missing, it is assumed that
        all VO Frontends can submit glideins to this entry point.
        However, if any allow_frontend tags exist, the entry point
        will <b>only</b> allow those frontends to submit glideins.
        The name of the Frontend must match the name given in
        the security class above in the configuration.
        </p>
        <p>
        For each Frontend, you must tell it which security classes
        (e.g. proxies) can use the Frontend.  The Factory will
        only submit glideins on behalf of these security classes.
        If you want all security classes to be allowed, you can put
        "All" in this field.  Otherwise, it must match the security
        class configuration higher up in the xml.
        </p>
    </li>
    <li>
    <a name="infosys" />
    <div class="xml">
        &lt;glidein&gt;&lt;entries&gt;&lt;entry
        name=&quot;<I>entry name</I>&quot;&gt;
        &lt;infosys_refs&gt;&lt;infosys_ref ref="<i>filename</i>" server="<i>SERVER</i>" type="<i>RESS/BDII</i>"/&gt;
    </div>
    <p>
    This argument is placed here by the installers based on information from BDII/RESS.  This gives you
    information on where the server's information was retrieved from.  It can also be used to retrieve
    downtime information from RESS/BDII.
    </li>
</UL>
</div>

<div class="section">
<H2 CLASS="western"><A NAME="advanced"></A>Advanced topics</H2>
<P>While the above is enough for setting up a personal glidein pool
on the local area network, you will need to do more fine tuning when
deploying a larger one. In this section, the various advanced aspects
of glidein pools will be presented. 
</p>
</div>

<div class="section">
<H3 CLASS="western"><A NAME="glexec"></A>Integration with gLExec</H3>

<P>As you may have noticed, all of the glideins are submitted with
the same service proxy. While this has the advantage of simplifying
the architecture and improve both efficiency and VO control, it does
have a few problems:</P>
<UL>
    <LI><P STYLE="margin-bottom: 0in">All glidein scripts and HTCondor
    daemons, AND user jobs all run under the same Unix UID. So users can
    interfere with the glidein tasks, possibly hacking the
    system.&nbsp;<BR>Plus, when several glideins start on the same node
    (on multi processor/core machines), one user job can interfere with
    another user job. 
    </P>
    <LI><P>The real user is never authenticated against the Grid site
    authorization infrastructure. This makes it impossible for the sites
    to enforce their policies, nor can they analyze the usage of their
    resources; they see only glideins. This makes them very unfriendly
    toward the glidein based WMS. 
    </P>
</UL>
<P>To solve this problem, some Grid sites are deploying gLExec on the
worker nodes. gLExec is a service that will take the following:</P>
<UL>
    <LI>the user proxy, and </li>

    <LI>the desired command </li>
</UL>
    <p>
    It will contact the local authorization and mapping system, switch to
    the UID of the user (as opposed to the glidein UID), and execute
    the provided command as that UID. </p>
    <p>By using gLExec, a Glidein
    Factory can get rid of both of the above problems, and still keep
    all the advantages.</p>
    <p>To enable gLExec support, you need to
    specify:
    </p> 
    <div class="xml">
    &lt;glidein&gt;<BR/>

    &nbsp;<i>[&lt;entries&gt;&lt;entry&gt;]</i><BR/>
    &nbsp;&lt;files&gt;<BR/>
    &nbsp;&nbsp;&lt;file absfname=&quot;web_base/glexec_setup.sh>&quot;
    executable=&quot;True&quot;/&gt;<BR/>

    &nbsp;&lt;/files&gt;<BR/>
    &nbsp;&lt;attrs&gt;<BR/>
    &nbsp;&lt;attr name=&quot;GLEXEC_BIN&quot;
    value=&quot;<I>path to glexec</I>&quot; publish=&quot;False&quot;

    parameter=&quot;True&quot;/&gt;
    </div>
    <p>
    For most current gLExec installation this comes down to: 
    </p>
    <div class="xml">
    &lt;attr name=&quot;GLEXEC_BIN&quot;

    value=&quot;OSG&quot;
    publish=&quot;False&quot;
    parameter=&quot;True&quot;/&gt;
    </div>
    <P>

    More details about scripts in general can be found in the 
    <A HREF="#custom_code">&quot;custom code&quot;</A> section. 
    </P>
    <p>You will also need to properly
    configure the <B>shadow config files on the submit machine</B>, by
    adding the following to the condor_config: </p>
    <blockquote>
    GLEXEC_STARTER = True<BR/>
    GLEXEC = /bin/false 
    </blockquote>

<P>As of version 7.1.3 of HTCondor, a new, better glexec operation mode
is supported; in the old operation mode, condor_startd invoked
condor_starter through glexec. The result was that condor_starter was
running under the same UID as the user job, leaving it vulnerable to
attack from a malicious user. The new operating mode solves this by
having condor_starter run the user jobs via glexec; this adds a
little more overhead to handle the user jobs, but makes the system
much more secure.</P>
<p>
    To enable the new operation mode,
    add the following line to your configuration file: 
</p>
    <div class="xml">
    &lt;attr name=&quot;GLEXEC_JOB&quot;
    value=&quot;True&quot;

    publish=&quot;False&quot;
    parameter=&quot;True&quot;/&gt;
    </div>
<P>
Note that you still need to set <tt><B>GLEXEC_BIN</B></tt>,
too.</p>
    <p><B>Warning</B>: Use it only if you use HTCondor 7.1.3 or later,
as it will not work on any older HTCondor version!</P>

<H4 CLASS="western"><A NAME="glexec_troubleshooting"></A>Troubleshooting</H4>
<p>
    gLExec installations on at least
    one site had problems with delegated proxies. If in doubt, try to
    disable the delegation. 
</p>
<p>
    To disable delegation, add the following
    to <B>the shadow configuration </B>file:
</p>
    <blockquote>
    DELEGATE_JOB_GSI_CREDENTIALS=False<BR/>

    SEC_DEFAULT_ENCRYPTION=PREFERRED
    </blockquote>
<p>
    Then, set the following tags in the glidein creation file: 
    <div class="xml">
    &lt;glidein&gt;<BR/>
    &nbsp;<i>[&lt;entries&gt;&lt;entry&gt;]</i><BR/>
    &nbsp; &lt;attrs&gt;

    &nbsp;&nbsp;&nbsp;&lt;attr
    name=&quot;SEC_DEFAULT_ENCRYPTION&quot;
    value=&quot;REQUIRED&quot;
    publish=&quot;False&quot;
    parameter=&quot;True&quot;/&gt;

    </div>
    <p>Another thing to consider is the startup directory; it must be
    accessible by both the starting user and the target user(s). The
    directory you usually start in the Grid is most often not readable
    by any other user, so you must select something else. 
    Both <tt>HTCondor</tt>
    and <tt>OSG</tt> should be fine, or you can
    specify any other fixed, WN-local location. 
    </p>
</div>

<div class="section">
<H3 CLASS="western">
<A NAME="private_net"></A>Private networks and firewalls</H3>

<P>HTCondor daemons need two way communication in order to work
properly. This clashes with the network policies of most Grid sites,
that have worker nodes in private networks or implement a restrictive
firewall. 
</P>
<P>HTCondor provides the CCB mechanism to address this. It was providing also a second mechanism, GCB, 
but it is no more supported in recent versions, so remove it if you still have it in your configuration.
</P>

<H4 CLASS="western"><A NAME="ccb"></A>CCB - Condor Connection Broker</H4>
<p>
    CCB was introduced in Condor v7.3.0
    to replace GCB in most circumstances. It is much more reliable than
    GCB and also easier to setup. <BR/>
    The detailed description of CCB is
    beyond the scope of this manual and you should refer to the HTCondor
    documentation available at
    <A HREF="http://research.cs.wisc.edu/htcondor/manual/v8.0/3_7Networking_includes.html#sec:CCB">http://research.cs.wisc.edu/htcondor/manual/v8.0/3_7Networking_includes.html#sec:CCB</A>.
    Here you will find only the parameters needed to enable it in the
    glideins.
    </p><p>To use HTCondor with CCB, you need to specify: 
    <div class="xml">
    &lt;glidein&gt;<BR/>
    &nbsp;<i>[&lt;entries&gt;&lt;entry&gt;]</i><BR/>

    &nbsp;&lt;attrs&gt;<BR/>
    &nbsp;&nbsp;&lt;attr name=&quot;USE_CCB&quot;
    value=&quot;True&quot;
    publish=&quot;False&quot;
    parameter=&quot;True&quot;/&gt;

    </div>
<P>
and you are done. Just make sure you follow the <A HREF="http://www.cs.wisc.edu/condor/manual/v7.3/3_7Networking_includes.html#sec:CCB">suggested
scalability guidelines described in the HTCondor manual</A>.</P>
</div>

<div class="section">
<H3 CLASS="western"><A NAME="security"></A>Security handles</H3>
<P>As mentioned in the <A HREF="../index.html#pool_glidein">startup
page</A>, the glidein pool must be properly configured to protect it
from hackers and malicious users. The same page also describes what
needs to be done on the collector machine.<BR>The glidein itself can
also be configured. The default configuration works fine for most
users, but you may need to change them.<BR><BR>The values are set
using the <tt><B>&lt;attr /&gt;</B></tt> option,
and the default values are:</P>

<tt>
<UL>
    <LI><B>SEC_DEFAULT_ENCRYPTION</B>=OPTIONAL</li>
    <LI><B>SEC_DEFAULT_INTEGRITY</B>=REQUIRED</li>
    <LI><B>DELEGATE_JOB_GSI_CREDENTIALS</B>=False</li>
</UL>
</tt>
<P>As of HTCondor version 7.1.3 condor also supports a more efficient
authentication mechanism between the condor_schedd/condor_shadow and
condor_startd/condor_starter. This method uses the match ClaimId as a
shared password for authentication between these daemons. Since using
a shared secret is much cheaper that using GSI authentication, this
should be used every time it is feasible.</P>

<P>This option is enabled by default.
<tt><B>&lt;attr /&gt;</B></tt> option:</P>
    <blockquote>
    &lt;attr name=<B>USE_MATCH_AUTH</B> ... value=<b>True</b>.. /&gt;
       ... <font color="blue"><b>enabled</b></font>
   <br/>
    &lt;attr name=<B>USE_MATCH_AUTH</B> ... value=<b>False</b>.. /&gt;
       ... <font color="red"><b>disabled</b></font>
    </blockquote>
<p>
    When enabled, this HTCondor attribute <b>must</b> be set in the
    <B>condor_config</B> of the <B>submit machine</B>.<br/>
    This option is not used by the HTCondor negotiator or collector and therefore
    not needed if they are installed separately.
</p>

<p>
    <blockquote>
    <b>SEC_ENABLE_MATCH_PASSWORD_AUTHENTICATION</b> = True
    </blockquote>
</p>
</div>


<div class="section">
<H3 CLASS="western">
<A NAME="tcp"></A>Using TCP to send updates to the Collector</H3>
<p>
    By default, HTCondor uses UDP packets
    to communicate between the glideins and the Collector. While more
    efficient than TCP, UDP packets are often blocked at the firewall,
    or lost on the WAN. 
</p>
<p>
	To disable TCP updates, specify, with the <tt>&lt;<B>attr</B>/&gt;</tt> option: 
    <blockquote>

    <B>UPDATE_COLLECTOR_WITH_TCP</B>=False
    </blockquote>
</p>
<P>In GlideinWMS, we enable the glideins to update the user collector using TCP by default.
<BR>Please be aware that this will configure the glideins only; you
still need to properly configure the Collector machine. See 
<A HREF="http://www.cs.wisc.edu/condor/manual/v7.0/3_7Networking_includes.html#SECTION00474000000000000000">Condor documentation</A>
 for more details.</P>
</div>

<div class="section">
<H3 CLASS="western"><A NAME="multicol"></A>Multiple Collectors</H3>
<P>By default, HTCondor uses only one Collector for the 
<A HREF="../index.html#pool_glidein">glidein (user) pool</A>.
However, if the load becomes too high on the collector, you can
configure multiple collectors in a chain.  

</p><p>
    You will need a master and a set of slave collectors. 
    Each slave collector will service a portion of the pool 
    and will forward communication between the startd daemons 
    to the master collector.  Machine classads from these startd's
    will be sent to the master collector.
    The negotiator and the schedds will talk to the master collector, 
    and the startds will talk to one of the slave ones.  This will
    reduce load on the central manager.
</p><p>
    To set up slave collector in the 
    <A HREF="../index.html#pool_glidein">glidein (user) pool</A>, 
    one way is to set the following env variables before 
    starting up the condor_master: 
</P>
<PRE>COLH=`condor_config_val COLLECTOR_HOST`
LD=`condor_config_val LOCAL_DIR`
export _CONDOR_COLLECTOR_HOST=$COLH:
export _CONDOR_MASTER_NAME=collector_
export _CONDOR_DAEMON_LIST=&quot;MASTER, COLLECTOR&quot;
export _CONDOR_LOCAL_DIR=$LD/$_CONDOR_MASTER_NAME
export _CONDOR_LOCK=$_CONDOR_LOCAL_DIR/lock
# Forward all the traffic to the main collector
export _CONDOR_CONDOR_VIEW_HOST=localhost:9618</PRE>
<p>
    Using <t>localhost</t> to communicate to the master collector is more efficient.
    But will not work if they are on different hosts or if you are using HTCondor older than 8.2.
    For those case you'll need: <t>export _CONDOR_CONDOR_VIEW_HOST=$COLH:9618</t> 

</p><p>
    Once you have the slave collectors set up, you will want to use
    them. 

</p><p>
    The <A HREF="../frontend/index.html">VO Frontend</A>
    will have to point the factory to a 
    <A HREF="../frontend/index.html#management">list of collectors</A>. 
</p><p>
    The configuration internally will add a line in the factory 
    configuration file that will set up the glideins to handle
    the multiple collectors.  (You should now see a line like:
    <i>"&lt;file absfname=&quot;web_base/collector_setup.sh&quot;
    executable=&quot;True&quot;/&gt;"</i> after reconfiguring).

</p>
</div>


<div class="section">
<H3 CLASS="western">
<A NAME="start_rank"></A>Setting the glidein start and rank&nbsp;condition</H3>
<P>As with any HTCondor pool, you may need to set the startd 
<A HREF="http://research.cs.wisc.edu/htcondor/manual/v8.0/3_5Startd_Policy.html#SECTION00452000000000000000">start</A>
and <A HREF="http://research.cs.wisc.edu/htcondor/manual/v8.0/3_5Startd_Policy.html#SECTION00454000000000000000">rank</A>
conditions. <BR/>

For a glidein, you can set this with the &lt;<B>attr</B>/&gt; options: 
</P>
    <blockquote>
    <B>GLIDEIN_Start</B>=<I>expression</I><br/>
    <B>GLIDEIN_Rank</B>=<I>expression</I> 
    </blockquote>

<p> 
    For example: 
    <div class="xml">
    &lt;glidein&gt;<BR/>
    &nbsp;<i>[&lt;entries&gt;&lt;entry&gt;]</i><BR>
    &nbsp; &lt;attrs&gt;<BR/>
    &nbsp; &nbsp; &lt;attr name=&quot;GLIDEIN_Start&quot;

    value=&quot;Owner==&amp;quot;sfiligoi&amp;quot;&quot;
    publish=&quot;False&quot; parameter=&quot;True&quot;/&gt;<BR/>
    &nbsp; &nbsp; &lt;attr name=&quot;GLIDEIN_Rank&quot;

    value=&quot;ImageSize&quot; publish=&quot;False&quot;
    parameter=&quot;True&quot;/&gt; 
    </div>
</div>
<div class="section">
<h3>Internal Configuration</h3>
The configuration is parsed during the reconfiguration of the Factory, and split into a number of files:
<ul>
<li>job.descript = is read by the daemon do decide how to work </li>
<li>attributes.cfg = are fixed values, these are published in the factory classad</li>
<li>params.cfg = are for values the frontend will change, also published in the Factory classad</li>
</ul>
For more information, see the <a href="design_entry.html#config">Entry Internals</a> page.


</div>
<div class="section">

    <h3><a name="tarballs">Multiple Condor Tarballs</a></h3>
    <p>One frequent problem is that one particular condor binary will not run on all compute nodes.  Entry points require different architectures, or have different versions of glibc (ie. SL3 does not have glib2.4). </p>
<p> 
    The solution is to have multiple condor binaries.  The way to do this is to specify a tarball tag in the factory configuration file.  
</p>
<ol>
    <li>Download the HTCondor binary from the 
    <a target="_blank" href="http://research.cs.wisc.edu/htcondor/downloads/">University of Wisconsin</a> site.
      (Alternatively, You can build it from scratch on the architecture.
      Refer to HTCondor instructions for this.)
      <p/>
      The glideinwms pilot uses a subset of the condor binaries/libraries.
      The <tt>create_condor_tarball</tt>
      script can be used to reduce space needed on your factory node.
      Details on this script can be found in the 
      <a href="../components/tools.html#create_condor_tarball" >
      Components - Tools section of the documentation</a>.
    </li>
    <p/>

    <li>Add a new <tt>condor_tarball</tt> tag to the factory configuration file:<br/>
        There are two ways you can do this:
       <ul>
        <li> put the tarball in a directory owned by the wmsfactory and 
             enter the <tt>condor_tarball</tt> tag as:
        <blockquote>
        &lt;glidein ... &gt;<br/>
        ...<br/>
        &nbsp;&nbsp;&lt;condor_tarballs &gt;<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;&lt;condor_tarball 
                    os="<i>OS</i>" 
                    arch="<i>Arch</i>" 
                    <font color="blue"><b>tar_file="ZIPPED_TARFILE</b></font>" 
                    version="<i>Condor_Version</i>" /&gt;
        </blockquote>
       </li>
        <li> or put the tarball in a directory owned by the wmsfactory and unzip/untar it.
             Then, enter the <tt>condor_tarball</tt> tag as:
        <blockquote>
        &lt;glidein ... &gt;<br/>
        ...<br/>
        &nbsp;&nbsp;&lt;condor_tarballs &gt;<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;&lt;condor_tarball os="<i>OS</i>" arch="<i>Arch</i>" 
             <font color="blue"><b>base_dir="DIR_OF_UNTARRED_BINARY"</b></font> 
             version="<i>Condor_Version</i>" /&gt;
        </blockquote>
       </li>
      </ul>
    <p/>
        Starting v2.6.2, to simplify the configuration, os, arch and version
        support comma values. This can drastically reduce the number of 
        condor_tarball entries needed in the configuration file.
        <br><br>
        Consider an example below for default <tt>os as rhel5</tt> and <tt>default arch as
        x86_64</tt>. If the factory admin also wants <tt>os</tt> and <tt>arch</tt> information
        explicitly available, the configuration needs following entries to cover
        possible combinations.
        <blockquote>
        &lt;condor_tarball <font color="blue"><b>os="default" arch="default"</b></font>
                           base_dir="dir" version="default"/&gt;<br>
        &lt;condor_tarball <font color="blue"><b>os="rhel5" arch="x86_64"</b></font>
                           base_dir="dir" version="default"/&gt;<br>
        &lt;condor_tarball <font color="blue"><b>os="rhel5" arch="default"</b></font>
                           base_dir="dir" version="default"/&gt;<br>
        &lt;condor_tarball <font color="blue"><b>os="default" arch="x86_64"</b></font>
                           base_dir="dir" version="default"/&gt;
        </blockquote>
        Above example can be easily consolidated into a single <tt>condor_tarball</tt>
        entry as below and the factory reconfiguration process will 
        internally consider all the combinations. This also applies to the
        <tt>version</tt>.
        <blockquote>
        &lt;condor_tarball <font color="blue"><b>os="default,rhel5" arch="default,x86_64"</b></font>
                           base_dir="dir" <font color="blue"><b>version="default"</b></font>/&gt;
        </blockquote>
    </li>
    <p/>
    <li>Verify your <tt>entry</tt> point attributes.  Each <tt>entry</tt> point will have the following <tt>attr</tt> set up.  Make sure that this matches the above <tt>condor_tarball</tt> parameters:<br/>
        <blockquote>
    &lt;entry&gt;<br/>
&nbsp;&nbsp;
    &lt;attrs&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;
    &lt;attr <font color="blue"><b>name="CONDOR_ARCH"</b></font> const="True"
parameter="True" 
glidein_publish="False" 
job_publish="False" 
publish="False" 
type="string" 
<font color="blue"><b>value="<i>Arch</i>"</b></font>/&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;
     &lt;attr <font color="blue"><b>name="CONDOR_OS"</b></font> const="True"
parameter="True" 
glidein_publish="False" 
job_publish="False" 
publish="False" 
type="string" 
<font color="blue"><b>value="<i>Condor_Version</i>"</b></font>/&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;
    &lt;attr name="GLEXEC_JOB" const="True" 
parameter="True" 
glidein_publish="False" 
job_publish="False" 
publish="False" 
type="string" 
value="True"/&gt;<br/>
&nbsp;&nbsp
    &lt;/attrs&gt;<br/>
        </blockquote>
                The CONDOR_OS and the CONDOR_ARCH should match the <tt>os</tt> and <tt>arch</tt> defined in the tarball tag.  If set to "auto", the glidein will decide the appropriate tarball to use for that worker node.  
 	        By default, the CONDOR_VERSION will be defined globally in <tt>&lt;glidein&gt;&lt;attrs&gt;</tt> 
                and should match the version in the <tt>condor_tarball</tt> tag.  You can overwrite this global version and  
 	        define one locally in the <tt>entry</tt> if needed.
    </li>
    <p/>
    <li>Reconfigure the factory using the command:
        <blockquote>

        ./factory_startup reconfig ../CONFIG_DIR/glideinWMS.xml
        </blockquote>
    </li>
    <p/>
    <li>
        After reconfig, you can see the <tt>tar_file</tt> created from the 
        condor distribution in the <tt>condor_tarball</tt> element in the configuration
        as (if you populated just <tt>tar_file</tt> in step 2
        <blockquote>
 &lt;condor_tarball arch="default" os="default" <font color="blue"><b>tar_file="FACTORY_DIR/condor-7.8.tgz"</b></font> version="default"/&gt;
        </blockquote>
            or (if you populated just <tt>base_dir</tt> in step 2)
        <blockquote>
 &lt;condor_tarball arch="default" base_dir="/opt/glideins/git-xen21-master-ps.ini/condor-wms" os="default" <font color="blue"><b>tar_file="/var/www/html/glideinwms/factory_service/stage/glidein_master/condor_bin_0.d7bbk9.tgz"</b></font> version="default"/&gt;
        </blockquote>
    </li>
    </li>
</ol>
</div>

<div class="section">
<H3 CLASS="western">
<A NAME="time_limit"></A>Limiting time spent on a Grid resource</H3>

<P>The whole concept of gliding into Grid resources is based on the
idea that you are getting those resources on a <B>temporary basis</B>.
This implies that you need to leave the slot as soon as possible,
else your jobs will simply be killed by the annoyed Grid
administrators.<BR/>
    On the other hand, submitting new glideins is not
cost free, so you want to keep the resource for at least some period
of time.
</p><p>
    The glideins have two mechanisms to regulate this:</P>
<OL>
    <LI><P>After a specified amount of time,
    the glidein will enter the 
    <A HREF="http://www.cs.wisc.edu/condor/manual/v7.0/3_5Startd_Policy.html#SECTION00457400000000000000">RETIRING state</A>. 
    This means, it will wait for the current job to finish
    (or kill it if it does not end within a configurable timeout) and
    exit immediately afterwards. This obviously implies that no new jobs
    will start after it entered that state.<BR>The two timeouts can be
    set with the &lt;<B>attr</B> /&gt; options: 
    </P>

    <blockquote>
        <B>GLIDEIN_Retire_Time</B>=<I>nr_of_seconds</I><br/>
        <B>GLIDEIN_Job_Max_Time</B>=<I>nr_of_seconds</I>
    </blockquote>
    <P>The two default to 2 and 100 hours.  </P>

    <LI><P>If a glidein is not claimed within
    a configurable timeout, the glidein will exit.<BR>The timeout can be
    set with: 
    </P>
    <blockquote>
        <B>GLIDEIN_Max_Idle</B>=<I>nr_of_seconds</I>
        <B>GLIDEIN_Max_Tail</B>=<I>nr_of_seconds</I>
    </blockquote>
    <P>There are two configurable
       parameters for this timeout behavior.  The first, GLIDEIN_Max_Idle,
       affects how long a glidein will wait for its first job.
       The second parameter is how long a glidein will wait to get a 
       subsequent job once its finished its job.  The defaults for these
       are 1200 and 400 seconds, respectively.
    </P>
</OL>

<p>
    An example: 
</p>
    <div class="xml">
    &lt;glidein&gt;<BR/>
    &nbsp;[&lt;entries&gt;&lt;entry&gt;]<BR>&nbsp;
    &lt;attrs&gt;<BR/>

    &nbsp; &nbsp; &lt;attr name=&quot;GLIDEIN_Max_Idle&quot; 
    value=&quot;300&quot;
    type=&quot;int&quot; publish=&quot;False&quot;
    parameter=&quot;True&quot;/&gt;<BR/>

    &nbsp; &nbsp; &lt;attr name=&quot;GLIDEIN_Retire_Time&quot;
    value=&quot;14400&quot;
    type=&quot;int&quot; publish=&quot;False&quot;

    parameter=&quot;True&quot;/&gt;<BR/>
    &nbsp;&nbsp;&lt;attr name=&quot;GLIDEIN_Job_Max_Time&quot; 
    value=&quot;180000&quot;
    type=&quot;int&quot; publish=&quot;False&quot;

    parameter=&quot;True&quot;/&gt; 
    </div>
</div>

<div class="section">
<H3 CLASS="western">
<A NAME="multi-monitor"></A>Old-style pseudo-interactive monitoring</H3>
<P>Since v1_4_1, the pseudo-interactive monitoring uses a dedicated
startd in the glideins for monitoring purposes. This allows for
monitoring even when the job starter enters the &ldquo;<I>Retiring&rdquo;</I>
activity.</P>

<P>The side effect is that you do not have anymore the cross-VM
statistics and the names of the slots is also different.</P>
<P>To enable the old mode, use:</P>
    <div class="xml">
    &lt;attr name=&quot;MONITOR_MODE&quot; const=&quot;True&quot;
    glidein_publish=&quot;False&quot; job_publish=&quot;False&quot;

    parameter=&quot;True&quot; publish=&quot;False&quot; 
    type=&quot;string&quot;
    value=&quot;MULTI&quot;/&gt;
    </div> 

</div>

<div class="section">

<H3 CLASS="western"><A NAME="custom_code"></A><A NAME="files"></A>Adding custom files/scripts to the glideins</H3>
<P>While provided code should cover most of the general purpose use
cases, some administrators may have additional needs. For these
cases, the Glidein framework provides the possibility to download and process additional files.
    Both Factory and Frontend configuration allow to specify lists of files either for all their glideins,
    or for a specific entry (Factory), or job group (Frontend).
    These files can be scripts (executables), regular files or tar-balls and depending on the options can be downloaded
    at different times (see <A HREF="custom_scripts.html">the custom scripts document</A> for more detils).</P>
<p><b>Note:</b>
<A NAME="ref"></A>Files and subsystems will be
downloaded before the scripts. User provided scripts
will be executed in the specified order, and before the HTCondor
daemons are started up.</P>
    Here a list of the attributes of the files. Some examples follow below:
        <table class="requirements">
        <TR class="head">
            <TD> <P><B>Attribute Name</B></P> </TD>
            <TD> <P><B>Attribute Description</B></P> </TD>
        </TR>
        <TR>
            <TD> <P><b>absfname</b></P></TD>
            <TD> <P>Path of the file on the server (Factory or Frontend)</P></TD>
        </TR>
        <TR>
            <TD> <P><b>executable</b></P></TD>
            <TD> <P>True if the file is a script (executable, see example below), default is False</P></TD>
        </TR>
        <TR>
            <TD> <P><b>wrapper</b></P></TD>
            <TD> <P>True if the file is a user wrapper (see example below), default is False</P></TD>
        </TR>
        <TR>
            <TD> <P><b>untar</b></P></TD>
            <TD> <P>True if the file is a tar-ball that needs to be expanded (see example below), default is False</P></TD>
        </TR>
        <TR>
            <TD> <P><b>const</b></P></TD>
            <TD> <P>If False the file is not constant (i.e. changes may happen without a reconfiguration of the factory
                and the file cannot be checksummed), default is True</P></TD>
        </TR>
        <TR>
            <TD> <P><b>relfname</b></P></TD>
            <TD> <P>Path to save the file, relative to the glidein main directory</P></TD>
        </TR>
        <TR>
            <TD> <P><b>period</b></P></TD>
            <TD> <P>If period>0 is the period (in seconds) of the executable . Default is 0 (non periodic script).
                This is ignored for non executable scripts.
            (see <A HREF="custom_scripts.html">the custom scripts document</A> for more)</P></TD>
        </TR>
        <TR>
            <TD> <P><b>prefix</b></P></TD>
            <TD> <P>STARTD_CRON prefix, it is prepended to all HTCondor variables generated by the script (see documentation).
                This is ignored from anything different form a periodic executable script.
                The default value is <it>GLIDEIN_PS_</it>, use <it>NOPREFIX</it> to have no prefix.
                Be aware that if you choose not to have a prefix your HTCondor variables may collide with other scripts or
             variables.
                Variables used by the wrapper, like GLIDEIN_PS_LAST, will keep using the prefix.
            </P></TD>
        </TR>
        <TR>
            <TD> <P><b>comment</b></P></TD>
            <TD> <P>Arbitrary comment string</P></TD>
        </TR>
        <TR>
            <TD> <P><b>after_entry</b></P></TD>
            <TD> <P>If True, the script is executed after the entry scripts. Default is False for the Factory,
                default is True for the Frontend. (see <A HREF="custom_scripts.html">the custom scripts document</A>
                for more)</P></TD>
        </TR>
        <TR>
            <TD> <P><b>after_group</b></P></TD>
            <TD> <P>If True, the Frontend script is executed after the group scripts. Default is False. Not considered in the
            Factory. (see <A HREF="custom_scripts.html">the custom scripts document</A> for more)</P></TD>
        </TR>
    </TABLE>

<UL>
    <LI>
        <div class="xml">
        &lt;glidein&gt;<BR/>

        &nbsp;[&lt;entries&gt;&lt;entry&gt;]<BR/>
        &nbsp;&lt;files&gt;<BR/>
        &nbsp;&nbsp;&lt;file absfname=&quot;<I>script name</I>&quot; 
        executable=&quot;True&quot;
        prefix=&quot;<I>cron_prefix</I>&quot;
        comment=&quot;<I>comment</I>&quot;/&gt;

        </div>
    <p> Path to the custom script.   The script will be copied in the
    Web-accessible area, and when a glidein starts, the glidein
    startup script will pull it and execute it. If any parameters are
    needed, they can be specified using <B>&lt;attr /&gt;</B>, or
    stored in a file (see below).  <br/> For more detailed information,
    see the page dedicated to 
    <A HREF="custom_scripts.html">writing custom scripts</A>.</P>

    <div class="xml">
    &lt;glidein&gt;<BR/>
    &nbsp;[&lt;entries&gt;&lt;entry&gt;]<BR/>
    &nbsp;&lt;files&gt;<BR/>
    &nbsp; &nbsp;&lt;file absfname=&quot;<I>script name</I>&quot; 
    wrapper=&quot;True&quot;

    comment=&quot;<I>comment</I>&quot;/&gt;
    </div>
    <p>Path to the wrapper custom script.
    The script will be copied in
    the Web-accessible area, and will be sourced just before a user job
    starts starts; i.e. it will become part of the 
    <A HREF="http://www.cs.wisc.edu/condor/manual/v7.2/3_3Configuration.html#16039">user job wrapper</A>.</P>
    <LI>

        <div class="xml">
        &lt;glidein&gt;<BR/>
        &nbsp;[&lt;entries&gt;&lt;entry&gt;]<BR/>
        &nbsp;&lt;files&gt;<BR/>
        &nbsp; &nbsp;&lt;file 
        absfname=&quot;<I>local file name</I>&quot; 
        relfname=&quot;<I>target file name</I>&quot; 
        const=&quot;<I>Bool</I>&quot;

        executable=&quot;False&quot;
        comment=&quot;<I>comment</I>&quot;/&gt;
        </div>
    <p>Path to the config file.
    The file will be copied in the
    Web-accessible area, and pulled by the glidein startup script when a
    glidein starts. It can be then used by any script (see above).
    <br/>
    <b>Note:</b> Please be cautious in using the <B>const</B> flag; if set to
    <B>False</B>, the content of the file will not be verified by the
    glidein startup script and could be tampered in transit by a
    malicious user. So never put sensitive data (like the switch to
    disable security checks) in a changeable file. 
    </P>
    <LI>
        <div class="xml">
        &lt;glidein&gt;<BR/>
        &nbsp;[&lt;entries&gt;&lt;entry&gt;]<BR/>

        &nbsp;&lt;files&gt;<BR/>
        &nbsp;&nbsp;&lt;file 
        absfname=&quot;<I>local file name</I>&quot;
        untar=&quot;True&quot;
        comment=&quot;<I>comment</I>&quot;&gt;<BR>
        &nbsp; &nbsp; &lt;untar_options
        cond_attr=&quot;<I>conf_sw</I>&quot;

        dir=&quot;<I>dir name</I>&quot; 
        absdir_outattr=&quot;<I>attr name</I>&quot;/&gt;
        </div>
    <p>Sometimes it is useful to transfer a
    whole set of files, or even directories, and that is much easier to
    accomplish by means of a tar-ball. A subsystem is the glidein way to
    describe a compressed tarball that is delivered to the worker nodes,
    untarred in a separate directory and advertised to the other
    scripts.</p>
    <UL>
        <LI><B>absfname</B>: 
        Path to the custom tar-ball.
        (like &quot;/tmp/mytar_v12.5.tgz&quot;) </li>
        <LI><B>conf_sw</B>: 
        Name of a configuration switch. 
        (like &quot;ENABLE_KRB5&quot;)<BR/>
        The tarball will be unpacked only if that 
        parameter will be set to 1.
        Use the&nbsp;<B>&lt;attr /&gt;</B> switch to define the default
        value.  A special name <B>TRUE</B> can be used to always
        untar it. </li>

        <LI><B>dir</B>: 
        Name of the subdirectory to untar it in. 
        (like &quot;krb5&quot;) </li>
        <LI><B>absdir_outattr</B>: Name of a
        variable name. (like &quot;KRB5_SUBSYS_DIR&quot;)<BR/>The
        variable will be set to the absolute path of the directory where
        the tarball was unpacked, if and only if the unpacking actually
        happened (else it will not be defined.) <b>ENTRY_</b> will be prepended
	if if the <b>&lt;file&gt;</b> directive occurs in an entry.</li>
    </UL>
</UL>
</div>

<div class="section">
<a name="factmoncollector" />
<H3 CLASS="western">
Monitoring collectors
</H3>
<p>
By default, the glideins talk to the VO Pool Collector only.
This makes monitoring them from the Factory side extremely difficult.
</p>
<p>
To solve this, you can set up a Monitoring Collector tree that mirrors
that of <a href="../frontend/configuration.html#usercollector">the VO Pool Collector</a>, 
and tell the glideins to report there, too.
</p>
<p>
The configuration syntax is very similar to that of the
 <a href="../frontend/configuration.html#usercollector">the VO Pool Collector</a>, but using <b>monitoring_collector</b> instead of <b>collector</b> keyword.<br>
For example:
    <div class="xml">
    <blockquote>
    &lt;monitoring_colectors&gt;<br/>
    <blockquote>
        &lt;monitoring_colector DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector.fnal.gov" node="factmoncollector.fnal.gov" secondary="False" group="default" /&gt;<br/>
        &lt;monitoring_colector DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector.fnal.gov" node="factmoncollector.fnal.gov:9620-9819" secondary="True" group="default" /&gt;<br/>
        &lt;monitoring_colector DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector2.fnal.gov" node="factmoncollector2.fnal.gov" secondary="False" group="ha" /&gt;<br/>
        &lt;monitoring_colector DN="/DC=org/DC=doegrids/OU=Services/CN=factmoncollector2.fnal.gov" node="factmoncollector2.fnal.gov:9620-9919" secondary="True" group="ha" /&gt;<br/>
    </blockquote>
    &lt;/monitoring_colectors&gt;<br/>
    </blockquote>
    </div></p>
<p>
<p>
For more details, see the 
 <a href="../frontend/configuration.html#usercollector">Frontend documentation</a>.
</p>
</div>

<div class="section">
<a name="monitorgroups" />
<H3 CLASS="western">Grouping glidein Entries for monitoring purposes</H3>
<P>Certain monitoring graphs are useful when grouped together. You
can use the &ldquo;monitorgroups&rdquo; tag as follows to group the entries
together.</P>
<p>
    For example, below, entry1 and
    entry2 will be grouped together and the group information can be
    plotted against individual entry information.
</p><p>
    <div class="xml">
    &lt;glidein&gt;<BR/>
    &nbsp;&lt;entries&gt;<BR/>

    &nbsp; &lt;entry name=&ldquo;entry1&rdquo; ...&gt;<BR/>
    &nbsp; &nbsp;&lt;monitorgroups&gt;<BR/>
    &nbsp; &nbsp; &nbsp; &lt;monitorgroup 
    group_name=&quot;Group1&quot;/&gt;<BR/>
    &nbsp; &nbsp; &nbsp; &lt;monitorgroup 
    group_name=&quot;Group2&quot;/&gt;<BR/>

    &nbsp; &nbsp;&lt;/monitorgroups&gt;<BR/>
    &nbsp; &lt;/entry&gt;<BR>
    &nbsp; &lt;entry name=&ldquo;entry2&rdquo; ...&gt;<BR>
    &nbsp; &nbsp;&lt;monitorgroups&gt;<BR>
    &nbsp; &nbsp; &nbsp; &lt;monitorgroup 
    group_name=&quot;Group1&quot;/&gt;<BR>

    &nbsp; &nbsp; &nbsp; &lt;monitorgroup 
    group_name=&quot;Group4&quot;/&gt;<BR>
    &nbsp; &nbsp;&lt;/monitorgroups&gt;<BR>
    &nbsp; &lt;/entry&gt;<BR>
    &nbsp;&lt;/entries&gt;<BR>

    &lt;/glidein&gt;
    </div>
</p>
</div>

<div>
    <a name="xsltplugins"/>
        <h3 class="western">XSLT Plugins to extend configuration</h3>
        <p>
        Starting in v3.2.1, you can use XSL transformations (XSLT) to manage
complex configuration files. During the reconfig process, the glidein Factory
applies XSL transformations available to it in the directory configured by the
environment variable GWMS_XSLT_PLUGIN_DIR. (It is also available by
supplying the -xslt_plugin_dir option to the reconfig_glidein and
reconfig_frontend commands as shown below.)</p>
<p>        Setting the variable via sysconfig files are supported:
/etc/sysconfig/gwms-factory for the factory service and
/etc/sysconfig/gwms-frontend for the Frontend service,
with the following contents:</p>
        <pre>
<b>prompt$</b> cat /etc/sysconfig/gwms-factory 
# Configuration file for the Glideinwms services.

#
# Plugin directory to get xslt transformations from.
#

export GWMS_XSLT_PLUGIN_DIR=/etc/gwms-factory/plugin.d
        </pre>

The following sample XSLT adds a custom attribute to the configuration file
used by the factory.

<pre>
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; &gt;
<b>   &lt;xsl:template match=&quot;glidein/attrs&quot;&gt;</b>
       &lt;xsl:copy&gt;
<b>         &lt;attr name=&quot;SOME_GWMS_ATTRIBUTE&quot; const=&quot;False&quot; glidein_publish=&quot;False&quot; job_publish=&quot;False&quot; parameter=&quot;True&quot; publish=&quot;True&quot; type=&quot;int&quot; value=&quot;7000&quot;/&gt;</b>
         &lt;xsl:apply-templates select=&quot;@* | node()&quot;/&gt;
       &lt;/xsl:copy&gt;
   &lt;/xsl:template&gt;

   &lt;xsl:template match=&quot;/ | @* | node()&quot;&gt;
       &lt;xsl:copy&gt;
           &lt;xsl:apply-templates select=&quot;@* | node()&quot;/&gt;
       &lt;/xsl:copy&gt;
   &lt;/xsl:template&gt;
</pre>
        </p>
</div>

The default behavior can be overridden by specifying the option -xslt_plugin_dir to reconfig_glidein and reconfig_frontend tools. 
<pre>
<b>prompt$</b> reconfig_glidein -xslt_plugin_dir &lt;xslt directory&gt; [...]
<b>prompt$</b> reconfig_frontend -xslt_plugin_dir &lt;xslt directory&gt; [...]
</pre>
</div>

<div>
    <a name="sitecollector"/>
        <h3 class="western">Glidein's Startd Advertising to Site HTCondor-CE Collector</h3>
        <p>
        Starting in v3.2.11, you can make glidein's HTCondor daemons advertise
        to site's local collector. There is no Glideinwms configuration
        that enable this and all the changes are on the site side.
        <ol>
            <li>
              <b>Give glidein write access to the site collector</b><br>
              This is done by adding glidein's DN to gridmapfile of the
              site collector
            </li>
            <li>
              <b>Set site collector info in the glidein's environment</b><br>
              Set the CONDORCE_COLLECTOR_HOST in the glidein's environment
              <pre>CONDORCE_COLLECTOR_HOST=&lt;site-local HTCondorCE collector address&gt;</pre>
            </li>
        </ol>

        </p>
    </div>

<div class="footer">
Banner image by
<a href="http://www.flickr.com/people/leafwarbler/">Madhusudan Katti</a>
used under Creative Commons license.<br/>
Original Home URL: <a href="http://glideinwms.fnal.gov">http://glideinwms.fnal.gov</a>.
glideinWMS email support: glideinwms-support at fnal.gov
</div></div>
</body>
</html>
